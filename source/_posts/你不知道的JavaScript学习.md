---
title: ã€Šä½ ä¸çŸ¥é“çš„JavaScriptã€‹å­¦ä¹ 
date: 2022-7-3 00:00:01
toc: true
description: JSé»„å®ä¹¦ç¬¬ä¸€ç‰ˆ
categories:
  - [å‰ç«¯,JS]
tags:
  - å‰ç«¯
  - JavaScript
---

## ä½œç”¨åŸŸä¸é—­åŒ…

ä½œç”¨åŸŸæ˜¯ä¸€å¥—æ ¹æ®åå­—æŸ¥æ‰¾å˜é‡çš„è§„åˆ™, ä½œç”¨åŸŸç»´æŠ¤äº†æ‰€æœ‰å£°æ˜çš„å˜é‡å¹¶ç¡®å®šå˜é‡çš„è®¿é—®æƒé™.

### ä½œç”¨åŸŸåœ¨ç¼–è¯‘ä¸­çš„äº¤äº’

JavaScript æ˜¯ä¸€é—¨è§£é‡Šå‹è¯­è¨€, è§£é‡Šå™¨æœ‰ä¸‰éƒ¨åˆ†æ„æˆ

- å¼•æ“: è´Ÿè´£æ•´ä¸ªè§£é‡Šè¿‡ç¨‹
- ç¼–è¯‘å™¨: è¿›è¡Œè¯æ³•è¯­æ³•åˆ†æä¸ä»£ç ç”Ÿæˆ
- ä½œç”¨åŸŸ: ç»´æŠ¤äº†æ‰€æœ‰å£°æ˜çš„å˜é‡ç¡®å®šå˜é‡çš„è®¿é—®æƒé™

**å¼•æ“è¯·æ±‚**

åœ¨è§£é‡Šè¿‡ç¨‹ä¸­, å¼•æ“ä¼šä¸æ–­çš„å‘ä½œç”¨åŸŸå‘å‡º `LHS` ä¸ `RHS` æŸ¥è¯¢. å¯ä»¥è®¤ä¸º `LHS` æŸ¥è¯¢æ˜¯åœ¨æŸ¥è¯¢å·¦å€¼, `RHS` æ˜¯åœ¨æŸ¥è¯¢å³å€¼(æˆ–è€…ç†è§£ä¸ºéå·¦å€¼). æ¢è€Œè¨€ä¹‹, å½“å˜é‡è¦è¿›è¡Œèµ‹å€¼æ“ä½œæ—¶, å¼•æ“ä¼šæ‰§è¡Œ `LHS` æŸ¥è¯¢, è¿™æ—¶å¼•æ“ä¸å…³å¿ƒå˜é‡çš„å€¼, è€Œå…³å¿ƒå˜é‡çš„ä½ç½®. å…¶ä»–æƒ…å†µä¸‹å¼•æ“æ‰§è¡Œ `RHS` æŸ¥è¯¢, è¿™æ—¶å¼•æ“åªå…³å¿ƒå˜é‡çš„å€¼. ä½œç”¨åŸŸæ”¶åˆ°è¯·æ±‚åæ ¹æ®è¯·æ±‚æ ‡è¯†ç¬¦è¿”å›å€¼. ä¾‹å¦‚, åœ¨ä¸‹é¢è¿™æ®µä»£ç æ‰§è¡Œæ—¶å‘ç”Ÿäº†å¦‚ä¸‹æŸ¥è¯¢:

```js
function foo(a){
    console.log(a);
}

var b = 2;

foo(2)
```

1. å°† `function foo(a){}` çœ‹ä½œ `var foo = function(){}`, å¼•æ“æ‰§è¡Œ `var foo` æ—¶å‘å‡º `RHS` è¯·æ±‚æŸ¥è¯¢ `foo`, æŸ¥è¯¢ä¸åˆ°, é‚åˆ›å»º `foo` å˜é‡
2. å¼•æ“æ‰§è¡Œ `foo = ...` æ—¶å‘å‡º `LHS` è¯·æ±‚æŸ¥è¯¢ `foo`, æŸ¥è¯¢åˆ°ååˆ†é…å˜é‡
3. å¼•æ“æ‰§è¡Œ `var b` æ—¶å‘å‡º `RHS` è¯·æ±‚æŸ¥è¯¢ `b`, æŸ¥è¯¢ä¸åˆ°, é‚åˆ›å»º `b` å˜é‡
4. å¼•æ“æ‰§è¡Œ `b = 2` æ—¶å‘å‡º `LHS` è¯·æ±‚æŸ¥è¯¢ `b`, æŸ¥è¯¢åˆ°ååˆ†é…å˜é‡
5. å¼•æ“æ‰§è¡Œ `foo(2)` æ—¶å‘å‡º `RHS` è¯·æ±‚æŸ¥è¯¢ `foo`
6. å¼•æ“æ‰§è¡Œ `foo(2)` æ—¶å‘å‡º `LHS` è¯·æ±‚æŸ¥è¯¢ `a`, æŸ¥è¯¢åˆ°åéšå¼åˆ†é…å˜é‡
7. å¼•æ“æ‰§è¡Œ `console` æ—¶å‘å‡º `RHS` è¯·æ±‚æŸ¥è¯¢ `console`
8. å¼•æ“æ‰§è¡Œ `console.log` æ—¶å‘å‡º `RHS` è¯·æ±‚æŸ¥è¯¢ `console` ä¸‹çš„ `log`
9. å¼•æ“æ‰§è¡Œ `console.log(a)` æ—¶å‘å‡º `RHS` è¯·æ±‚æŸ¥è¯¢ `a`

**ä½œç”¨åŸŸå›åº”**

ä½œç”¨åŸŸåœ¨æ”¶åˆ°å¼•æ“çš„ `LHS/RHS` è¯·æ±‚åä¼šåœ¨æœ¬ä½œç”¨åŸŸä¸‹æŸ¥æ‰¾å¹¶è¿”å›å¯¹æ ‡è¯†ç¬¦çš„å¼•ç”¨

**å¼•æ“çš„å¤„ç†**

- è‹¥ä½œç”¨åŸŸæ²¡æ‰¾åˆ°æ ‡è¯†ç¬¦:

  å¼•æ“ä¼šè¯·æ±‚ä¸Šä¸€å±‚ä½œç”¨åŸŸç›´åˆ°å…¨å±€ä½œç”¨åŸŸ. è‹¥åœ¨å…¨å±€ä½œç”¨åŸŸä¸­è¿˜æ˜¯æ²¡æ‰¾åˆ°æ ‡è¯†ç¬¦

  - è‹¥å‘èµ·çš„æ˜¯ `RHS` è¯·æ±‚: ç›´æ¥æŠ›å‡º `ReferenceError`
  - è‹¥å‘èµ·çš„æ˜¯ `LHS` è¯·æ±‚: åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šç›´æ¥åˆ›å»ºå˜é‡, åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡º `ReferenceError` å¼‚å¸¸. **æ³¨æ„, è¿™ç§æƒ…å†µé’ˆå¯¹çš„æ˜¯è¯¸å¦‚ `b = a` çš„æƒ…å†µ, å¦‚æœæ˜¯ `var b = a`, é‚£ä¹ˆå¼•æ“ä¼šå…ˆæ‰§è¡Œ `RHS` åˆ›å»º `b` å†æ‰§è¡Œ `LHS` èµ‹å€¼**.

- è‹¥ä½œç”¨åŸŸæ‰¾åˆ°æ ‡è¯†ç¬¦

  - è‹¥æ˜¯ `LHS` è¯·æ±‚åˆ™è¿›è¡Œèµ‹å€¼æ“ä½œ
  - è‹¥æ˜¯ `RHS` è¯·æ±‚åˆ™ç»§ç»­åˆ¤æ–­æ˜¯å¦å¯¹å³å€¼è¿›è¡Œéæ³•æ“ä½œ(å¦‚å¯¹éå‡½æ•°å˜é‡æ‰§è¡Œå‡½æ•°è°ƒç”¨)

### è¯æ³•ä½œç”¨åŸŸ

ä½œç”¨åŸŸæœ‰ä¸¤ç§å¸¸è§çš„æ¨¡å¼

- è¯æ³•ä½œç”¨åŸŸ: å¤§å¤šæ•°è¯­è¨€(åŒ…æ‹¬JS)é‡‡ç”¨çš„
- åŠ¨æ€ä½œç”¨åŸŸ: Bash/Perlè¯­è¨€é‡‡ç”¨

ç®€å•çš„è¯´, è¯æ³•ä½œç”¨åŸŸå°±æ˜¯åœ¨**ç¨‹åºæ‰§è¡Œä¹‹å‰çš„è¯æ³•åˆ†æé˜¶æ®µ**ç¡®å®šçš„é™æ€ä½œç”¨åŸŸ. ç¼–è¯‘å™¨ä¼šåœ¨è¯æ³•åˆ†æé˜¶æ®µæ ¹æ®**å˜é‡çš„ä½ç½®å…³ç³»**ç¡®å®šç›´æ¥ç¡®å®šä½œç”¨åŸŸ.

å¼•æ“è¯·æ±‚ä½œç”¨åŸŸæŸ¥æ‰¾æ—¶, ä½œç”¨åŸŸåªä¼šæŸ¥æ‰¾ä¸€çº§æ ‡è¯†ç¬¦, ä¾‹å¦‚: æŸ¥è¯¢ `console.log` æ—¶, ä½œç”¨åŸŸåªæŸ¥è¯¢ `console`, åœ¨ä¸‹ä¸€æ¬¡æŸ¥è¯¢æ—¶å€™æ‰åœ¨ `console` ä¸­æŸ¥è¯¢ `log`

**é®è”½æ•ˆåº”**

å¯¹äºå­˜åœ¨åµŒå¥—å…³ç³»çš„ä½œç”¨åŸŸ, å¼•æ“åœ¨æŸ¥è¯¢æ—¶ä¼šä¼˜å…ˆæŸ¥æ‰¾å†…éƒ¨ä½œç”¨åŸŸè€Œå¿½ç•¥å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„åŒåæ ‡è¯†ç¬¦. å…¨å±€ä½œç”¨åŸŸä¸­çš„å˜é‡ä¼šè¢«è‡ªåŠ¨åŠ å…¥å…¨å±€å¯¹è±¡(`window/global`), å¯ä»¥ç›´æ¥é€šè¿‡ `global` è®¿é—®å…¨å±€ä½œç”¨åŸŸå˜é‡, è¿™ä¹Ÿæ˜¯å¿½ç•¥å†…å±‚ä½œç”¨åŸŸçš„å”¯ä¸€æ–¹æ³•.

**æ¬ºéª—è¯æ³•ä½œç”¨åŸŸ**

è¯æ³•ä½œç”¨åŸŸæ˜¯åœ¨è¯æ³•åˆ†æè¿›è¡Œçš„, è¿™æ„å‘³ç€ç¨‹åºå‘˜æ— æ³•åœ¨è¿è¡Œæ—¶ä¿®æ”¹ä½œç”¨åŸŸ, ä½†æ˜¯å­˜åœ¨å‡ ç§æ–¹æ³•å¯ä»¥åŠ¨æ€å¹²é¢„ä½œç”¨åŸŸ

- `eval` å‡½æ•°: åŠ¨æ€çš„ä¸º `eval` ä¼ å…¥å‚æ•°å¯ä»¥å¯¹å½“å‰ä½œç”¨åŸŸåšåŠ¨æ€ä¿®æ”¹
- `with` å‡½æ•°: ç›¸å½“äºæ‰‹åŠ¨åˆ›å»ºäº†ä¸€ä¸ªä½œç”¨åŸŸ, `with` çš„å‚æ•°ä¼šè¢«"è§£æ„"ä½œä¸ºä½œç”¨åŸŸä¸­çš„å˜é‡
- `apply/call/bind`å‡½æ•°.

åŠ¨æ€å¹²é¢„æ–¹æ³•å­˜åœ¨è¯¸å¤šå¼Šç«¯

- æ€§èƒ½ä¸‹é™: JavaScript åœ¨æ‰§è¡Œå‰ä¼šæ‰§è¡Œé™æ€åˆ†æä¸æ€§èƒ½ä¼˜åŒ–, ä½†æ˜¯æ— æ³•åˆ†æ `eval/with` ä¸­çš„åŠ¨æ€ä½œç”¨åŸŸ, äº¦æ— æ³•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–.

- ä¸¥æ ¼æ¨¡å¼ä¸å¯ç”¨:

  - åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ `eval` å‡½æ•°å†…éƒ¨æœ‰è‡ªå·±çš„ä½œç”¨åŸŸ, æ­¤æ—¶ `eval` å‡½æ•°æ— æ³•å¹²é¢„åŸä½œç”¨åŸŸ
  - ä¸¥æ ¼æ¨¡å¼ä¸‹ `with` ä¸å¯ç”¨

- æ±¡æŸ“å…¨å±€å˜é‡: ä¾‹å¦‚

  ```js
  function foo(t, v) {
    with (t) {
      a = v;
    }
  }
  
  const obj1 = { a: 2 };
  const obj2 = { b: 2 };
  
  foo(obj1, 1);
  foo(obj2, 2);
  
  console.log(obj1);       // { a: 1 }
  console.log(obj2);       // { b: 2 }
  console.log(global.a);   // 2 å‘ç”Ÿæ³„æ¼
  
  ```


**åŠ¨æ€ä½œç”¨åŸŸ**

JavaScript ä½¿ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸæ¨¡å‹, ä½†æ˜¯éƒ¨åˆ†è¯­è¨€åœ¨é‡‡ç”¨åŠ¨æ€ä½œç”¨åŸŸ

- è¯æ³•ä½œç”¨åŸŸ: è¯æ³•åˆ†æé˜¶æ®µæ ¹æ®**å˜é‡çš„ä½ç½®å…³ç³»**ç¡®å®šç›´æ¥ç¡®å®šä½œç”¨åŸŸ.
- åŠ¨æ€ä½œç”¨åŸŸ: ä½œç”¨åŸŸåœ¨è¿è¡Œæ—¶**åŠ¨æ€å˜åŒ–**, åŠ¨æ€ä½œç”¨åŸŸçš„ä½œç”¨åŸŸé“¾ä¸€èˆ¬æ˜¯åŸºäºè°ƒç”¨æ ˆçš„(è¿™ä¸ `JavaScript` çš„ `this` ç‰¹æ€§å¾ˆåƒ)

ä¾‹å¦‚, å¯¹äºä»£ç :

```js
function foo() {
  console.log(a);
}

function bar() {
  var a = 3;
  foo();
}

var a = 2;
bar();
```

- é™æ€ä½œç”¨åŸŸ: åœ¨æ‰§è¡Œ `foo` æ—¶, å¼•æ“å‘èµ· `RHS` è¯·æ±‚ `a`, æ‰¾ä¸åˆ°, å‘å¤–ç›´æ¥æŸ¥æ‰¾å…¨å±€ `a = 2`

- åŠ¨æ€ä½œç”¨åŸŸ: åœ¨æ‰§è¡Œ `foo` æ—¶, å¼•æ“å‘èµ· `RHS` è¯·æ±‚ `a`, æ‰¾ä¸åˆ°, é¡ºç€ä½œç”¨åŸŸé“¾(è°ƒç”¨æ ˆ)ç›´æ¥æŸ¥æ‰¾ `bar` ä¸­çš„ `a = 3`, çœ‹èµ·æ¥å¾ˆåƒ JavaScript çš„ `this` æœºåˆ¶

  ```js
  function foo() {
    console.log(this.a);
  }
  
  function bar() {
    this.a = 3;
    foo.apply(this);
  }
  
  this.a = 2;
  bar();
  ```

### å‡½æ•°ä¸å—ä½œç”¨åŸŸ

**å‡½æ•°ä½œç”¨åŸŸ**

å‡½æ•°å†…éƒ¨çš„å˜é‡ä¸æ–¹æ³•ä½äºå‡½æ•°ä½œç”¨åŸŸä¸­, æ— æ³•è¢«å¤–éƒ¨è®¿é—®.

åˆ©ç”¨å‡½æ•°ä½œç”¨åŸŸå¯ä»¥éšè—ä»£ç çš„éƒ¨åˆ†å†…éƒ¨å®ç°, ä»è€Œå®ç°

- æœ€å°ç‰¹æƒåŸåˆ™
- è§„é¿å˜é‡å†²çª(å…¶ä»–å®ç°è§„é¿å†²çªçš„æ–¹æ³•æœ‰é…ç½®å‘½åç©ºé—´, æ¨¡å—åŒ–ç®¡ç†)

åœ¨å®è·µä¸­, å®ç°å‡½æ•°ä½œç”¨åŸŸçš„æ–¹æ³•æœ‰

- ç›´æ¥åœ¨ä»£ç å†…éƒ¨å®šä¹‰å‡½æ•°, å¹¶åœ¨å®šä¹‰åè°ƒç”¨å‡½æ•°

  ```diff
  // ä¸Šæ–‡
  + function foo(){
      // ä¿æŠ¤èµ·æ¥çš„éƒ¨åˆ†
  + }
  + foo()
  // ä¸‹æ–‡
  ```

  è¿™ç§æ–¹æ³•å¿…é¡»å£°æ˜ä¸€ä¸ªå…·åå‡½æ•°, ç„¶ååœ¨è°ƒç”¨, ä¸ä»…ç¹ç, å…·åå‡½æ•°è¿˜æ— å½¢ä¸­æ±¡æŸ“äº†å¤–å±‚ä½œç”¨åŸŸ

- ä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼ä»£æ›¿å‡½æ•°

  ```diff
  // ä¸Šæ–‡
  + (function foo(){
      // ä¿æŠ¤èµ·æ¥çš„éƒ¨åˆ†
  + })()
  // ä¸‹æ–‡
  ```

  JavaScript åœ¨è§£æå¥å­æ—¶, è‹¥å‘ç°ç¬¬ä¸€ä¸ªå…³é”®å­—æ˜¯ `function` åˆ™ä¼šå°†è¿™å¥è¯åˆ¤å®šä¸º**å‡½æ•°å®šä¹‰**, é‡åˆ°å…¶ä»–ç¬¦å·(ä¾‹å¦‚è¿™é‡Œçš„`(`), åˆ™ä¼šå°†è¿™å¥è¯å½“ä½œ**è¡¨è¾¾å¼**. å¯ä»¥é€šè¿‡ `(function foo(){})()` çš„æ–¹æ³•å®šä¹‰å‡½æ•°. æ­¤æ—¶, ä¸ä»…ä¸ç”¨æ˜¾å¼è°ƒç”¨å‡½æ•°, `foo` æ ‡è¯†ç¬¦ä¹Ÿ**ä¸èƒ½è¢«å¤–éƒ¨è®¿é—®**, ä¸ä¼šæ±¡æŸ“å¤–å±‚ä½œç”¨åŸŸ

- åŒ¿åå‡½æ•°

  ```diff
  // ä¸Šæ–‡
  + (function(){
      // ä¿æŠ¤èµ·æ¥çš„éƒ¨åˆ†
  + })()
  // ä¸‹æ–‡
  ```

  ç¼ºç‚¹: éš¾ä»¥å¾—çŸ¥å‡½æ•°è¯­ä¹‰, è°ƒè¯•å›°éš¾. å‡½æ•°å†…éƒ¨æ— æ³•é€šè¿‡å‡½æ•°åè°ƒç”¨å‡½æ•°åä¸Šçš„å˜é‡(å¦‚: `callee`)

- IIFT

  å®é™…ä¸Šæœ‰ä¸¤ç§IIFTçš„å†™æ³•

  ```js
  (function(){})()
  (function(){}())
  ```

  ä¸¤è€…åœ¨åŠŸèƒ½ä¸Šå®Œå…¨ä¸€è‡´, ä»»é€‰å…¶ä¸€å³å¯

**ES6çš„å—ä½œç”¨åŸŸ**

`ES6` ä¸­çš„å…³é”®å­— `let`, `const` éƒ½æ”¯æŒå˜é‡å—ä½œç”¨åŸŸ, å…¶å®ç°çš„åŸç†æ˜¯: åœ¨å£°æ˜å˜é‡æ—¶**éšå¼**çš„å°†å˜é‡åŠ«æŒåœ¨æ‰€åœ¨çš„å—ä½œç”¨åŸŸä¸Š. ä½†è¿™ä¸¤ä¸ªå…³é”®å­—ä¸æ”¯æŒå˜é‡æå‡, åœ¨å®è·µæ—¶æœ€å¥½å°†å˜é‡å£°æ˜åœ¨ä½œç”¨åŸŸé¦–éƒ¨.

**ES6ä¹‹å‰çš„å—ä½œç”¨åŸŸå®ç°**

åœ¨ `ES6` å‰çš„æ—¶ä»£, `JavaScript` åªæœ‰å…¨å±€ä½œç”¨åŸŸä¸å‡½æ•°ä½œç”¨åŸŸ, ä¼Ÿå¤§çš„ç¨‹åºå‘˜ä»¬åˆ©ç”¨éƒ¨åˆ†ç‰¹æ€§å®ç°äº†éƒ¨åˆ†å—ä½œç”¨åŸŸ

å®é™…ä¸Šåœ¨ `ES6` å‰æœ‰éƒ¨åˆ†è¯­æ³•"æ”¯æŒ"å—ä½œç”¨åŸŸ

- `with` ä¸ºå†…éƒ¨ä»£ç æ‰‹åŠ¨åˆ›å»ºäº†ä¸€ä¸ªä½œç”¨åŸŸ, å†…éƒ¨ä»£ç å¯ä»¥è®¤ä¸ºæ˜¯åŒ…åœ¨ `with(){}` äº§ç”Ÿçš„å—ä½œç”¨åŸŸä¸­

- `try-catch` æ–¹æ³•çš„ `catch` åˆ†å¥ä¼šåˆ›é€ å—ä½œç”¨åŸŸ. åˆ©ç”¨è¿™ä¸ªç‰¹æ€§, éƒ¨åˆ† JavaScript çš„ polyfill è½¬è¯‘å·¥å…·ä¼šå°† `ES6` çš„å—ä½œç”¨åŸŸç¿»è¯‘ä¸º `try-catch` è¯­å¥, ä¾‹å¦‚

  ```js
  {
    let a = 2;
    console.log(a);
  }
  ```

  ç¿»è¯‘ä¸º

  ```js
  try {throw 2;} catch (a) {
    console.log(a);
  }
  ```

  **æ³¨æ„**:

  > æ—©æœŸ JavaScript è¦æ±‚ç»Ÿä¸€ä½œç”¨åŸŸä¸‹çš„ä¸åŒ `try-catch` è¯­å¥çš„ `catch` åˆ†å¥ä¸­ä¸èƒ½ä½¿ç”¨ç›¸åŒçš„æ ‡è¯†ç¬¦å£°æ˜é”™è¯¯, å³
  > ```js
  > try {
  >     throw 2;
  > } catch (error) {
  >     console.log(error);
  > }
  >
  > try {
  >     throw 2;
  > } catch (error) {
  >     console.log(error);
  > }
  > ```
  >
  > æ˜¯é”™çš„, éœ€è¦å°† `error` æ”¹ä¸º `error1`, `error2`...


### å‡½æ•°ä¸å˜é‡æå‡

å¯¹äº `var` ä¸ `function` å£°æ˜çš„æ ‡è¯†ç¬¦, å­˜åœ¨å˜é‡æå‡. JavaScript å¼•æ“ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œé™æ€ä»£ç åˆ†æ, è·å¾—è¯æ³•ä½œç”¨åŸŸ, å®Œæˆå£°æ˜.

- å¯¹äº `var` å£°æ˜çš„å˜é‡æˆ–å‡½æ•°: JavaScript åªä¼šæå‡å˜é‡å®šä¹‰, åœ¨æ­£å¼å®šä¹‰å‰, å˜é‡æ˜¯ `undefined`

- å¯¹äº `function` å£°æ˜çš„å‡½æ•°: JavaScript ä¼šæå‡å‡½æ•°å‡½æ•°å£°æ˜ä¸å®šä¹‰.

- è‹¥ä½œç”¨åŸŸä¸­åŒæ—¶å­˜åœ¨ `var` ä¸ `function` å£°æ˜. `function` ä¼˜å…ˆ, ä¾‹å¦‚:

  ````js
  foo();        // 1
  
  var foo = function () {
    console.log(2);
  };
  
  function foo() {
    console.log(1);
  }
  
  foo();        // 2
  ````

  ç›¸å½“äº

  ```js
  function foo() {  // funciton ä¼˜å…ˆ
    console.log(1);
  }
  
  var foo;         // varæ»å, äºæ˜¯è¿™ä¸ªå°±åºŸæ‰äº†
  
  foo(); // 1
  
  foo = function () {
    console.log(2);
  };
  
  foo(); // 2
  ```


### é—­åŒ…

å½“å‡½æ•°åœ¨è‡ªå·±å®šä¹‰ä½œç”¨åŸŸä»¥å¤–çš„éƒ¨åˆ†æ‰§è¡Œæ—¶, å‡½æ•°ä¼šä¿ç•™å¯¹åŸä½œç”¨åŸŸçš„å¼•ç”¨, è¿™ä¸ªå¼•ç”¨å°±æ˜¯é—­åŒ…. æ¢è€Œè¨€ä¹‹, ä¸€æ—¦ä½¿ç”¨äº†åŒæ­¥/å¼‚æ­¥çš„å›è°ƒå‡½æ•°, å°±äº§ç”Ÿäº†é—­åŒ….

å‡½æ•°å¯ä»¥ä¿æŒå¯¹é—­åŒ…çš„å¼•ç”¨, ä½†æ˜¯æ— æ³•ä¿è¯é—­åŒ…å†…çš„å€¼å¹¶ä¸å˜. åŒæ—¶, é—­åŒ…å¯ä»¥é˜»æ­¢æ‰€åœ¨å‡½æ•°ä½œç”¨åŸŸçš„åƒåœ¾å›æ”¶.

**å®ç°æ¨¡å—åŒ–**

JavaScript çš„æ¨¡å—åŒ–å°±å€Ÿç”¨äº†é—­åŒ…å®ç°, ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„åŸºæœ¬æ¨¡å¼

```js
function onemod(){
    let attr1 = 1;

    function method1(){
        // do sth
    }

    return {
        method1
    }
}
```

åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰å˜é‡ä¸æ–¹æ³•, é€šè¿‡ `return` å°†éœ€è¦æš´éœ²çš„å˜é‡å¯¼å‡º.

å‡½æ•°æ¯æ¬¡è°ƒç”¨å°±ä¼šå¯¼å‡ºä¸€ä¸ªå…¨æ–°æ¨¡å—. ä½†æ˜¯, ä¹Ÿå› ä¸ºå‡½æ•°å¯ä»¥ä¼ å…¥å‚æ•°, ç¼–è¯‘å™¨æ— æ³•å¯¹æ­¤ç±»æ¨¡å—åšå‡ºé™æ€åˆ†æä¸ä¼˜åŒ–. åœ¨ `ES6` ä¸­, æ¯ä¸ªæ¨¡å—è¢«å®šä¹‰ä¸ºæ–‡ä»¶é€šè¿‡ `import/export` å¯¼å…¥å¯¼å‡º, æ­¤æ—¶ç¼–è¯‘å™¨å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µå¯¹æ¨¡å—è¿›è¡Œé™æ€åˆ†æ.

## `this` å’Œå¯¹è±¡åŸå‹

### å…³äº `this`

**`this` ä¸æ˜¯ä»€ä¹ˆ**

- `this` ä¸æ˜¯å‡½æ•°è‡ªèº«

  æ— æ³•é€šè¿‡ `this` è·å–å‡½æ•°ä½œä¸ºå¯¹è±¡çš„å±æ€§. è‹¥æƒ³å¯¹å‡½æ•°å¯¹è±¡æ“ä½œè¿˜æ˜¯éœ€è¦ä½¿ç”¨**å‡½æ•°æ ‡è¯†ç¬¦**æˆ–åœ¨å‡½æ•°å†…ä½¿ç”¨ **`arguments.callee`** (å·²å¼ƒç”¨)

- `this` ä¸æ˜¯å‡½æ•°ä½œç”¨åŸŸ

  `this` ä¸æŒ‡å‘å‡½æ•°ä½œç”¨åŸŸ, ä½œç”¨åŸŸåœ¨ç¼–è¯‘é˜¶æ®µå°±ç”Ÿæˆäº†, ä½† `this` æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€å˜æ¢çš„. ä½œç”¨åŸŸæ˜¯å­˜åœ¨äº JavaScript å¼•æ“ä¸­çš„"å¯¹è±¡", æ— æ³•åœ¨ä»£ç ä¸­è¢«å¼•ç”¨

**`this` æ˜¯ä»€ä¹ˆ**

thisæ˜¯å‡½æ•°è°ƒç”¨æ—¶è¢«è°ƒç”¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­çš„ä¸€ä¸ªå±æ€§, å…¶å…·ä½“çš„æŒ‡å‘å–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼

**ä¸ºä»€ä¹ˆéœ€è¦`this`**

`this` æä¾›äº†ä¸€ç§è®©å‡½æ•°è°ƒç”¨éšå¼ä¼ é€’å…¶å¯¹è±¡å¼•ç”¨çš„æ¨¡å¼, åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶, `this` ä½œä¸ºå‡½æ•°ä¸Šä¸‹æ–‡ä¸­çš„ä¸€é¡¹è¢«ä¼ å…¥å‡½æ•°

### `this` çš„æŒ‡å‘

åˆ†æ `this` çš„æŒ‡å‘é¦–å…ˆè¦åˆ†æå‡½æ•°çš„è°ƒç”¨ä½ç½®, ä¹Ÿå°±æ˜¯åˆ†æè°ƒç”¨æ ˆçš„ç¬¬äºŒé¡¹

æˆ‘ä»¬å°†å…ˆä»æ˜“åˆ°éš¾çš„ä»‹ç»å„ç§è§„åˆ™, ç„¶åè§„å®šè§„åˆ™çš„ä¼˜å…ˆçº§

**è§„åˆ™**

- é»˜è®¤ç»‘å®š

  å½“å‡½æ•°è¢«ç›´æ¥è°ƒç”¨(å¦‚: `foo()`)æ—¶, `this` ä¼šè¢«ç»‘å®šåˆ° `global/window` å¯¹è±¡. åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹, `this` æ— æ³•æŒ‡å‘å…¨å±€å¯¹è±¡, å…¶ä¼šæŒ‡å‘ `undefined`

- éšå¼ç»‘å®š

  è‹¥è¢«è°ƒç”¨å¯¹è±¡è¢«å…¶ä»–å¯¹è±¡åœ¨**å½¢å¼ä¸Š**åŒ…å«, `this` å°†æŒ‡å‘è¢«åŒ…å«å¯¹è±¡. å¯ä»¥ä»ä¸‹é¢å‡ ä¸ªä¾‹å­ä¸­ç†è§£å½¢å¼ä¸Šçš„åŒ…å›´

  ```js
  window.a = 0;

  // SITUATION 1: åŒ…å›´

  const foo = {
    demo() {
      console.log(this.a);
    },
    a: 1,
  };

  foo.demo(); // 1, æ²¡é—®é¢˜, è°ƒç”¨æ—¶æ˜¯ foo.demo(), demoè¢«fooåŒ…å›´äº†

  // SITUATION 2: å½¢å¼ä¸ŠåŒ…å›´

  function demoGlobal() {
    console.log(this.a);
  }

  const bar = {
    demo: demoGlobal,
    a: 2,
  };

  bar.demo(); // 2, è™½ç„¶ bar.demo å¼•ç”¨è‡ªå…¨å±€å‡½æ•°, ä½†æ˜¯åœ¨bar.demoä¸­demoè¢«baråŒ…å›´äº†

  // SITUATION 3: å½¢å¼ä¸ŠåŒ…å›´

  const demoFromFoo = foo.demo;

  demoFromFoo(); // 0, è™½ç„¶ demoFromFoo å¼•ç”¨è‡ª foo.demo , ä½†æ˜¯åœ¨è¿™é‡Œå¹¶æ²¡æœ‰è¢«åŒ…å›´

  // SITUATION 4: å›è°ƒå‡½æ•°

  setTimeout(foo.demo, 1000); // 0, å¯ä»¥ç®€åŒ–è°ƒç”¨è¿‡ç¨‹ä¸º
  // function setTimeout(fn, delay) { // è¿™é‡Œå…¶å®è¿›è¡Œäº†ä¸€æ¬¡å‡½æ•°çš„èµ‹å€¼, ä¸SITUATION 3 ç±»ä¼¼, äºæ˜¯å¤±å»äº†åŒ…å›´å¯¹è±¡
  //   sleep(delay);
  //   fn();
  // }

  // SITUATION 5: åŒ…å›´é™·é˜±

  const baz = {};
  (baz.demo = foo.demo)(); // 0, èµ‹å€¼è¯­å¥è¿”å›çš„æ˜¯ç›®æ ‡å‡½æ•°çš„å¼•ç”¨, ç›¸å½“äºå°±æ˜¯ä¸€ä¸ª function(){...} , ä½†æ˜¯åœ¨è¿™é‡Œå¹¶æ²¡æœ‰è¢«åŒ…å›´

  // SITUATION 6: åªå…³æ³¨å‰ä¸€å±‚åŒ…å›´

  const outer = {
    inner: {
      a: 3,
      demo: demoGlobal,
    },
    a: 4,
  };

  outer.inner.demo(); // 3, åªå…³å¿ƒåŒ…å›´çš„ç¬¬ä¸€çš„å¤–å±‚å…ƒç´ (inner)
  ```

  ä¹Ÿå°† SITUATION 3&4 çš„æƒ…å†µç§°ä¸º**éšå¼ä¸¢å¤±**

- æ˜¾å¼ç»‘å®š

  JavaScript ä¸­æ”¹å˜ `this` æŒ‡å‘çš„æ–¹æ³•æœ‰ `call / apply / bind`, å¯¹äº `call / apply`, è¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥ç›´æ¥ä¿®æ”¹ `this` çš„æŒ‡å‘. `bind` å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªä¿®æ”¹ `this` åçš„å‡½æ•°, å¯ä»¥å°†å…¶å®ç°**ç®€å•çš„**ç†è§£ä¸º

  ```js
  function bind(fn, self) {
    return function () {
      return fn.apply(self);
    };
  }
  ```

  éƒ¨åˆ† API è‡ªèº«å°±æ”¯æŒæ”¹å˜ `this` æŒ‡å‘, å¦‚ `Array.prototype.forEach()` æ”¯æŒä¿®æ”¹å›è°ƒçš„ `this`

  ```js
  const obj = { a: 1, b: 2, c: 3 };
  const array = ['a', 'b', 'c'];

  array.forEach(function (d) {
    console.log(this[d]); // undefined undefined undefined
  });

  array.forEach(function (d) {
    console.log(this[d]); // 1 2 3
  }, obj);
  ```

- `new` ç»‘å®š

  ä½¿ç”¨ `new` æ–°å»ºå®ä¾‹æ—¶, æ„é€ å‡½æ•°çš„ `this` å°†ç»‘å®šåˆ°åˆ›å»ºçš„å®ä¾‹

- ç®­å¤´å‡½æ•°: ç›´æ¥ç»‘å®šéå¤–å±‚éç®­å¤´å‡½æ•°çš„ `this`

**ä¼˜å…ˆçº§**

0. ç®­å¤´å‡½æ•°
1. `new` ç»‘å®š
2. æ˜¾å¼ç»‘å®š: æ³¨æ„, `new` çš„ä¼˜å…ˆçº§é«˜äº `ES6` å®ç°çš„ `bind`, é‚£ä¸ª `bind` ä¸å‰é¢ç®€åŒ–çš„ `bind` ä¸åŒ
3. éšå¼ç»‘å®š
4. é»˜è®¤ç»‘å®š

è®¨è®º `new` ç»‘å®šä¸ `bind` ç»‘å®šçš„ä¼˜å…ˆçº§æ˜¯æœ‰æ„ä¹‰çš„, å¦‚ä¸‹

```js
class Foo {
  constructor(a, b, c) {
    //...
  }
}

const initAs12X = Foo.bind(null, 1, 2);
new initAs123(3);
new initAs123(4);
```

æˆ‘ä»¬ç¡®å®šäº†æ„é€ å‡½æ•°çš„å‰ä¸¤é¡¹ä¸º `1, 2`, å¸Œæœ›åœ¨ `new` çš„æ—¶å€™åªæŒ‡å®šç¬¬ä¸‰é¡¹, å°±å¯ä»¥è¿™ä¹ˆå†™, å…ˆç”¨ `bind` ä¸ºå‡½æ•°ä¼ å…¥å‰ä¸¤ä¸ªå‚æ•°, å¹¶ç»‘å®š `null` ä½œä¸º `this`,  ç„¶ååˆç”¨ `new` è¦†ç›– `this`.

åœ¨ JavaScript ä¸­, `bind` å‡½æ•°å¯ä»¥ç”¨æ¥å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–.

æœ€å, å¼•ç”¨æ¥è‡ªæ˜é‡‘å°å†Œçš„æµç¨‹å›¾

```mermaid
graph TB
whereisthis(å¯»æ‰¾å‡½æ•°ä¸­çš„this) --ç®­å¤´å‡½æ•°--> outerthis(åŒ…è£¹ç®­å¤´å‡½æ•°çš„éç®­å¤´å‡½æ•°çš„this)
whereisthis(å¯»æ‰¾å‡½æ•°ä¸­çš„this) --æ™®é€šå‡½æ•°--> ways(å‡½æ•°è°ƒç”¨æ–¹å¼)
whereisthis(å¯»æ‰¾å‡½æ•°ä¸­çš„this) --bind/call/apply--> fstparam(ç¬¬ä¸€ä¸ªå‚æ•°)
ways --new--> instance(thisè¢«å›ºåŒ–åœ¨å®ä¾‹ä¸Š)
ways --å…¶ä»–æ–¹å¼--> form(å‡½æ•°è¢«è°ƒç”¨çš„æ–¹å¼)
form --foo--> window(thisä¸ºwindow/ä¸¥æ ¼æ¨¡å¼ä¸‹çš„undefined)
form --bar.foo--> obj(thisä¸ºbar)
```



**é™·é˜±**

- æ— ç”¨ `this`:

  æœ‰æ—¶å‡½æ•°çš„ `this` å¹¶ä¸é‡è¦, ä½†æ˜¯éƒ¨åˆ†å›è°ƒå‡½æ•°éœ€è¦æŒ‡å®š `this`(å¦‚é€šè¿‡ `bind` å®ç°æŸ¯é‡ŒåŒ–, `forEach`å‡½æ•°). æˆ‘ä»¬å¯ä»¥ä¼ å…¥ `null` å ä½, ä½†æ˜¯è‹¥å‡½æ•°çš„ `this` ä¸ºå¯é€‰å‚æ•°ä¸”é»˜è®¤å€¼ä¸º `global`, å¡«å…¥ `null` ä¼šè®© `this` æŒ‡å‘ `global`, è¿™å¯èƒ½ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ. è§£å†³æ–¹æ³•æ˜¯å®ç°ä¸€ä¸ªäººç•œæ— å®³çš„å¯¹è±¡, å°†å…¶ç§°ä¹‹ä¸º `DMZ`(Demilitarized zone, éå†›äº‹åŒº) å¯¹è±¡, å¯ä»¥ä½¿ç”¨ `Object.create(null)` å®ç°, è¿™ä¸ªå¯¹è±¡æ¯” `{}` æ›´"ç©º",

  ```js
  var empty = Object.create(null);
  foo.bind(empty, /* ... */);
  ```

- éšå¼ä¸¢å¤±é—®é¢˜

### å¯¹è±¡

**æ„é€ **

å¯ä»¥é€šè¿‡**å­—é¢é‡**ä¸**æ„é€ å‡½æ•°**ä¸¤ç§æ–¹å¼æ„é€ å¯¹è±¡, åœ¨å­—é¢é‡æ„é€ å¯¹è±¡æ—¶, `Key` æœ‰å¤šé‡å†™æ³•

```js
let pre = 'C-';

const obj = {
  a: 1, // ä¸€èˆ¬æ¨¡å¼
  'A-1': 1, // A-1 ä¼šè¢«ç†è§£ä¸ºAå‡1, æ”¾å¼ƒç®€å†™, å°†Keyç”¨å¼•å·å¼•èµ·æ¥
  [pre + 1]: 1, // å¯ä»¥ç”¨[]å®ç°è®¡ç®—å±æ€§, ç»“æœç›¸å½“äº 'C-1': 1
};
```

åœ¨ JavaScript çš„åŸºæœ¬ç±»å‹ä¸­, åªæœ‰ Object æ˜¯å¯¹è±¡. `typeof null === 'object'`, è¿™æ˜¯å› ä¸º

> åœ¨ JavaScript ä¸­äºŒè¿›åˆ¶å‰ä¸‰ä½éƒ½ä¸º 0 çš„è¯ä¼šè¢«åˆ¤æ–­ä¸º `object` ç±»å‹, `null` çš„äºŒè¿›åˆ¶è¡¨ç¤ºå…¨æ˜¯ `0`, è‡ªç„¶å‰ä¸‰ä½ä¹Ÿæ˜¯ `0`, æ‰€ä»¥æ‰§è¡Œ `typeof` æ—¶è¿”å› `object`

**è®¿é—®**

å¯ä»¥é€šè¿‡**å±æ€§è®¿é—®**(`obj.a`)ä¸**å€¼è®¿é—®**`obj['a']`è®¿é—®å…ƒç´ , ä¸¤è€…æ•ˆæœç›¸åŒ

å½“å±æ€§è®¿é—®çš„ `Key` è¿å JavaScript è¯­æ³•æ—¶(å¦‚`a.1`)å¯ä»¥ç”¨å€¼è®¿é—®æ›¿ä»£. å€¼è®¿é—®ä¸­,  `[]`åŒ…è£¹çš„è¡¨è¾¾å¼å¯ä»¥æ˜¯é `string`, ä½†æ˜¯åœ¨æœ€åéƒ½ä¼šè½¬æ¢ä¸º `string`, ä¾‹å¦‚

```js
let obj = {};

obj[2] = 1;
obj[true] = 2;
obj[obj] = 3;

console.log(obj['2']); // 1
console.log(obj['true']); // 2
console.log(obj[new String(obj)]); // 3
console.log(obj['[object Object]']); // 3
console.log(obj[new Object()]); // 3
```

è™½ç„¶åä¸‰é¡¹éƒ½ä¸æ˜¯åŒä¸€ä¸ª `object`, ä½†æ˜¯ä»–ä»¬è½¬æ¢ä¸º `string` åéƒ½æ˜¯ `'[object Object]'`, åº”æ­¤æ˜ å°„å€¼ä¸€æ ·

**å¤åˆ¶**

- æµ…æ‹·è´

  - å¯¹äº` JSON` å®‰å…¨çš„å¯¹è±¡: `JSON.parse(JSON.stringify(obj));`
  - `ES6` ä¸‹: `Object.assign(obj);`

  è¿™ä¸¤ä¸ªæ–¹æ³•ä¼šå°†æ‰€æœ‰**å¯æšä¸¾å¯¹è±¡**æ‹·è´å‡ºæ¥, ä½†æ˜¯ `JSON` æ–¹æ³•æ‹·æ¥çš„å¯¹è±¡çš„å±æ€§æè¿°ç¬¦(å¦‚: writable)ä¼šè¢«æŠ¹å», `Object.assign` æ¥çš„å¯¹è±¡çš„å±æ€§æè¿°ç¬¦ä¼šä¿ç•™

- æ·±æ‹·è´

  ```js
  // æ·±æ‹·è´
  export function deepCopy(source, target) {
    const copyedObjs = []; // æ­¤æ•°ç»„è§£å†³äº†å¾ªç¯å¼•ç”¨å’Œç›¸åŒå¼•ç”¨çš„é—®é¢˜ï¼Œå®ƒå­˜æ”¾å·²ç»é€’å½’åˆ°çš„ç›®æ ‡å¯¹è±¡
    copyedObjs.push({ fromTarget: source, toTarget: target });
    function deepCopyFunction(sourceItem, targetItem) {
      Object.keys(sourceItem).forEach((key) => {
        if (
          typeof sourceItem[key] !== 'object' ||
          sourceItem[key] === null ||
          sourceItem[key] === undefined
        ) {
          targetItem[key] = sourceItem[key];
        } else {
          for (let i = 0; i < copyedObjs.length; i += 1) {
            if (copyedObjs[i].fromTarget === sourceItem[key]) {
              targetItem[key] = copyedObjs[i].toTarget;
              return;
            }
          }
          targetItem[key] = {};
          if (Array.isArray(sourceItem[key])) targetItem[key] = [];
          copyedObjs.push({
            fromTarget: sourceItem[key],
            toTarget: targetItem[key],
          });
          deepCopyFunction(sourceItem[key], targetItem[key]);
        }
      });
    }
    return deepCopyFunction(source, target);
  }
  ```


**å±æ€§æè¿°ç¬¦**

å¯ä»¥ç”¨ `Object.defineProperty(obj, attr, config)` å®šä¹‰å¯¹è±¡çš„å±æ€§ä¸å±æ€§æ ‡è¯†, `config` ç»“æ„ä¸º

```js
{
    configurable?: boolean, // æ˜¯å¦å…è®¸ä¿®æ”¹å±æ€§æè¿°ç¬¦, é»˜è®¤ false
    enumerable?: boolean, // æ˜¯å¦å¯ä»¥æšä¸¾, é»˜è®¤ false
    value?: any, // å€¼, é»˜è®¤ undefined
    writable?:  // å€¼æ˜¯å¦å¯ä¿®æ”¹, é»˜è®¤ false
    get(),
    set()
}
```

- æ˜¾è€Œæ˜“è§çš„æ˜¯: å°† `configurable` æ”¹ä¸º `false` åæ— æ³•æ”¹å›, ä½†æ˜¯, å³ä½¿ `configurable: false`,  ä»ç„¶å¯ä»¥å°† `writable` ä» `true` æ”¹ä¸º `false`, ä¸”æ— æ³•æ”¹å›.
- å¯ä»¥ä½¿ç”¨ `delete` åˆ é™¤å±æ€§(ä½†å¹¶ä¸æ„å‘³ç€ä¼šè¢«åƒåœ¾å›æ”¶, å› ä¸ºè¢«åˆ é™¤å¯¹è±¡å¯èƒ½ä¼šè¢«å…¶ä»–å¯¹è±¡å¼•ç”¨)

**å±æ€§ä¸å˜æ€§**

- é…ç½® `{configurable: false, writable: false}` å³å¯åˆ›å»ºå¸¸é‡å±æ€§
- è°ƒç”¨ `Object.preventExtensions()` å¯ä»¥è®©å¯¹è±¡æ— æ³•å†æ·»åŠ æ–°çš„å±æ€§(æ·»åŠ ä¼šé€ æˆé™é»˜å¤±è´¥, åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šé€ æˆ `typeError` )
- è°ƒç”¨ `Object.seal()` å¯ä»¥è®©å¯¹è±¡æ— æ³•å†æ·»åŠ /åˆ é™¤å±æ€§, æ— æ³•é‡å†™å±æ€§æè¿°ç¬¦
- è°ƒç”¨ `Object.freeze()` å¯ä»¥è®©å¯¹è±¡åœ¨ `seal` çš„åŸºç¡€ä¸Š `writable: false`. å¦‚éœ€å†»ç»“æ•´ä¸ªå¯¹è±¡, è¯¥éœ€è¦é€’å½’å†»ç»“æ¯ä¸ªå±æ€§, åŒæ—¶, å¼•ç”¨è¿™ä¸ªå±æ€§çš„æ‰€æœ‰å¯¹è±¡çš„è¯¥å±æ€§éƒ½ä¼šè¢«å†»ç»“

**getterä¸setter**

- è®¿é—®å¯¹è±¡çš„å±æ€§å®é™…ä¸Šæ˜¯åœ¨å¯¹è±¡ä¸Šçš„ `[[Get]]` æ–¹æ³•, é»˜è®¤çš„ `[[Get]]` æ–¹æ³•ä¼šå…ˆæŸ¥æ‰¾å¯¹è±¡ä¸Šæ˜¯å¦æœ‰è¯¥å±æ€§, è‹¥æ˜¯å¯¹è±¡ä¸Šæ²¡æœ‰è¯¥å±æ€§, `[[Get]]` å°±ä¼šé¡ºç€**åŸå‹é“¾**å‘ä¸ŠæŸ¥æ‰¾, éƒ½æ‰¾ä¸åˆ°åˆ™è¿”å› `	undefined`. **è¿™ä¸ä½œç”¨åŸŸçš„æŸ¥æ‰¾ä¸åŒ, ä½œç”¨åŸŸæŸ¥æ‰¾å¤±è´¥åä¼šå‘å¤–å±‚ä½œç”¨åŸŸæŸ¥æ‰¾, éƒ½æ‰¾ä¸åˆ°åˆ™æŠ›å‡º `Reference Error`**
- ä¸ºå¯¹è±¡è®¾ç½®å±æ€§ç­‰æ“ä½œä¼šå‡ºå‘ `[[put]]`, `[[put]]` ä¼šå…ˆæ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨, åœ¨æ£€æŸ¥æ˜¯å¦å®šä¹‰äº†å±æ€§æ ‡è¯†ç¬¦, è‹¥æ˜¯åˆ™ç›´æ¥è°ƒç”¨ `setter`, å†æ£€æŸ¥å±æ€§æ˜¯å¦æ˜¯ `writebale` çš„, å¦‚æœæ˜¯åˆ™ä¼šé€ æˆé™é»˜å¤±è´¥æˆ– `TypeError`, è‹¥ä¸æ˜¯åˆ™ä¼šè®¾ç½®å€¼
- å¯ä»¥åœ¨ `defineProperty` æ—¶æŒ‡å®š `getter` ä¸ `setter` æ¥æ›¿é»˜è®¤ `[[Get]]` ä¸ `[[Put]]`, **è‹¥å®šä¹‰äº† `getter` æ²¡æœ‰çš„å®šä¹‰ `setter`, åœ¨è®¾ç½®å±æ€§æ—¶ `[[Put]]` ä¸ä¼šèµ‹å€¼, è€Œæ˜¯ç›´æ¥å¿½ç•¥èµ‹å€¼ä¸”ä¸æŠ›å‡ºé”™è¯¯. æ‰€ä»¥æœ€é«˜æˆå¯¹å®šä¹‰ `getter/setter`**

**æŸ¥æ‰¾**

- `in` å¯ä»¥åˆ¤æ–­ `key` æ˜¯å¦åœ¨å¯¹è±¡æˆ–å…¶åŸå‹é“¾ä¸Š(åŒ…æ‹¬ä¸å¯æšä¸¾çš„å±æ€§)
- `hasOwnProperty` å¯ä»¥åˆ¤æ–­ `key` æ˜¯å¦åœ¨å¯¹è±¡ä¸Š, ä½†ä¸æ£€æŸ¥åŸå‹é“¾
- `for-in` å¯ä»¥éå†å¯¹è±¡ä¸Šçš„å¯æšä¸¾å…ƒç´ çš„ `key`
- `for-of` å¯ä»¥éå†æœ‰è¿­ä»£å™¨å¯¹è±¡ä¸Šçš„æ‰€æœ‰å€¼
- `Object.keys()` å¯ä»¥è¿”å›å¯¹è±¡ä¸Šçš„å¯æšä¸¾å…ƒç´ 
- `Object.getOwnPropertyNames()` å¯ä»¥è¿”å›å¯¹è±¡ä¸Šçš„æ‰€æœ‰å…ƒç´ 

### æ··å…¥

- æ˜¾å¼æ··å…¥

  ```js
  function mixin( sourceObj, targetObj ) {
  	for (var key in sourceObj) {
  		// ä»…æ‹·è´éæ—¢å­˜å†…å®¹
  		if (!(key in targetObj)) {
  			targetObj[key] = sourceObj[key];
  		}
  	}
  	return targetObj;
  }
  ```

- å¯„ç”Ÿç»§æ‰¿

  ```js
  // â€œä¼ ç»Ÿçš„ JS ç±»â€ `Vehicle`
  function Vehicle() {
  	this.engines = 1;
  }
  Vehicle.prototype.ignition = function() {
  	console.log( "Turning on my engine." );
  };
  Vehicle.prototype.drive = function() {
  	this.ignition();
  	console.log( "Steering and moving forward!" );
  };

  // â€œå¯„ç”Ÿç±»â€ `Car`
  function Car() {
  	// é¦–å…ˆ, `car` æ˜¯ä¸€ä¸ª `Vehicle`
  	var car = new Vehicle();

  	// ç°åœ¨, æˆ‘ä»¬ä¿®æ”¹ `car` ä½¿å®ƒç‰¹åŒ–
  	car.wheels = 4;

  	// ä¿å­˜ä¸€ä¸ª `Vehicle::drive()` çš„å¼•ç”¨
  	var vehDrive = car.drive;

  	// è¦†ç›– `Vehicle::drive()`
  	car.drive = function() {
  		vehDrive.call( this );
  		console.log( "Rolling on all " + this.wheels + " wheels!" );
  	};

  	return car;
  }

  var myCar = new Car();

  myCar.drive();
  // Turning on my engine.
  // Steering and moving forward!
  // Rolling on all 4 wheels!
  ```

- éšå¼æ··å…¥

  ```js
  var Something = {
  	cool: function() {
  		this.greeting = "Hello World";
  		this.count = this.count ? this.count + 1 : 1;
  	}
  };
  
  Something.cool();
  Something.greeting; // "Hello World"
  Something.count; // 1
  
  var Another = {
  	cool: function() {
  		// éšå¼åœ°å°† `Something` æ··å…¥ `Another`
  		Something.cool.call( this );
  	}
  };
  
  Another.cool();
  Another.greeting; // "Hello World"
  Another.count; // 1 (ä¸ä¼šå’Œ `Something` å…±äº«çŠ¶æ€)
  ```

### åŸå‹

**å°è¯•ç†è§£åŸå‹é“¾**

é¦–å…ˆè¦æ˜ç¡®, è™½ç„¶äººä»¬è‡´åŠ›äºé€šè¿‡è¯­æ³•ç³–è®©ç¨‹åºå‘˜åƒå†™ç±»ä¸€æ ·å†™ JavaScript çš„"ç±»"ä¸"ç»§æ‰¿". ä½†æ˜¯, å®é™…ä¸Š JavaScript çš„ç»§æ‰¿æ˜¯åŸºäºåŸå‹é“¾çš„.

åŸå‹æ˜¯ä¸ºå®ç°ç»§æ‰¿è€Œæå‡ºçš„, å¯ä»¥å°è¯•å°†å¯¹è±¡çš„åŸå‹ç†è§£æˆ**è¿™ä¸ªå¯¹è±¡æ˜¯åŸºäºä»€ä¹ˆæ ·å­çš„ç©æ„é­”æ”¹å‡ºæ¥çš„**. æ³¨æ„, åŸºäºä»€ä¹ˆ**æ ·å­çš„**ç©æ„, ä¸æ˜¯åŸºäº**ä»€ä¹ˆç©æ„**. ä»¥ä¸‹é¢è¿™ä¸ªç»§æ‰¿å…³ç³»ä¸ºä¾‹

```js
class Father {
  constructor() {
    this.f = 1;
  }
}

class Son extends Father {
  constructor() {
    super();
    this.s = 1;
  }
}
```

æœ€å¼€å§‹, æˆ‘ä»¥ä¸º, åŸå‹å°±æ˜¯å‘Šè¯‰å®ä¾‹å¯¹è±¡, ä»–æ˜¯åŸºäº**ä»€ä¹ˆç©æ„**æ„é€ å‡ºæ¥çš„.

å¦‚æœä¸è€ƒè™‘ç»§æ‰¿å…³ç³», å¯ä»¥è¿™ä¹ˆæƒ³è±¡ `Father` ä¸ `Son`

![](./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-2.png)

æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„æ¡†æ¡†, æ¡†ä¸­, å·¦è¾¹çš„åœ†æ˜¯æ„é€ å‡½æ•°, ä¸­é—´åŸå‹, å³è¾¹æ˜¯å…¶æ„é€ å‡ºçš„å®ä¾‹. æŒ‰ç…§åˆšåˆšçš„ç†è§£, åŸå‹æ˜¯ä¸€ä¸ªç¥ç§˜çš„ `object`, å½“æˆ‘ä»¬è¦æ„é€ å‡½æ•°çš„æ—¶å€™, åªéœ€è¦å°†æ‰§è¡Œ `æ„é€ å‡½æ•°.apply(åŸå‹)`, ç„¶åæˆ‘ä»¬å°±å¾—åˆ°äº†å®ä¾‹, çœ‹èµ·æ¥ä¸é”™. è¦æ˜¯çŸ¥é“åŸå‹æ˜¯ä»€ä¹ˆå°±å¥½äº†.

é‚£, å¦‚æœ `Son` çš„åŸå‹æ˜¯ `Father` çš„å®ä¾‹ä¼šæ€ä¹ˆæ ·å‘¢? ä¸é”™è¯¶! `Sonæ„é€ å‡½æ•°.apply(father)` å¾—åˆ° `son` çœ‹èµ·æ¥åˆæƒ…åˆç†!

![](./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-3.png)

å°†åŸå‹é“¾æ‰©å±•å®Œ. è¿˜æ˜¯å¾ˆæ£’! `Fatheræ„é€ å‡½æ•°.apply({})` å¾—åˆ° `father` çœ‹èµ·æ¥ä¹Ÿåˆæƒ…åˆç†! `Object.apply(ä¸€ä¸ªå¥‡æ€ªçš„ä¸œè¥¿)` å¾—åˆ° `{}` çœ‹èµ·æ¥ä¹Ÿåˆæƒ…åˆç†! è‡³äºè¿™ä¸ªå¥‡æ€ªçš„ä¸œè¥¿, æˆ‘ä»¬åªçŸ¥é“ä»–çš„ `__proto__` æ˜¯ `null`

![](./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-4.png)

ä¸–ç•Œçº¿æ”¶æŸäº†? ä¸å¯¹åŠ², è¿™ä¹ˆæˆ‘ä»¬åœ¨ç›´æ¥æ“ä½œåŸå‹å‘¢? è¿™ä¹ˆä¸€ä¸²æä¸‹æ¥, æˆ‘ä»¬ç›´æ¥é­”æ”¹äº† `Object` çš„åŸå‹ :(

å®é™…ä¸Šä¸æ˜¯è¿™æ ·çš„, åŸå‹æ˜¯ä¸€ä¸ªå¯¹è±¡, ä»–å°±åƒä¸€ä¸ªæŒ‡è·¯ç‰Œä¸€æ ·æè¿°äº†æ„é€ å‡½æ•°(`.constructor`)æ˜¯è°, åŸå‹é“¾çš„ä¸Šä¸€å±‚æ˜¯è°`.__proto__`, è¿™ä¸ªç±»ä¸Šæœ‰ä»€ä¹ˆæ–¹æ³•.

çœ‹çœ‹ `Son.prototype`

```js
constructor: class Son         // æ„é€ å‡½æ•°
[[Prototype]]: Object          // åŸå‹é“¾ä¸Šä¸€çº§
    constructor: class Father
    [[Prototype]]: Object
```

![](./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-5.png)

ä½†æ˜¯, å¯¹äºåˆ›å»ºå¯¹è±¡æ¥è®², è¿™è¶³å¤Ÿäº†! ä¸€æ—¦æˆ‘æ‹¥æœ‰äº†åŸå‹å¯¹è±¡, æˆ‘å°±çŸ¥é“äº†å…¶æ„é€ å‡½æ•°ä¸åŸå‹é“¾çš„å‰ä¸€çº§, åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™, æˆ‘é€’å½’è®©ä¸Šä¸€çº§å¸®æˆ‘åˆ›å»ºçˆ¶ç±»çš„å®ä¾‹, ç„¶åå°†å“ªä¸ªå®ä¾‹å–‚ç»™è¿™ä¸€çº§çš„æ„é€ å‡½æ•°, å¯¹è±¡åˆ›å»ºæˆåŠŸ

![](./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-6.png)

è¿™å°±è§£é‡Šäº† `Son.prototype.__proto__ === Father.prototyp`, åŸå‹é“¾å³ä½¿è¿™æ¡è“è‰²çš„é“¾è¡¨, çº¢è‰²çš„å°±æ˜¯å…¶æ„é€ çš„è¿‡ç¨‹:)

çœ‹èµ·æ¥æ²¡é—®é¢˜. ä½†æ˜¯, ä¸ºå•¥è¦æŠŠç±»ä¸Šçš„æ–¹æ³•å­˜å‚¨åœ¨åŸå‹ä¸Šå‘¢? å› ä¸ºè¿™æ ·æ‰€æœ‰çš„å­ç±»å°±è®¿é—®çˆ¶ç±»çš„åŒä¸€ä¸ªæ–¹æ³•. è¿™ä¸åŸºäºç±»çš„ç»§æ‰¿çš„å®ç°æ–¹æ³•ä¸å¤ªç›¸åŒ, ä½†æ˜¯ JavaScript æœ¬èº«å°±æ˜¯åŸºäºåŸå‹é“¾ç»§æ‰¿çš„è€Œä¸æ˜¯åŸºäºç±»ç»§æ‰¿çš„.

äºæ˜¯, è¿™ä¸ªç»å…¸çš„å›¾å°±å¯ä»¥ç†è§£äº†. æ— éå°±æ˜¯åŠ å…¥äº† **Object&Function æ—¢æ˜¯å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡** çš„æƒ³æ³•

![](./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-8.jpg)

**åŸºäºåŸå‹é“¾çš„ç»§æ‰¿**

- å·®å¼‚ç»§æ‰¿

  å›æƒ³ Java ç­‰åŸºäºç±»ç»§æ‰¿çš„è¯­è¨€. å­ç±»åœ¨å®ä¾‹åŒ–æ—¶åªä¼šæ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•°, å¹¶ä¸ä¼šå®ä¾‹åŒ–çˆ¶ç±», çˆ¶ç±»çš„å±æ€§å‡ä¼šå®ä¾‹åŒ–åœ¨å­ç±»ä¸Š.

  ä½†æ˜¯ JavaScript æ˜¯åŸºäºåŸå‹é“¾ç»§æ‰¿çš„, æ„é€ çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ä¸€å±‚ä¸€å±‚çš„çš„è°ƒç”¨æ„é€ å‡½æ•°å¹¶ä¸€å±‚ä¸€å±‚çš„æ„é€ å®ä¾‹. è¿™æ„å‘³ç€åœ¨æ„å»ºå­ç±»æ—¶çˆ¶å­ç±»å®ä¾‹éƒ½ä¼šè¢«åˆ›å»º, ç»§æ‰¿å…³ç³»åªæ˜¯åœ¨åŸå‹ä¸Šé€šè¿‡ `__proto__` ç»´æŠ¤å­å¯¹è±¡ä¸çˆ¶å¯¹è±¡çš„å…³è”, å­ç±»å®ä¾‹ä¸Šåªç»´æŠ¤å…¶ä¸çˆ¶ç±»çš„å·®å¼‚. ä¹Ÿç§°è¿™ç§ç»§æ‰¿ä¸ºå·®å¼‚ç»§æ‰¿.

- `prototype` ä¸å±è”½

  å¯¹è±¡çš„**èµ‹å€¼**ä¼šè§¦å‘ `[[Put]]` æ“ä½œ. `[[put]]` æŸ¥æ‰¾å¯¹è±¡å¤±è´¥åä¼šé¡ºç€å¯¹è±¡çš„åŸå‹é“¾æŸ¥æ‰¾æ ‡è¯†ç¬¦, äºæ˜¯äº§ç”Ÿäº†ä¸€äº›å¥‡æ€ªçš„è§„åˆ™.

  å‡è®¾æ‰§è¡Œ `foo.bar = 1`, ä¸” `foo` ä¸Šæ²¡æœ‰ `bar`

  - åŸå‹é“¾ä¸Šæ‰¾åˆ°äº†æ ‡è¯†ç¬¦ä¸”æ ‡è¯†ç¬¦ `writable: true`, **ä¼šç›´æ¥åœ¨ `foo` ä¸Šåˆ›å»º `bar`, ç„¶åèµ‹å€¼. ç§°å…¶ä¸ºå±è”½å±æ€§**(WTF!!)

  - åŸå‹é“¾ä¸Šæ‰¾åˆ°äº†æ ‡è¯†ç¬¦ä¸”æ ‡è¯†ç¬¦ `writable: false`, **ä¼šé™é»˜å¤±æ•ˆ, åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡ºé”™è¯¯**

  - åŸå‹é“¾ä¸Šæ‰¾åˆ°äº†æ ‡è¯†ç¬¦ä¸”æ ‡è¯†ç¬¦æœ‰ `setter`, ç›´æ¥åº”ç”¨ `setter`

  **ä¸Šé¢çš„è§„åˆ™éƒ½æ˜¯é’ˆå¯¹ `=` èµ‹å€¼çš„, ä½¿ç”¨ `Object.defineProperty()` å°±ä¸ä¼šäº§ç”Ÿè¿™äº›ç ´ç©æ„**

- ä»€ä¹ˆæ˜¯æ‰€è°“çš„æ„é€ å‡½æ•°

  å®é™…ä¸Š, æ„é€ å‡½æ•°å°±æ˜¯æ™®é€šå‡½æ•°, æ„é€ å‡½æ•°ä¹Ÿå¯ä»¥åƒæ™®é€šå‡½æ•°ä¸€æ ·è°ƒç”¨. ä½†æ˜¯ä¸€æ—¦å‡½æ•°å‰é¢åŠ ä¸Šäº† `new`, `new` ä¼šåŠ«æŒæ™®é€šå‡½æ•°å¹¶å°†å…¶å½“ä½œæ„é€ å‡½æ•°è°ƒç”¨

- åŸå‹ä¸Šçš„ `constructor`

  ```js
  function C1() {
    this.v = 1;
  }

  function C2() {
    this.v = 2;
  }

  C2.prototype = C1.prototype;

  const c = new C2();
  console.log(c); // C1 { v: 2 }
  console.log(c.constructor === C2); // false
  console.log(c.constructor === C1); // true
  ```

  å¯¹è±¡ä¸Šçš„ `constructor` å¹¶ä¸æ˜¯å¯¹è±¡çš„æ„é€ è€…, å› ä¸º `constructor` æ˜¯åœ¨å¯¹è±¡çš„åŸå‹ä¸Š, `constructor` åŸå‹çš„æ„é€ å‡½æ•°

- æ‰‹åŠ¨åŸå‹ç»§æ‰¿

  è¿™æ˜¯ä¸€äº›ç»§æ‰¿æ–¹æ¡ˆ

  ```js
  function C1() {
    this.x = 1;
  }
  
  C1.prototype.sayC1 = () => {
    console.log('IM C1');
  };
  
  function C2() {
    C1.call(this); // å°†C1çš„å˜é‡å®šä¹‰ç»§æ‰¿åˆ°äº†C2
    this.y = 2;
  }
  
  C2.prototype = Object.create(C1.prototype); // ğŸ‘ å°†C1çš„æ–¹æ³•ç»§æ‰¿åˆ°C2å¯è¡Œæ–¹æ¡ˆ1(ES6å‰)
  // Object.setPrototypeOf(C2.prototype, C1.prototype); // ğŸ‘ å°†C1çš„æ–¹æ³•ç»§æ‰¿åˆ°C2å¯è¡Œæ–¹æ¡ˆ2(ES6)
  // C2.prototype = C1.prototype; // ğŸ‘é”™è¯¯æ–¹æ¡ˆ1
  // C2.prototype = new C1(); // ğŸ‘é”™è¯¯æ–¹æ¡ˆ2
  
  C2.prototype.sayC2 = () => {
    console.log('IM C2');
  };
  
  const c = new C2();
  console.log(c); // C1 { x: 1, y: 2 }
  c.sayC1(); // IM C1
  c.sayC2(); // IM C2
  ```

  ç»§æ‰¿å˜é‡æ²¡å¾—è¯´, ç›´æ¥ `apply()` å°±è¡Œ, ä½†æ˜¯æœ‰å››ä¸ªç»§æ‰¿æ–¹æ³•çš„æ–¹æ¡ˆ

  - `C2.prototype = Object.create(C1.prototype);` è¿™æ˜¯åœ¨ES6ä¹‹å‰çš„æ–¹æ¡ˆ

    `Object.create()` æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡, å¹¶ä½¿ç”¨å‚æ•°å¯¹è±¡æ¥ä½œä¸ºæ–°åˆ›å»ºå¯¹è±¡çš„åŸå‹

    ä¸€ä¸ªç®€æ˜“çš„ `create` å®ç°

    ```js
    function create(o) {
      function F() {}
      F.prototype = o;
      return new F();
    }
    ```

  - `Object.setPrototypeOf(C2.prototype, C1.prototype);`: `ES6` æ–°å¢çš„è§£å†³æ–¹æ¡ˆ

  - `C2.prototype = C1.prototype;` ä¼šé€ æˆä¿®æ”¹ `C2.prototype` æ—¶ç›´æ¥ä¿®æ”¹äº† `C1.prototyoe`

    ```js
    function C1() {
      this.x = 1;
    }

    C1.prototype.say = () => {
      console.log('IM C1');
    };

    function C2() {
      C1.call(this); // å°†C1çš„å˜é‡å®šä¹‰ç»§æ‰¿åˆ°äº†C2
      this.y = 2;
    }

    C2.prototype = C1.prototype;
    C2.prototype.say = () => {
      console.log('IM C2');
    };

    const c1 = new C1();
    const c2 = new C2();

    c1.say(); // IM C2
    c2.say(); // IM C2
    ```

  - `C2.prototype = new C1();` ä¸æ¨èè¿™ä¸ªæ–¹æ³•, åŸå› æ˜¯

    - `C2` çš„åŸå‹ä¸Šä¼šæœ‰ `C1` çš„å˜é‡
    - è°ƒç”¨ `new C1()` æ„é€ å‡½æ•°å¯èƒ½äº§ç”Ÿå‰¯ä½œç”¨(å¦‚ä¿®æ”¹å…¨å±€å˜é‡)

    å¦‚ä¸‹æ˜¯ä¸¤è€…å¯¹æ¯”

    ```js
    C1 (C2.prototype = Object.create(C1.prototype)ç‰ˆ)
      [[Prototype]]: Object
        sayC1: () => {   console.log('IM C1'); }
        constructor: Æ’ C1()
        [[Prototype]]: Object
    C1 (C2.prototype = new C1()ç‰ˆ)
      x: 1
      [[Prototype]]: Object
        sayC1: () => {   console.log('IM C1'); }
        constructor: Æ’ C1()
        [[Prototype]]: Object
    ```

**å¯¹è±¡å…³è”**

é€šè¿‡ç»§æ‰¿å¯ä»¥è®©ä¸¤ä¸ªå¯¹è±¡å…³è”èµ·æ¥. å¦‚æœåªæ˜¯æƒ³å®ç°è·¨å¯¹è±¡è°ƒç”¨æ–¹æ³•, è¿™å°±æ˜¾å¾—æ¯”è¾ƒéº»çƒ¦äº†(å› ä¸ºè¦ç»´æŠ¤ `constructor/__proto__`), æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ `Object.create()` å®ç°ä¸¤ä¸ªå¯¹è±¡çš„å…³è”. å®ç°å…³è”åæœ€å¥½ä¸è¦ä½¿ç”¨å¤–éƒ¨å§”æ‰˜çš„è°ƒç”¨æ¨¡å¼, å³

```js
const foo = {
    sayF(){}
}

const bar = Object.create(foo)
bar.sayF() // å¤–éƒ¨å§”æ‰˜
```

è€Œæ˜¯é‡‡ç”¨å†…éƒ¨å§”æ‰˜

```js
const foo = {
    sayF(){}
}

const bar = Object.create(foo)
bar.doSayF = function(){
    this.sayF(); // å†…éƒ¨å§”æ‰˜
}
bar.doSayF();
```

è¿™æ ·å¯ä»¥æé«˜ä»£ç å¯è¯»æ€§ä¸å®‰å…¨æ€§



### é¢å‘å§”æ‰˜ä¸é¢å‘å¯¹è±¡çš„è®¾è®¡

- ä¼ ç»Ÿçš„OOPç¼–ç¨‹: é¼“åŠ±åœ¨ç»§æ‰¿æ—¶ä½¿ç”¨æ–¹æ³•é‡å†™(å’Œå¤šæ€)è¦†ç›–çˆ¶ç±»æ›´åŠ æŠ½è±¡çš„æ–¹æ³•

- å§”æ‰˜ç¼–ç¨‹: è¦æ±‚å°†ä¸¤ä¸ªå¯¹è±¡å½“ä½œåä½œçš„å…„å¼Ÿ, å½“æŸä¸ªå¯¹è±¡ä¸Šæ²¡æœ‰æ–¹æ³•æ—¶ä¼šè¦æ±‚å¦ä¸€ä¸ªå¯¹è±¡å¸®å¿™å®ç°, æ­¤å¤–å§”æ‰˜ç¼–ç¨‹è¿˜æœ‰ä¸€äº›ç‰¹ç‚¹

  - å˜é‡ç›´æ¥å­˜å‚¨åœ¨å§”æ‰˜ä¸Š: å› ä¸ºè¢«å§”æ‰˜è€…åªæ˜¯å°†åŸå‹ä¸Šçš„å±æ€§è¿æ¥åˆ°äº†å§”æ‰˜è€…, ä¸ä¼šå¸¦è¢«å§”æ‰˜è€…çš„å±æ€§
  - è¢«å§”æ‰˜è€…æ–¹æ³•åˆ›å»ºçš„å˜é‡ä¼šç›´æ¥å­˜åœ¨å§”æ‰˜è€…ä¸Š: è°ƒç”¨æ—¶å€™ä¸€èˆ¬æ˜¯ `å§”æ‰˜è€….æ–¹æ³•()`, æ­¤æ—¶ `this` è¢«éšå¼ç»‘å®šåœ¨äº†å§”æ‰˜è€…ä¸Š
  - ä¸é¼“åŠ±é‡å†™æ–¹æ³•, é¼“åŠ±åœ¨å§”æ‰˜è€…èº«ä¸Šå®šä¹‰æ›´åŠ å…·æœ‰æè¿°æ€§çš„æ–¹æ³•å: JavaScript çš„åŸå‹é“¾`[[put]]` æœºåˆ¶è®©é‡å†™å¾ˆéº»çƒ¦
  - ä¸å…³æ³¨ç±»ä¸ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è€Œæ˜¯å…³å¿ƒå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å€Ÿç”¨å…³ç³»(æ‹¿æ¥å§ä½ ğŸ–)
  - ä¸å¾—å¾ªç¯å§”æ‰˜

  **åç±»åŒ–**

  æœ‰çš„æ—¶å€™, æˆ‘ä»¬ä¸éœ€è¦ç±», åªæ˜¯éœ€è¦ç±»ä¸Šçš„æ–¹æ³•, æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨ç”¨å§”æ‰˜æœºåˆ¶åœ¨ä¸å®ä¾‹åŒ–çˆ¶ç±»çš„æƒ…å†µä¸‹ä½¿ç”¨ç±»ä¸Šçš„æ–¹æ³•

  **å†…çœ**

  æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°çš„å®ä¾‹

  ```js
  function Foo(){/*...*/}
  Foo.prototype...
  
  function Bar(){/*...*/}
  Bar.prototype = Object.create(Foo.prototype);
  var b1 = new Bar("b1");
  
  // è®©Fooå’ŒBaräº’ç›¸å…³è”
  Bar.prototype instanceof Foo;// true
  Object.getPrototypeOf(Bar.prototype) === Foo.prototype; //true
  Foo.prototype.isPrototypeOf(Bar.prototype);// true
  
  // è®©b1å…³è”åˆ°Fooå’ŒBar
  b1 instanceof Foo;// true
  b1 instanceof Bar;// true
  Object.getPrototypeOf(b1) === Bar.prototype; //true
  Foo.isPrototypeOf(b1);// true
  Bar.isPrototypeOf(b1);// true
  ```

  è¿˜æœ‰ä¸€ç§æ›´åŠ è„†å¼±çš„å†…çœæ¨¡å¼ï¼Œä½†æ˜¯åœ¨å¼€å‘è€…ä¸Šé¢ç”¨çš„å¾ˆå¤š

  ```js
  if(a1.something){
  	a1.somethinf();
  }
  ```

  ### `ES6` çš„ `class` è¯­æ³•

  **ä¼˜ç‚¹**:

  - é€šè¿‡ `supper` åŸºæœ¬æœç»äº† `prototype`, å¹¶å®ç°äº†å¤šæ€
  - ç®€æ´çš„ç»§æ‰¿å®šä¹‰
  - ä¸èƒ½å£°æ˜å±æ€§, åªèƒ½å£°æ˜æ–¹æ³•

  **ç¼ºç‚¹**

  - åè¯æ³•

      ```js
      var LoginController = {
        errors: [],
        getUser() { // æ— éœ€function
        }
      };
      ```

      è¿™æ˜¯ä¸ªè¯­æ³•ç³–, ç¼–è¯‘åå˜ä¸º

      ```js
      var AuthController = {
        errors: [],
        getUser: () => {
        },
      };
      ```

      ç¼–è¯‘å `getUser` å¼•ç”¨äº†ä¸€ä¸ªåŒ¿åå‡½æ•°, è¿™æ„å‘³ç€

      1. ä½¿è°ƒè¯•æ—¶çš„æ ˆè¿½è¸ªå˜å¾—å›°éš¾
      2. ä½¿è‡ªå¼•ç”¨ï¼ˆé€’å½’ï¼Œäº‹ä»¶ç»‘å®šç­‰ï¼‰å˜å¾—å›°éš¾
      3. ä½¿ä»£ç ï¼ˆç¨ç¨ï¼‰å˜å¾—éš¾äºç†è§£

  - å­˜åœ¨å˜é‡åä¸æ–¹æ³•åä¹‹é—´çš„å±è”½, `supper` é€ æˆçš„éšå¼å±è”½

  - å¯ä»¥é€šè¿‡ä¿®æ”¹ `prototype` çš„æ–¹æ³•åœ¨ `class` å®šä¹‰åä¿®æ”¹ `class` å®šä¹‰

## ç±»å‹ä¸è¯­æ³•

### ç±»å‹

JavaScript æ˜¯æœ‰ç±»çš„, ä½†æ˜¯ JavaScript æ˜¯ä¸€ä¸ªåŠ¨æ€è‹¥ç±»å‹è¯­è¨€, æˆ‘ä»¬æ²¡æ³•è¯´å˜é‡å±äºä»€ä¹ˆç±»å‹, åªèƒ½è¯´å˜é‡å¯¹åº”çš„å€¼æ˜¯ä»€ä¹ˆç±»å‹çš„.

å†…ç½®ç±»å‹æœ‰ `null, undefined, boolean, number, string, object, symbol`, å¯ä»¥ç”¨ `typeof` åˆ¤æ–­å€¼çš„ç±»å‹

`typeof` åˆ¤æ–­ç±»å‹æ˜¯å­˜åœ¨éƒ¨åˆ†ç‰¹ä¾‹

- `typeof null === 'object'`, è¿™æ˜¯ JavaScript çš„ä¸€ä¸ªå° bug. è‹¥ç¡®å®éœ€è¦æ£€æµ‹ `null` å¯ä»¥ä½¿ç”¨ `!foo && typeof foo === 'object'` åˆ¤å®š

- `typeof function () {} === 'function'`, è™½ç„¶å‡½æ•°æ˜¯ `Object` çš„å­ç±», ä½†æ˜¯ `typeof` ä¼šç‰¹æ®Šçš„è¿”å›`function` è€Œä¸æ˜¯ `object`. åŒæ—¶, å‡½æ•°çš„ `length` æ˜¯å…¶å½¢å‚çš„æ•°é‡, å½¢å‚çš„æ•°é‡ä¸åŒ…æ‹¬å‰©ä½™å‚æ•°ä¸ªæ•°ï¼Œä»…åŒ…æ‹¬ç¬¬ä¸€ä¸ªå…·æœ‰é»˜è®¤å€¼ä¹‹å‰çš„å‚æ•°ä¸ªæ•°ã€‚

  ```js
  function fun1(a) {} // fun1.length = 1
  function fun2(a, b) {} // fun2.length = 2
  function fun3(a, b, c) {} // fun3.length = 3
  function fun4(a, b, c, d = 1) {} // fun4.length = 3
  function fun5(...args) {} // fun5.length = 0
  function fun6(a = 1, b, c, d) {} // fun6.length = 0
  ```

- `typeof æœªå®šä¹‰å€¼ === 'undefined'`

**`undefined` ä¸ `undeclared`**

- å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªå·²å®šä¹‰ä½†æ˜¯æ²¡æœ‰èµ‹å€¼çš„å˜é‡æ—¶, ä¼šè¿”å› `undefined`
- å½“æˆ‘ä»¬è¿”å›ä¸€ä¸ªæ²¡æœ‰å®šä¹‰çš„(undeclared) å€¼æ—¶,
  - è‹¥åœ¨æ˜¯è®¿é—®å¯¹è±¡ä¸Šçš„æ ‡è¯†ç¬¦, ä¼šè¿”å› `undefined`, (å¯¹è±¡ä¸Š `[[Get]]` çš„ä¿æŠ¤æœºåˆ¶)
  - å¦åˆ™æŠ›å‡º `ReferenceError`

ä½†æ˜¯ `typeof` çš„ä¿æŠ¤æœºåˆ¶ä¼šè®© `undefined` ä¸ `undeclared` å‡è¿”å› `undefined`

```js
let a;
console.log(typeof a); // undefined
console.log(typeof b); // undefined
```

è¿™ç§ä¿æŠ¤æœºåˆ¶å¯ä»¥è®©æˆ‘ä»¬è½»æ¾çš„åˆ¤æ–­å…¨å±€ä½œç”¨åŸŸä¸Šæ˜¯å¦æœ‰æŸä¸ªå±æ€§, æ–¹ä¾¿å¤–éƒ¨ JavaScript æ¨¡å—åŠ è½½æ—¶æ£€æµ‹å…¨å±€ç¯å¢ƒ, å®ç°é€‰æ‹©æ€§åŠ è½½

```js
if (typeof foo) {
  foo = function () {};
}
```

**`void`å…³é”®å­—**

`void` è¡¨è¾¾å¼æ°¸è¿œè¿”å› `undefined` å€¼, ä¾‹å¦‚

```js
console.log(void true); // undefined
console.log(void setInterval(() => {}, 1000)); // undefined
```

**`undefined` ä¸ `null`**

ä¸€èˆ¬ç”¨ `null` è¡¨ç¤ºç©ºå€¼, ç”¨ `undefined` è¡¨ç¤ºæ²¡æœ‰å€¼.

æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯: **`null` æ˜¯ä¸€ä¸ªå…³é”®å­—, ä½†æ˜¯ `undefined` åªæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦, ä»–çš„å€¼é»˜è®¤ä¸ºundefined**, æ‰€ä»¥ä»¥ä¸‹ä»£ç æ˜¯æˆç«‹çš„

```js
const undefined = 1;
const demo = {};
console.log(undefined); // 1
console.log(demo.t); // undefined
console.log(demo.t === undefined); // false, å› ä¸º undefined æ ‡è¯†ç¬¦å¯¹åº”çš„ä¸æ˜¯ undefined å€¼
console.log(demo.t === void 0); // true, å› ä¸º void 0 è¿”å›çš„æ˜¯ undefined å€¼
```

### å€¼

- æ•°ç»„

  - åˆ é™¤å…ƒç´ : `delete a[1] / a.splice(1,1);`ä¼ªæ•°ç»„è½¬æ•°ç»„

    å¸¸è§çš„ä¼ªæ•°ç»„æœ‰ `DOMList`, `arguments`, ä¼ªæ•°ç»„æ²¡æœ‰æ•°ç»„ä¸Šçš„éƒ¨åˆ†æ–¹æ³•, è½¬æ¢æ–¹æ³•ä¸º(å‡è®¾ `foo -> bar`)

    - éå†ä¼ªæ•°ç»„å…ƒç´ 
    - `bar = Array.prototype.slice.call(foo);`
    - `bar = Array.from(foo);`
    - `bar = [...foo];`

- å­—ç¬¦ä¸²

  å­—ç¬¦ä¸²ä¸æ˜¯å­—ç¬¦æ•°ç»„, ä¸¤è€…èº«ä¸Šçš„æ–¹æ³•æœ‰å·®å¼‚

  - å­—ç¬¦ä¸²ä¸å¯å˜

    - å­—ç¬¦ä¸²çš„å€¼ä¸å¯è¢«å¤–éƒ¨ä¿®æ”¹

        ```js
        let s = '123';
        s[1] = 0;
        console.log(s); // '123'

        let a = [...'123'];
        a[1] = '0';
        console.log(a); // ['1', '0', '3']
        ```

    - å­—ç¬¦ä¸²ä¸Šçš„æ–¹æ³•ä¸å¾—ä¿®æ”¹å­—ç¬¦ä¸²çš„å€¼(æ¢è€Œè¨€ä¹‹, è°ƒç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•åªä¼šè¿”å›æ–°å€¼, è€Œä¸ä¼šä¿®æ”¹å­—ç¬¦ä¸²åŸå€¼)

  - å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨éƒ¨åˆ†å­—ç¬¦æ•°ç»„çš„æ–¹æ³•:

    - å­—ç¬¦ä¸²å¯ä»¥é€šè¿‡ `Array` åŸå‹æ–¹æ³•è®¿é—® `Array.prototype.reverse.call(s)`

    - è‹¥è®¿é—®çš„æ–¹æ³•ä¼šä¿®æ”¹åŸå­—ç¬¦ä¸², é‚£ä¹ˆè¯¥æ–¹æ³•å°†æ— æ³•è°ƒç”¨

      ```js
      const s = '123';
      Array.prototype.reverse.apply(s); // TypeError: Cannot assign to read only property '0' of object '[object String]'
      ```

      å¯ä»¥å…ˆå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°ç»„åœ¨è°ƒç”¨æ–¹æ³•æœ€åè½¬å›

- æ•°å­—

  JavaScript åªæœ‰æ•°å­—ä¸€ä¸ªç±»å‹, æ²¡æœ‰æ‰€è°“æ•´æ•°å°æ•°ä¹‹åˆ†. æ•°å­—å…¨éƒ¨ä½¿ç”¨ IEEE 754 çš„ 64 ä½ç‰ˆæœ¬å®ç°

  - ç®€å†™è§„åˆ™

    åœ¨ä¹¦å†™å­—é¢é‡æ—¶, å¯ä»¥çœç•¥å‰å¯¼ä¸åç»§ `0`, ä¾‹å¦‚ `0.12 === .12`, `12.0 === 12.`

    å—ç®€å†™è§„åˆ™å½±å“, éƒ¨åˆ†æ–¹æ³•è°ƒç”¨æ˜¯æ— æ•ˆçš„

    ```js
    (12).toFixed(); // ğŸ‘ æœ‰æ•ˆ
    0.12.toFixed(); // ğŸ‘ æœ‰æ•ˆ, ç¬¬äºŒä¸ªç‚¹ä¸å¯èƒ½æ˜¯å°æ•°ç‚¹
    12.toFixed(); // ğŸ‘ æ— æ•ˆ, JSä¼šå…¶ä¸º (12.)toFixed
    12..toFixed(); // ğŸ‘ æœ‰æ•ˆ, ç¬¬ä¸€ä¸ªç‚¹æ˜¯ç®€å†™, ç¬¬äºŒä¸ªç‚¹æ˜¯é“¾å¼è°ƒç”¨
    12 .toFixed(); // ğŸ‘ æœ‰æ•ˆ, æ³¨æ„æ•°å­—ä¸ç‚¹ä¹‹é—´æœ‰ç©ºæ ¼
    ```

  - æ ¼å¼åŒ–æ–¹æ³•

    - `toFixed` æŒ‡å®šå°æ•°ä½æ•°

      ```js
      var a = 42.59;

      a.toFixed( 0 ); // "43"
      a.toFixed( 1 ); // "42.6"
      a.toFixed( 2 ); // "42.59"
      a.toFixed( 3 ); // "42.590
      ```

    - `toPrecision` æŒ‡å®šæœ‰æ•ˆä½æ•°

      ```js
      var a = 42.59;
      
      a.toPrecision( 1 ); // "4e+1"
      a.toPrecision( 2 ); // "43"
      a.toPrecision( 3 ); // "42.6"
      a.toPrecision( 4 ); // "42.59"
      a.toPrecision( 5 ); // "42.590"
      ```

  - è¿ç®—è¯¯å·®: JavaScript è‡ªå¸¦ `Number.EPSILON` ä½œä¸ºè¿ç®—è¯¯å·®, è¿™ä¸ªå€¼ä¸€èˆ¬ä¸º $2^{-52}-1$

  - æ•´æ•°æ£€æµ‹: `Number.isInteger / Number.isSafeInteger` å¯åˆ†åˆ«ç”¨äºæ•´æ•°, å®‰å…¨æ•´æ•°æ£€æµ‹

  - å‚ä¸ä½è¿ç®—: è™½ç„¶ IEEE 754 å…è®¸æœ€å¤§å®‰å…¨æ•´æ•°ä¸º $2^{53}-1$, ä½†æ˜¯, åœ¨æ‰§è¡Œä½è¿ç®—æ—¶, åªæœ‰å 32 ä½æ•°ä¼šå‚ä¸è¿ç®—, å…¶ä½™ä½å°†è¢«å¿½ç•¥. å€ŸåŠ©æ­¤ç‰¹æ€§, å¯ä»¥é€šè¿‡ `a | 0` å°† `a` è½¬ä¸º 32 ä½æ•´æ•°

  - `NaN`: `NaN` æ˜¯ä¸€ä¸ªæ•°å€¼ç±»å‹, ä½†ä¸æ˜¯æ•°å­—. å½“å‡ºç° Number è¿ç®—ç»“æœæ— æ³•è¿”å›æ•°å­—æ—¶å°±ä¼šè¿”å› `NaN`. æ‰€ä»¥, `NaN` å¯ä»¥ç”¨æ¥æç¤ºæ•°å€¼è¿ç®—å‡ºé”™

    `NaN !== NaN`, è¿™æ˜¯ JavaScript å”¯ä¸€è‡ªå·±ä¸è‡ªå·±ä¸ç­‰çš„å…ƒç´ . åˆ¤æ–­ `NaN` å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•

    - `Number.isNaN(a)`: åˆ©ç”¨ ES6 çš„æ–°æ–¹æ³•åˆ¤æ–­ `a` æ˜¯ä¸æ˜¯ `NaN`
    - `a !== a;`: åå‘åˆ©ç”¨å…¶åè‡ªåçš„ç‰¹æ€§åˆ¤æ–­ `a` æ˜¯ä¸æ˜¯ `NaN`
    - `Object.is(NaN, a)`: åˆ©ç”¨æ–°æ–¹æ³•åˆ¤æ–­ `a` æ˜¯ä¸æ˜¯ `NaN` (åé¢è§£é‡Šå®ç°)

  - `0 & -0`

    éƒ¨åˆ†åœºæ™¯éœ€è¦ä½¿ç”¨è´Ÿå·è¡¨ç¤ºæ–¹å‘, JavaScript ä¸­æœ‰ `0` ä¸ `-0`.

    - `-0 === 0`

    - å¯ä»¥é€šè¿‡å­—é¢é‡, éåŠ å‡çš„è¡¨è¾¾å¼, ç±»å‹è½¬æ¢äº§ç”Ÿ `-0`

    - `-0` è½¬ä¸ºå­—ç¬¦ä¸²åä¼šå¤±å»è´Ÿå·

      ```js
      console.log(-0 + ''); // 0
      console.log((-0).toString()); // 0
      console.log(String(-0)); // 0
      ```

    - `'-0'` å­—ç¬¦ä¸²è½¬ä¸ºéå­—ç¬¦ä¸²æ—¶ä¼šä¿ç•™è´Ÿå·

      ```js
      console.log(+'-0');
      console.log(Number('-0'));
      console.log(JSON.parse('-0'));
      ```

    - åˆ¤å®š `-0`

      - æ‰‹åŠ¨å®ç°æ–¹æ³•

        ```js
        function isNegZero(v) {
          const n = Number(v);
          return v === 0 && 1 / v === -Infinity;
        }
        ```

      - `Object.is(-0, a)`: åˆ©ç”¨æ–°æ–¹æ³•åˆ¤æ–­ `a` æ˜¯ä¸æ˜¯ `-0`

        è¿™ä¸ª `is` æ–¹æ³•çœ‹èµ·æ¥å¾ˆç¥å¥‡, å…¶å®å°±æ˜¯ç‰¹åˆ¤äº† `NaN` ä¸ `-0` çš„ `===`

  - `Infinity`

    è®¾æœ‰é™æ­£æ•° `a`

    - ä¸æœ‰é™æ•°åŠ å‡æ³•: `Infinity (+/-) a === Infinity`
    - ä¸ `Infinity` åŠ å‡æ³•: `Infinity - Infinity === NaN`, `Infinity - -Infinity === Infinity`
    - ä¸æœ‰é™é0æ•°ä¹˜é™¤æ³•: `Infinity (*//) a === Infinity`, `Infinity (*//) -a === -Infinity`
    - ä¸0ä¹˜é™¤æ³•: `a/0 === Infinity`, `-a/0 === -Infinity`, `Infinity / 0 === Infinity`, `Infinity * 0 = NaN`,
    - ä¸ `Infinity` ä¹˜é™¤æ³•: `Infinity * Infinity === Infinity`, `Infinity / Infinity === NaN`

### åŸç”Ÿå‡½æ•°

åœ¨å†™ TS æ—¶ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜, æè¿°ç±»å‹çš„æ—¶å€™åº”è¯¥ç”¨å°å†™(å¦‚: `string`), è€Œä¸èƒ½ç”¨å¤§å†™(å¦‚: `String`), å› ä¸ºå¤§å†™çš„æ˜¯æ„é€ å‡½æ•°.

JavaScript å†…å»ºçš„å‡½æ•°(åŸç”Ÿå‡½æ•°)æœ‰: `String, Number, Boolean, Array, Object, Function, RegExp, Date, Error, Symbol`.

**å°è£…**

- å¯¹äºåŸºæœ¬ç±»å‹é `Object` ç±»å‹(`String, Number, Boolean, Symbol`)çš„å€¼

  åŸºæœ¬ç±»å‹å€¼ä¸é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºçš„å€¼ä¸åŒ. é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºçš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡

  ```js
  const s1 = 'aaa';
  const s2 = new String('aaa');
  console.log(s1); // aaa
  console.log(s2); // [String: 'aaa']
  console.log(s1 === s2); // false
  ```

  åŒæ—¶å¯¹è±¡æ°¸è¿œä¸º `true`

  ```js
  const b1 = false;
  const b2 = new Boolean(false);
  console.log(!!b1); // false
  console.log(!!b2); // true
  console.log(b1 === b2); // false
  console.log(b1 == b2); // true
  ```

  çœ‹èµ·æ¥åŸºæœ¬ç±»å‹å€¼ä¸å¯¹è±¡è¿˜æ˜¯æœ‰åŒºåˆ«çš„, å¯¹è±¡ä¸­å°è£…äº†åŸºæœ¬ç±»å‹å€¼. åŸºæœ¬ç±»å‹å€¼æœ¬èº«åªæ˜¯ä¸€ä¸ªåŸºæœ¬ç±»å‹å€¼, ä¸Šé¢æ²¡æœ‰æ–¹æ³•(å¦‚: `s.length`), ä½†æ˜¯å½“åŸºæœ¬ç±»å‹å€¼è¦è®¿é—®å…¶å¯¹åº”åŸç”Ÿå‡½æ•°å¯¹è±¡ä¸Šçš„æ–¹æ³•æ—¶, **JavaScript ä¼šè‡ªåŠ¨å°†åŸºæœ¬ç±»å‹å€¼å°è£…ä¸ºå¯¹è±¡**. å°è£…ä¸ºå¯¹è±¡å½“ç„¶è¦è€—è´¹æ—¶é—´, ä½†æ˜¯**ä¸è¦ä¸ºæ­¤æ•…æ„å°†å­—é¢é‡å£°æ˜ä¸ºå¯¹è±¡**, JavaScript å¼•æ“ä¼šå¯¹ä»£ç åšæ€§èƒ½è°ƒä¼˜å¹¶å†³å®šåœ¨ä»€ä¹ˆæ—¶å€™å°è£…å¯¹è±¡.

- å¯¹äºåŸºæœ¬ç±»å‹ä¸º `Object` ç±»å‹(`Array, Object, Function, RegExp, Date, Error`)çš„å€¼

  ä½¿ç”¨å­—é¢é‡åˆ›å»º(å¦‚æœå¯ä»¥)ä¸ä½¿ç”¨å‡½æ•°åˆ›å»ºæ˜¯å®Œå…¨ä¸€æ ·çš„

  - `Array`

    - åˆ›å»º `Array` æ—¶å¯ä»¥ä¸å¸¦ `new`

    - é€šè¿‡ `Array(n)` å¯ä»¥åˆ›å»ºåŒ…å« `n` ä¸ªç©ºå€¼(`empty item`)çš„æ•°ç»„

    - ç›´æ¥æ”¹å¤§æ•°ç»„çš„ `length` ä¼šå¯¼è‡´äº§ç”Ÿç©ºå€¼

    - ç©ºå€¼ä¸æ˜¯ `undefined`, ä¸åŒå‡½æ•°å¯¹ç©ºå€¼ä¸ `undefined` çš„å¤„ç†ä¸åŒ
      ```js
      const a = new Array(3);
      const b = [undefined, undefined, undefined];
    
      console.log(a.join('-')); // --
      console.log(b.join('-')); // --
    
      console.log(a.map((d, i) => i)); // [ <3 empty items> ]
      console.log(b.map((d, i) => i)); // [ 0, 1, 2 ]
      ```

      `join` ä¸è€ƒè™‘ç©ºå€¼çš„å­˜åœ¨, ç›´æ¥é€šè¿‡ `arr.length` éå†æ¯ä¸ªå…ƒç´ . è€Œ `map` åœ¨å¤„ç†ç©ºå€¼æ—¶ä¼šç›´æ¥è·³è¿‡ç©ºå€¼

      åº”æ­¤, `Array(n)` åˆ›å»ºçš„ç©ºå€¼æ•°ç»„æ˜¯å±é™©çš„, å¯ä»¥ä½¿ç”¨ `Array.apply(null, { length: n })` åˆ›å»ºé•¿åº¦ä¸º `n` çš„ `[undefined...]` æ•°ç»„

  - `Object, Function, RegExp`

    - ä¸å»ºè®®ä½¿ç”¨æ„é€ å‡½æ•°æ„é€ è¿™äº›å¯¹è±¡, å¯ä»¥ç›´æ¥ä½¿ç”¨`{}, function, //` æ„å»º
    - å¯¹äºéœ€è¦ä¿®æ”¹çš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨ `RegExp` æ„å»º(ä½†æ˜¯ `RegExp` çš„æ•ˆç‡ä¸åŠ `//`)

  - `Date, Error`

    - æ— æ³•ç”¨å­—é¢é‡åˆ›å»ºè¿™äº›å€¼
    - `new Date()` ä¸å¸¦å‚æ•°é»˜è®¤ä½¿ç”¨å½“å‰æ—¶é—´
    - ä¸å¸¦ `new` çš„ `Date()` æ— è®ºå‚æ•°å¦‚ä½•, éƒ½è¿”å›æ—¥æœŸå­—ç¬¦ä¸²
    - è‹¥åªæ˜¯æƒ³è·å¾—å½“å‰æ—¶é—´æˆ³å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³• `Date.now()`
    - åˆ›å»º `Error` æ—¶å¯ä»¥ä¸å¸¦ `new`

- å°è£…å¯¹è±¡çš„ `[[class]]`: æ‰€æœ‰ `typeof` è¿”å› `object` çš„å˜é‡ä¸Šé¢éƒ½æœ‰ä¸€ä¸ª `[[class]]`, è¡¨ç¤ºå¯¹è±¡çš„"å­ç±»å‹"

  ```js
  function f() {}
  const n = new Number(1);
  const b = new Boolean(false);
  const a = new Array([1, 2, 3]);
  //...
  
  console.log(Object.prototype.toString.apply(n)); // [object Number]
  console.log(Object.prototype.toString.apply(b)); // [object Boolean]
  console.log(Object.prototype.toString.apply(a)); // [object Array]
  ```

**æ‹†å°**

å¯ä»¥ä½¿ç”¨ `obj.valueof()` è·å–å¯¹è±¡å°è£…çš„å€¼

```js
const b = new Boolean(false);
const s = new String('aaa');
const a = new Array(1, 2, 3);
console.log(b.valueOf()); // false
console.log(s.valueOf()); // aaa
console.log(a.valueOf()); // [1, 2, 3]
```

### å¼ºåˆ¶ç±»å‹è½¬æ¢

JavaScript å¼ºåˆ¶ç±»å‹è½¬æ¢åªæ”¯æŒè½¬åŒ–ä¸ºåŸºæœ¬ç±»å‹å€¼

**æŠ½è±¡å€¼æ“ä½œ**

æŠ½è±¡ç±»å‹å‡½æ•°æ˜¯ç±»å‹ä¸­å†…ç½®çš„ä¸€äº›ä¸ªæ€ªæ–¹æ³•, åœ¨ç±»å‹è½¬æ¢æ—¶ JavaScript ä¼šè°ƒç”¨è¿™äº›å‡½æ•°å®ç°å¯¹åº”ç±»å‹è½¬æ¢

- `ToString` è½¬æ¢ä¸º `String`

  - æ™®é€šå¯¹è±¡: å¯¹è±¡çš„ `toString` é»˜è®¤è¿”å›å¯¹è±¡çš„ `[[class]]` å€¼

  - æ•°ç»„: `Array` çš„ `toString` è¢«é‡æ–°å®šä¹‰è¿‡, ç­‰ä»·äº `return this.join(',')`, æ³¨æ„: æ²¡æœ‰ `[]`

  - JSONå¯¹è±¡:

    - `JSON.stringify`

      `JSON.stringify(value[, replacer [, space]])` æœ‰ä¸¤ä¸ªå¯é€‰å‚æ•°

      - `replacer` è‹¥æ˜¯å‡½æ•°, æ¯ä¸ªå±æ€§éƒ½ä¼šç»è¿‡è¯¥å‡½æ•°çš„è½¬æ¢, è‹¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™åªæœ‰åŒ…å«åœ¨è¿™ä¸ªæ•°ç»„ä¸­çš„å±æ€§åæ‰ä¼šè¢«è½¬æ¢, è‹¥æ˜¯ `null` æˆ–è€…æœªæä¾›ï¼Œåˆ™å¯¹è±¡æ‰€æœ‰çš„å±æ€§éƒ½ä¼šè¢«åºåˆ—åŒ–.

        ```js
        const unSafe = {
          a: 1,
          b: '2',
          c: [1, 3, 4],
        };

        // {"a":1,"c":[1,3,null]}
        JSON.stringify(unSafe, (k, v) => (k === 'b' || k === '2' ? undefined : v))
        ```

      - `space`: è‹¥ä¸ºæ•°å­—åˆ™ä¸ºæ¯çº§ç¼©è¿›æŒ‡å®šå­—ç¬¦, è‹¥ä¸ºå­—ç¬¦ä¸², åˆ™å°†å­—ç¬¦ä¸²å‰**å**ä½ä½œä¸ºç¼©è¿›å­—ç¬¦ä¸²

        ```js
        const obj = {
          a: 1,
          c: [1, 3, 4],
        };
      
        console.log(JSON.stringify(obj, null, 2));
        // {
        //   "a": 1,
        //   "c": [
        //     1,
        //     3,
        //     4
        //   ]
        // }
      
        console.log(JSON.stringify(obj, null, '123'));
        // {
        // 123"a": 1,
        // 123"c": [
        // 1231231,
        // 1231233,
        // 1231234
        // 123]
        // }
      
        console.log(JSON.stringify(obj, null, '1234567890-='));
        // {
        // 1234567890"a": 1,
        // 1234567890"c": [
        // 123456789012345678901,
        // 123456789012345678903,
        // 123456789012345678904
        // 1234567890]
        // }
        ```

    - `toJSON`

      åœ¨ `stringify` æ—¶, è‹¥å¯¹è±¡ä¸­å­˜åœ¨é JSON å®‰å…¨å€¼(`undefined / function / symbol / å¾ªç¯å¼•ç”¨`)ä¼šå¿½ç•¥æˆ–æŠ¥é”™, è‹¥å¿½ç•¥å€¼åœ¨æ•°ç»„ä¸­åˆ™ä¼šé‡‡ç”¨ `null` ä»£æ›¿

      ```js
      JSON.stringify({
        norm: 12, // æ­£å¸¸
        a: undefined, // è·³è¿‡
        b: function () { // è·³è¿‡
          return 1;
        },
        c: Symbol('12'), // è·³è¿‡
        d: [
          1, // æ­£å¸¸
          undefined, // null
          () => {}, //null
          Symbol(12), // null
        ],
        e: t, // æŠ¥é”™
      });
      ```

      ä¸ºäº†è®©è°ƒç”¨è€…å¯ä»¥è‡ªå®šä¹‰é JSON å®‰å…¨å€¼çš„è½¬æ¢è¡Œä¸º, `JSON.stringify` å®é™…è¿›è¡Œäº†å‡ ä¸ªè¿‡ç¨‹, å…ˆæ‰§è¡Œ`replacer`, å†æ‰§è¡Œå¯¹è±¡çš„ `toJSON` æ–¹æ³•, å†å¯¹è¿”å›å€¼çš„ `toString`

      å¯¹è±¡çš„ `toJSON` æ–¹æ³•åº”è¯¥è¿”å›ä¸€ä¸ª JSON å®‰å…¨çš„å¯¹è±¡æ–¹ä¾¿ `toString` è°ƒç”¨. è¯¥å‡½æ•°åªä¼šè°ƒç”¨ä¸€æ¬¡, å¹¶ä¸”æ²¡æœ‰å‚æ•°

      ```js
      const unSafe = {
        a: undefined,
        b: () => {},
        c: 1,
        toJSON() {
          return { ...this, a: 'UNDEFINED', b: 'FUNCTION' };
        },
      };
      
      console.log(JSON.stringify(unSafe)); // {"a":"UNDEFINED","b":"FUNCTION","c":1}
      ```

- `toNumber` è½¬æ¢ä¸º `Number`

  - ç‰¹æ®Šçš„: `true => 1, false => 0, undefined => NaN, null => 0`

  - å­—ç¬¦ä¸²

    ```js
    console.log(Number('12')); // 12, 10è¿›åˆ¶
    console.log(Number('012')); // 12, å¿½ç•¥8è¿›åˆ¶
    console.log(Number('0x12')); // 18, æ¥å—16è¿›åˆ¶
    console.log(Number('0b111')); // 7, æ¥å—2è¿›åˆ¶
    console.log(Number('0b121')); // NaN, å‡ºç°éæ³•å­—ç¬¦è¿”å›NaN
    console.log(Number('1a2b3c4')); // NaN, å‡ºç°éæ³•å­—ç¬¦è¿”å›NaN
    ```

  - å¯¹è±¡ / æ•°ç»„ / åŸºæœ¬ç±»å‹å°è£…å¯¹è±¡:

    - å¯¹äºåŸºæœ¬ç±»å‹å°è£…çš„å¯¹è±¡, ç›´æ¥æå–åŸºæœ¬ç±»å‹. è‹¥è½¬æ¢åéæ•°å€¼åˆ™åœ¨è½¬æ¢ä¸ºæ•°å­—.
    - å¯¹äºå…¶ä»–å¯¹è±¡, è‹¥å¯¹è±¡å®šä¹‰äº† `valueOf` å‡½æ•°åˆ™ä½¿ç”¨ `valueOf` å‡½æ•°è½¬æ¢, å¦åˆ™ä½¿ç”¨ `toString` è½¬æ¢. è‹¥è½¬æ¢åéæ•°å€¼åˆ™åœ¨è½¬æ¢ä¸ºæ•°å­—.

    ```js
    var a = {
    	valueOf: function(){
    		return "42";
    	}
    };
    
    var b = {
    	toString: function(){
    		return "42";
    	}
    };
    
    var c = [4,2];
    c.toString = function(){
    	return this.join( "" );	// "42"
    };
    
    Number( a );			// 42
    Number( b );			// 42
    Number( c );			// 42
    Number( "" );			// 0
    Number( [] );			// 0
    Number( [ "abc" ] );	// NaN
    ```

- `toBoolean` è½¬æ¢ä¸º `Boolean`

  è§„å®šå‡å€¼: `undefined`, `null`, `false`, `+0 / -0 / NaN`, `''`, å…¶ä»–éƒ½æ˜¯çœŸå€¼
  éƒ¨åˆ†è¢«åºŸå¼ƒ / éæ ‡å‡†çš„ JavaScript ä¹Ÿä¼šè¢«æ ‡è®°ä¸º `false` (ä¾‹å¦‚ `document.all` å·²ç»è¢«åºŸå¼ƒ, åœ¨è€ç‰ˆæµè§ˆå™¨ä¸­ä¾ç„¶å­˜åœ¨ `!!document.all === true`, åœ¨æ–°ç‰ˆæµè§ˆå™¨ä¸­ä¸º `!!document.all === true`, è¿™å¯ä»¥ç”¨äºæµè§ˆå™¨ç‰ˆæœ¬åˆ¤å®š)

**å¼ºåˆ¶ç±»å‹è½¬æ¢**

- `String & Number`

  - `+var` å¯ä»¥å®ç° `String` åˆ° `Number`

  - `~~var` å¯ä»¥å®ç°å°†å€¼æŒ‰ä½åè½¬å†ç¿»å›æ¥ä»è€Œå®ç°å°æ•°è½¬ 32 ä½æ•´æ•°.

    ä¸ `floor / cell` ä¸åŒ, ä¸Šè¿°å‡½æ•°ä¼šåšå‘ä¸Šæˆ–ä¸‹å–æ•´, ä½†æ˜¯ `~~` ä¼šç›´æ¥å»å°¾

    åŒæ—¶ `~` ç›¸å½“äºå–åç , `-1` çš„åç ä¸º `0`. è€Œ `-1` ç»å¸¸è¢«ç”¨ä½œé”™è¯¯æ ‡è®°(å¦‚ `indexof`). æ‰€ä»¥, æ‰€ä»¥ç»å¸¸ç”¨äºåˆ¤æ–­å€¼æ˜¯å¦ä¸º `-1`

    ```js
    const s = 'asdfghjkl';
    if (~s.indexOf('f')) console.log('find it');
    else console.log('not find  f');
    ```

  - `Number & parseInt`: `Number` æ„é€ å‡½æ•°å¯ä»¥è¯»å…¥çº¯æ•°å­—çš„å­—ç¬¦ä¸²å¹¶è¿”å› `Number` åŒ…è£…å¯¹è±¡. è€Œ `parseInt` è¯»å…¥å­—ç¬¦ä¸²å¹¶è§£ææ•°å­—ç›´åˆ°é‡åˆ°éæ•°å­—åœæ­¢.

    ```js
    const a = '42';
    const b = '42px';

    console.log(Number(a)); // 42
    console.log(Number.parseInt(a, 10)); // 42

    console.log(Number(b)); // NaN
    console.log(Number.parseInt(b, 10)); // 42
    ```

    å¦‚æœä¸æŒ‡å®šè¿›åˆ¶, `parseInt` çš„è¡Œä¸ºä¹Ÿä¸ä¸€æ ·

    ```js
    Number.parseInt('0x10'); // 16 è‡ªåŠ¨è¯†åˆ« 16 è¿›åˆ¶
    Number.parseInt('0b10'); // 0 è‡ªåŠ¨è¯†åˆ« 2 è¿›åˆ¶
    Number.parseInt('010'); // 10 ä¸è¯†åˆ« 8 è¿›åˆ¶
    ```

    åŒæ—¶, ä¸¤å‡½æ•°åœ¨é‡åˆ°éå­—ç¬¦ä¸²è¾“å…¥æ—¶ä¼šå…ˆè½¬æ¢ä¸º `String` åœ¨è½¬æ¢

    ```js
    const obj1 = {
      toString: () => '42px',
    };

    const obj2 = {
      toString: () => '42',
    };

    console.log(Number(obj1)); // NaN
    console.log(Number.parseInt(obj1, 10)); // 42

    console.log(Number(obj2)); // 42
    console.log(Number.parseInt(obj2, 10)); // 42
    ```

    è¿™ç§è½¬æ¢ä¼šå¸¦æ¥ä¸€äº›"åŠéšå¼"çš„è½¬æ¢é—®é¢˜

    ```js
    Number.parseInt(1 / 0, 19); // 18 ( Infinity ä¼šè¢«è½¬æ¢ä¸º 'Infinity', 'I' åœ¨ 19 è¿›åˆ¶ä¸­æ˜¯ 18)
    Number.parseInt(0.000008); // 0 (è¿™ä¸ªæ•°ä¼šè¢«è½¬æ¢ä¸º '0.000008')
    Number.parseInt(0.0000008); // 8 (è¿™ä¸ªæ•°ä¼šè¢«è½¬æ¢ä¸º '8e-7')
    Number.parseInt(false, 16); // 250 (ä¼šè¢«è½¬æ¢ä¸º 'false', 'fa' éƒ½æ˜¯ 16 è¿›åˆ¶æ•°)
    Number.parseInt(parseInt, 16); // 15  (ä¼šè¢«è½¬æ¢ä¸º 'function..', 'f' æ˜¯ 16 è¿›åˆ¶æ•° )
    ```

  - `+` äºŒå…ƒåŠ æ³•é€ æˆçš„ç±»å‹è½¬æ¢: è‹¥åŠ æ³•ä¸¤è¾¹æœ‰å­—ç¬¦ä¸²å°±å°†ä¸¤è¾¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²(ä¸ç›´æ¥è½¬å­—ç¬¦ä¸²ä¸åŒ, æµç¨‹æ˜¯å…ˆ `toValue` å† `toString` )æ‰§è¡Œå­—ç¬¦ä¸²æ‹¼æ¥, å¦åˆ™å…ˆè½¬æ¢ä¸º `Number` å†æ‰§è¡Œæ•°å€¼ç›¸åŠ .

    ```js
    const obj = {
      valueOf: () => 4,
      toString: () => '42',
    };

    console.log(String(obj)); // 42: ç›´æ¥ toString = '42'
    console.log(obj + ''); // 4: å…ˆ valueOf = 4 ç„¶å toString = '4'
    console.log(obj + 1); // 5: valueOf = 4, 4 + 1 = 5
    ```

  - `true => 1, false => 0`

- `Boolean`

  - `!!` å¯ä»¥ç”¨äºè½¬æ¢ç±»å‹ä¸º `Boolean`

  - `if / for / while / do...while / ?:` è¡¨è¾¾å¼ä¼šè‡ªåŠ¨è½¬æ¢ `Boolean`

  - `|| / &&` çš„**å·¦**æ“ä½œæ•°åœ¨ä½œæ¡ä»¶åˆ¤æ–­æ—¶ä¼šè‡ªåŠ¨è½¬æ¢. è¿™ä¸¤ä¸ªé€»è¾‘è¿ç®—ç¬¦çš„è¿”å›å€¼å¹¶ä¸ä¸€å®šæ˜¯ `Boolean` è€Œæ˜¯æ ¹æ®çŸ­è·¯åŸåˆ™ç›´æ¥è¿”å›ç¬¬ä¸€æˆ–ç¬¬äºŒä¸ªå…ƒç´ 

    ```js
    const a = 0;
    const b = {};
    
    console.log(a || b); // a è½¬ä¸º false, ç›´æ¥è¿”å› b
    console.log(b || a); // b è½¬ä¸º true, ç›´æ¥è¿”å› b
    console.log(a && b); // a è½¬ä¸º false, ç›´æ¥è¿”å› a
    console.log(b && a); // b è½¬ä¸º true, ç›´æ¥è¿”å› a
    ```

**`==` ç±»å‹è½¬æ¢**

`===` æ˜¯ä¸è¿›è¡Œç±»å‹è½¬æ¢çš„ç›¸ç­‰, ä¸å¯èƒ½äº§ç”Ÿç±»å‹è½¬æ¢, ç±»å‹è½¬æ¢åªä¼šå‘ç”Ÿåœ¨ `==`

- ç‰¹æ®Šæƒ…å†µ: `NaN != NaN`, `-0 == 0`

- `String == Number`: å°† `string` è½¬ä¸º `toNumber(string)` åæ¯”è¾ƒ

- `Boolean == *`: å°† `boolean` è½¬ä¸º `toNumber(boolean)` åæ¯”è¾ƒ

  ```js
  "0" == null;			// false
  "0" == undefined;		// false
  "0" == false;			// true -- å™¢ï¼
  "0" == NaN;				// false
  "0" == 0;				// true
  "0" == "";				// false

  false == null;			// false
  false == undefined;		// false
  false == NaN;			// false
  false == 0;				// true -- å™¢ï¼
  false == "";			// true -- å™¢ï¼
  false == [];			// true -- å™¢ï¼
  false == {};			// false

  "" == null;				// false
  "" == undefined;		// false
  "" == NaN;				// false
  "" == 0;				// true -- å™¢ï¼
  "" == [];				// true -- å™¢ï¼
  "" == {};				// false

  0 == null;				// false
  0 == undefined;			// false
  0 == NaN;				// false
  0 == [];				// true -- å™¢ï¼
  0 == {};				// false
  ```

- `undefined == null`

- å¯¹è±¡ä¸éå¯¹è±¡: å°†å¯¹è±¡è½¬ä¸ºåŸºæœ¬ç±»å‹å€¼å†æ¯”è¾ƒ. ä»¥ä¸‹æ˜¯æ€ªæƒ…å†µ

  ```js
  Number.prototype.valueOf = function() {
  	return 3;
  };

  new Number( 2 ) == 3;	// true
  ```

  ```js
  var i = 2;

  Number.prototype.valueOf = function() {
  	return i++;
  };

  var a = new Number( 42 );

  if (a == 2 && a == 3) {
  	console.log( "Yep, this happened." );
  }
  ```

- å¥‡è‘©æƒ…å†µ

  ```js
  [] == ![];		// true, å³ä¾§ ![] => false, [] => '' => false
  ```

  ```js
  console.log([2].toString()); // 2
  console.log([null].toString()); // ''
  ```

  ```js
  console.log(0 == '\n'); // true, '\n' / '' / å„ç§unicodeç©ºæ ¼ => 0
  ```

  ```js
  "0" == false;			// true -- å™¢ï¼
  false == 0;				// true -- å™¢ï¼
  false == "";			// true -- å™¢ï¼
  false == [];			// true -- å™¢ï¼
  "" == 0;				// true -- å™¢ï¼
  "" == [];				// true -- å™¢ï¼
  0 == [];				// true -- å™¢ï¼
  ```

  æ€»ä¹‹, `==` ä¸¤è¾¹ä¸è¦å†™ `true / false`, é¿å…ä½¿ç”¨ `[], '', 0`

- å„ç§æƒ…å†µæ¯”è¾ƒè¡¨: [dorey/JavaScript-Equality-Table](dorey/JavaScript-Equality-Table)



  ![](./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /3-1.png)

**æ¯”è¾ƒç¬¦**

JavaScript åªå®šä¹‰äº† `<`. `a > b` ä¼šè¢«è‡ªåŠ¨è½¬ä¸º `b < a`, `a <= b` ä¼šè¢«è½¬æ¢ä¸º `!(b < a)`.

åœ¨æ¯”è¾ƒæ—¶, åŒæ–¹ä¼šå…ˆè½¬æ¢ä¸ºåŸºæœ¬æ•°å€¼ç±»å‹å†æ¯”è¾ƒ

### è¯­æ³•

**ç»“æœå€¼**

åœ¨ DevTools ä¸­, åœ¨è¾“å…¥è¯­å¥åå³ä½¿æ²¡æœ‰ `Console` è¯­å¥, DevTool ä¹Ÿä¼šè¾“å‡ºä¸€ä¸ªç»“æœ, è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯è¯­å¥çš„ç»“æœå€¼.

```js
> let a = 1
< undefined
> a
< 1
```

åœ¨æ­£å¸¸ä»£ç ä¸­, å¦‚æœä¸€ä¸ªè¯­å¥ä¸­åªæœ‰ `a`, JavaScript æ˜¯ä¸ä¼šè¾“å‡ºç»“æœçš„, ä½†æ˜¯ DevTool ä¼šè¾“å‡ºè¿™ä¸ªè¯­å¥çš„ç»“æœå€¼

- å£°æ˜è¯­å¥ `let a = 1` æœ‰ç»“æœå€¼, ä½†æ˜¯ä¼šè¢« JavaScriptå¼•æ“å±è”½, æœ€ç»ˆæ˜¾ç¤º `undefined`

- èµ‹å€¼è¯­å¥ `a = b` çš„ç»“æœå€¼ä¸ºèµ‹çš„å€¼(ä½†æ˜¯ä¸æ˜¯ `a` ! åªæ˜¯ `a` å¯¹åº”çš„å³å€¼!)

  ç”±äºèµ‹å€¼è¯­å¥çš„ç»“æœå€¼æ˜¯èµ‹çš„å³å€¼, å¯ä»¥å€ŸåŠ©è¿™ä¸ªç‰¹æ€§å®ç°é“¾å¼èµ‹å€¼

  ```js
  a = b = c = 1
  ```

  å€¼å¾—æ³¨æ„çš„æ˜¯, å£°æ˜è¯­å¥çš„ç»“æœå€¼è¢«å±è”½ä¸ºäº† `undefined`. æ‰€ä»¥, ä¸èƒ½é“¾å¼å£°æ˜

  ```js
  let a = b = c = 1 // ğŸ‘ é™é»˜å¤±æ•ˆ
  ```

- ä»£ç å— `{}` çš„ç»“æœå€¼æ˜¯ä»£ç å—çš„æœ€åä¸€ä¸ªè¯­å¥ / è¡¨è¾¾å¼

åœ¨ç¼–ç¨‹ä¸­, å¯ä»¥ä½¿ç”¨ `eval` è·å–ç»“æœå€¼(ä½†æ˜¯ä¸å»ºè®®), æœªæ¥å¯èƒ½å¯ä»¥é€šè¿‡ `do` è·å–ç»“æœå€¼

```js
let a, b;

a = do {
  if (true) {
    b = 12;
  }
};

console.log(a); // 42
```

**è¡¨è¾¾å¼çš„ç»“æœæ˜¯å³å€¼**

è¡¨è¾¾å¼çš„ç»“æœå€¼æ˜¯å³å€¼, è¿™å°±æ„å‘³ç€è¿™æ ·çš„å†™æ³•æ˜¯éæ³•çš„

- `++a++`: ç›¸å½“äº `++(a++)`, è€Œ `a++` è¿”å›çš„æ˜¯å³å€¼, æ— æ³•å¯¹å³å€¼åš `++`
- `(a || b) = 1`: `||` æ˜¯é€‰æ‹©ç¬¦å·, çœ‹èµ·æ¥çš„æ„æ€æ˜¯è‹¥ `a` æ˜¯å‡å€¼åˆ™æ‰§è¡Œ `b = 1` å¦åˆ™ `a=1`. ä½†æ˜¯ `(a || b)` è¿”å›çš„æ˜¯å³å€¼

**å¤šé‡è¯­æ³•**

- `{}`: å¯ä»¥æ˜¯å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯ä»£ç å¿«, è¿™å°±å¯¼è‡´äº†

  ```js
  [] + {} // ç»“æœå€¼: "[Obejct Obejct]" ({} å‰æœ‰ +, æ‰€ä»¥{}æ˜¯ä¸€ä¸ªå¯¹è±¡)
  {} + [] // ç»“æœå€¼: 0 ({}å‰å•¥ä¹Ÿæ²¡æœ‰, æ‰€ä»¥æ˜¯ä¸ªä»£ç å—, å…¶ç­‰ä»·äº +[], æ ¼å¼è½¬æ¢ä¸º 0)
  a = [] + {} // a == "[Obejct Obejct]" ({} å‰æœ‰ +, æ‰€ä»¥{}æ˜¯ä¸€ä¸ªå¯¹è±¡)
  b = {} + [] // b == [Obejct Obejct]" ({} å‰æœ‰ =, æ‰€ä»¥{}æ˜¯ä¸€ä¸ªå¯¹è±¡)
  ```

  åŒæ—¶, ä»£ç å—å†…å±æ€§çš„å«ä¹‰ä¹Ÿå˜äº†

  ```js
  // æ­¤æ—¶æ˜¯ä¸€ä¸ªå¯¹è±¡
  a = {
    foo: 1 // å¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§
  };
  
  // æ­¤æ—¶æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç å—
  {
    foo: 1 // ä»£ç å¿«ä¸­çš„æ ‡ç­¾
  }
  ```

  æ ‡ç­¾([MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/label))ç±»ä¼¼äº C è¯­è¨€ä¸­ `goto` çš„ label, ä¸ä¹‹ä¸åŒçš„æ˜¯ JavaScript ä¸­æ²¡æœ‰ `goto`, åªèƒ½é€šè¿‡ `continue / break` è·³è½¬, åŒæ—¶ä¸èƒ½å¯¹éå¾ªç¯çš„å—ä»£ç æ‰§è¡Œ `continue`

  åŒæ—¶æ³¨æ„, æ ‡ç­¾åå‰åä¸èƒ½æœ‰åŒå¼•å·, å³

  ```json
  {
    "foo": 1
  }
  ```

  æ˜¯ä¸åˆæ³•çš„(éœ‡æƒŠ JavaScript ç«Ÿç„¶ä¸å®Œç¾å…¼å®¹ JSON!)

**ä¼˜å…ˆçº§ä¸ç»“åˆæ€§**

- ä¼˜å…ˆçº§: `! > && > || ?:` ([è¯¦è§MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence#%E6%B1%87%E6%80%BB%E8%A1%A8))
- ç»“åˆæ€§: `?:` æ˜¯å³ç»“åˆçš„ ([è¯¦è§MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence#%E6%B1%87%E6%80%BB%E8%A1%A8))

**è‡ªåŠ¨åˆ†å·(ASI)**

JavaScript ä¼šè‡ªåŠ¨åœ¨è¡Œæœ«åŠ  `;`, è¿™å¯ä»¥é˜²æ­¢å¾ˆå¤šä¸ç»æ„é—´é€ æˆçš„é—®é¢˜

```js
do{
    // ...
}while(); // è¿™é‡Œåœ¨è¯­æ³•ä¸­å¿…é¡»åŠ  ; å¾—ç›Šäº ASI, ç¨‹åºå‘˜å¯ä»¥ä¸ç”¨åŠ 
```

**æš‚æ—¶æ€§æ­»åŒº**

å°±æ˜¯åœ¨å˜é‡å£°æ˜å‰ä½¿ç”¨å˜é‡(é’ˆå¯¹ `let`, `var` æœ‰å£°æ˜æå‡ä¸ä¼šå‡ºäº‹). æå‰ä½¿ç”¨ä¼šé€ æˆ `Reference Error`

```js
a = 1; // å•¥äº‹æ²¡æœ‰
b = 1; // ReferenceError
let b;
```

è¿˜æœ‰ä¸ªå°ä¾‹å¤–

```js
console.log(typeof a); // undefined, æ²¡æœ‰æŠ¥é”™!
console.log(typeof b); // ReferenceError
let b;
```

**å‡½æ•°å‚æ•°**

åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­æ ‡è¯†ç¬¦ä¼šä¸ `arguments` å˜é‡å»ºç«‹"è¿æ¥"å…³ç³»

```js
function test(a, b) {
  a = 2;
  b = 2;
  console.log(arguments[0]); // åªä¿®æ”¹äº† a , ä½†æ˜¯ arguments[0] è¿æ¥åˆ°äº† a, æ‰€ä»¥ä¾ç„¶è¢«ä¿®æ”¹äº†...
  console.log(arguments[1]);
}

test(1, 0); // 2,2
```

æ— éœ€è€ƒè™‘å‡½æ•°é»˜è®¤å€¼é—®é¢˜, å¯ç”¨é»˜è®¤å€¼ä¼šè‡ªåŠ¨å¯ç”¨å‡½æ•°ä¸¥æ ¼æ¨¡å¼

**try...finally**

`finally`å—åŒ…å«çš„è¯­å¥åœ¨`try`å—å’Œ`catch`ä¹‹å, æ— è®º `try` æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ `finally` å­å¥éƒ½ä¼šæ‰§è¡Œ. è¿™é‡Œçš„ `finally` å°±åƒä¸€ä¸ªå›è°ƒä¸€æ ·, æ‰§è¡Œé¡ºåºä¸º `try -> (catch) -> finally -> å‡½æ•°çš„æ­£å¸¸åŠŸèƒ½`

- å½“ `try` ä¸­å‡ºç° `return` æ—¶

  ```js
  function demo() {
    try {
      return 0;
    } finally {
      console.log('1'); // è™½ç„¶ try return äº†, ä½†æ˜¯ç”±äº finally çš„å­˜åœ¨, return ä¼šè¢«"æš‚å­˜" åˆ°finall ç»“æŸ
    }
    console.log('2');
  }

  demo(); // 1
  ```

- å½“ `try / catch & finally` ä¸­å‡ºç° `return` æ—¶

  ```js
  function demo() {
    try {
      console.log('0');
      return 0;
    } finally {
      console.log('1');
      return 1; // finally çš„ return ä¼šè¦†ç›– try çš„
    }
    console.log('2');
    return 2;
  }

  let res = demo(); // console => 0, 1
  console.log(res); // 1
  ```

  ```js
  function demo() {
    try {
      console.log('0');
      throw 0;
    } catch (err) {
      console.log('1');
      return 1;
    } finally {
      console.log('2');
      return 2; // finally çš„ return ä¼šè¦†ç›– catch çš„
    }
    console.log('3');
    return 3;
  }

  let res = demo(); // console => 0, 1, 2
  console.log(res); // 2

  ```

- è¯¥è§„åˆ™åŒæ ·é€‚ç”¨äº `continue`

  ```js
  for (let i = 0; i < 5; i++) {
    try {
      continue;
    } finally {
      console.log(i);
    }
    console.log('*');
  }

  // 0, 1, 2, 3, 4, 5(æ²¡æœ‰*)
  ```

- æœ€è¿·æƒ‘çš„æ˜¯ä¸ `break` ä¸€èµ·ä½¿ç”¨

  ```js
  function foo() {
    lab: {
      try {
        return 0;
      } finally {
        break lab;
      }
    }
    return 1;
  }
  
  console.log(foo()); // 1
  ```

**switch**

- æœ€ç®€å½¢å¼: `case` æ¥ä¸€ä¸ªå€¼, JavaScript ä¼šå°† `a` ä¸ case å€¼åš `===` æ¯”è¾ƒ

  ```js
  a = true;

  switch (a) {
    case 1: // a == 1 æˆç«‹, ä½†æ˜¯ a === 1 ä¸æˆç«‹
      console.log('0');
      break;
    case true: // èµ°è¿™é‡Œäº†
      console.log('1');
      break;
  }
  ```

- å¦‚æœåƒåšä¸€äº›ç±»å‹è½¬æ¢, å¯ä»¥å°† `switch` çš„å€¼æ¢æˆ `true`

  ```js
  a = true;

  switch (true) {
    case a == 1:
      console.log('0'); // èµ°è¿™é‡Œäº†
      break;
    case a == true:
      console.log('1');
      break;
  }
  ```

- å¦‚æœè¦ç”¨ `switch (true)` çš„å†™æ³•çš„è¯, éœ€è¦ä¿è¯è®¡ç®— `case` çš„è®¡ç®—ç»“æœä¸€å®šæ˜¯ `true` è€Œä¸æ˜¯å¯ä»¥è½¬æ¢ä¸º `true`, `switch` åšçš„æ˜¯ `===`

  ```js
  a = true;
  s = 'demo';
  
  switch (true) {
    case a && s: // && è¿”å› b è€Œ b !== true
      console.log('0');
      break;
    default:
      console.log('1'); // èµ°è¿™é‡Œäº†
      break;
  }
  ```

## å¼‚æ­¥

### å¼‚æ­¥

**æ§åˆ¶å°å¼‚æ­¥**

å®é™…ä¸Š `console.*` ç³»åˆ—å‡½æ•°å¹¶ä¸æ˜¯ ES æ ‡å‡†è¯­æ³•, å…¶æ˜¯ç”±å®¿ä¸»ç¯å¢ƒå†³å®šçš„. è€Œå®¿ä¸»ç¯å¢ƒç»å¸¸ä¼šä¸ºé™ä½ I/O å¼€é”€è€Œå»¶è¿Ÿè¾“å‡º, è¿™ç§ I/O å¼‚æ­¥çš„ç­–ç•¥ä¼šé€ æˆè¾“å‡º"å‡ºé”™"

**ç¨‹åºæ‰§è¡Œæ—¶æœº**

JavaScript ä¸­çš„ä»£ç æ˜¯åˆ†å—çš„(å¦‚ä¸€ä¸ªä¸ªå‡½æ•°), æˆ‘ä»¬å¸Œæœ›å¯ä»¥å¹²é¢„å‡½æ•°æ‰§è¡Œçš„é¡ºåºä¸æ—¶æœº(å¦‚ Ajax è¯·æ±‚æˆåŠŸåå†æ‰§è¡ŒæŸä¸ªå‡½æ•°, å…ˆæ‰§è¡Œåˆ«çš„å‡½æ•°ç­‰ä¸€ä¼šå„¿å†æ‰§è¡ŒæŸä¸ªå‡½æ•°), æœ‰ä¸¤ç§å¸¸è§æ–¹æ³•

- å›è°ƒå‡½æ•°
- `setTimeout` ç­‰å¼‚æ­¥API

**è°ƒç”¨æ ˆ, äº‹ä»¶å¾ªç¯ä¸ä»»åŠ¡é˜Ÿåˆ—**

JavaScript æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„å¼‚æ­¥ç¼–ç¨‹è¯­è¨€, è®©ä¸€ä¸ªå•çº¿ç¨‹çš„è¯­è¨€å®ç°å¤šä»»åŠ¡å¼‚æ­¥æ˜¯æœ‰ç‚¹éº»çƒ¦çš„. JavaScript æäº†äº‹ä»¶å¾ªç¯æœºåˆ¶, åŒ…æ‹¬äº†è°ƒç”¨æ ˆ, ä»»åŠ¡é˜Ÿåˆ—, äº‹ä»¶å¾ªç¯

- è°ƒç”¨æ ˆ(Call Stack): å­˜æ¡£ä»£ç æ‰§è¡Œæ—¶çš„ ConText(å¦‚å‡½æ•°åµŒå¥—)

- äº‹ä»¶å¾ªç¯: æ¯å½“è°ƒç”¨æ ˆæ¸…ç©º(å½“å‰å·¥ä½œç»“æŸ)æ—¶, äº‹ä»¶å¾ªç¯ä¼šå‘ä»»åŠ¡é˜Ÿåˆ—é¦–éƒ¨å–ä»»åŠ¡, æ”¾è°ƒç”¨æ ˆæ‰§è¡Œ

- ä»»åŠ¡é˜Ÿåˆ—: å½“æœ‰å¼‚æ­¥ä»»åŠ¡éœ€è¦æ‰§è¡Œ(å¦‚: å®šæ—¶å™¨**åˆ°æœŸ**)æ—¶, JavaScript ä¼šå‘ä»»åŠ¡é˜Ÿåˆ—ä¸­å‹å…¥ä»»åŠ¡. ä»»åŠ¡é˜Ÿåˆ—åˆåˆ†å®é˜Ÿåˆ—ä¸å¾®é˜Ÿåˆ—, ä¸åŒçš„ä»»åŠ¡ä¼šæ”¾å…¥ä¸åŒçš„é˜Ÿåˆ—

  å®é˜Ÿåˆ—  

  |                                                      | æµè§ˆå™¨ | Node |
  | ---------------------------------------------------- | ------ | ---- |
  | æ•´ä½“ä»£ç (script)                                     | âœ…      | âœ…    |
  | UIäº¤äº’äº‹ä»¶                                           | âœ…      | âŒ    |
  | I/O                                                  | âœ…      | âœ…    |
  | setTimeout<br />(setTimeout(,0)æ˜¯å¸¸ç”¨çš„æ”¾é˜Ÿå°¾çš„æ–¹æ³•) | âœ…      | âœ…    |
  | setInterval                                          | âœ…      | âœ…    |
  | setImmediate                                         | âŒ      | âœ…    |
  | requestAnimationFrame                                | âœ…      | âŒ    |
  
  å¾®é˜Ÿåˆ—  
  
  |                            | æµè§ˆå™¨ | Node |
  | -------------------------- | ------ | ---- |
  | process.nextTick           | âŒ      | âœ…    |
  | MutationObserver           | âœ…      | âŒ    |
  | Promise.then catch finally | âœ…      | âœ…    |

æ€»æµç¨‹å¦‚ä¸‹

1. ä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ŒæŒ‰ç…§**å…¥é˜Ÿé¡ºåº**ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„å®ä»»åŠ¡ï¼Œæ”¾å…¥è°ƒç”¨æ ˆï¼Œå¼€å§‹æ‰§è¡Œï¼›
2. æ‰§è¡Œå®Œ**è¯¥å®ä»»åŠ¡**ä¸‹æ‰€æœ‰åŒæ­¥ä»»åŠ¡åï¼Œå³è°ƒç”¨æ ˆæ¸…ç©ºåï¼Œè¯¥å®ä»»åŠ¡è¢«æ¨å‡ºå®ä»»åŠ¡é˜Ÿåˆ—ï¼Œç„¶åå¾®ä»»åŠ¡é˜Ÿåˆ—å¼€å§‹æŒ‰ç…§å…¥é˜Ÿé¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œå…¶ä¸­çš„å¾®ä»»åŠ¡ï¼Œ**ç›´è‡³å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºä¸ºæ­¢**ï¼›
3. å½“å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåï¼Œä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»“æŸï¼›
4. æ¥ç€ä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªæ‰§è¡Œçš„å®ä»»åŠ¡ï¼Œå¼€å§‹ç¬¬äºŒä¸ªäº‹ä»¶å¾ªç¯ï¼Œç›´è‡³å®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºä¸ºæ­¢ã€‚

è¿™é‡Œæœ‰å‡ ä¸ªé‡ç‚¹ï¼š

- å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œè§£é‡Šå™¨ä¼šå°†æ•´ä½“ä»£ç `script`æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå› æ­¤äº‹ä»¶å¾ªç¯æ˜¯ä»ç¬¬ä¸€ä¸ªå®ä»»åŠ¡å¼€å§‹çš„ï¼›
- å¦‚æœåœ¨æ‰§è¡Œå¾®ä»»åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿæ–°çš„å¾®ä»»åŠ¡æ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œä¹Ÿéœ€è¦ä¸€èµ·æ¸…ç©ºï¼›å¾®ä»»åŠ¡é˜Ÿåˆ—æ²¡æ¸…ç©ºä¹‹å‰ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡çš„ã€‚

**å¼‚æ­¥å¹¶è¡Œ**

å¼‚æ­¥ä¸å¹¶è¡Œä¸ä¸€æ ·, å¼‚æ­¥æ˜¯å…è®¸æŒ‡å®šä»£ç å—çš„è¿è¡Œæ—¶æœº, å¹¶è¡Œæ˜¯å¤šä¸ªä»£ç å—åŒæ—¶è¿è¡Œ. æ›´åŠ å½¢è±¡çš„è¯´, å¼‚æ­¥å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªäº‹ä»¶å¾ªç¯, å¹¶è¡Œå°±æ˜¯ç»´æŠ¤ä¸€å †äº‹ä»¶å¾ªç¯.

å¼‚æ­¥ä¸å¹¶è¡Œéƒ½ä¼šå¸¦æ¥ä¸ç¡®å®šæ€§, å¼‚æ­¥çš„ä¸ç¡®å®šæ€§æ˜¯ä¸çŸ¥é“ä»»åŠ¡ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è¢«å¡åˆ°é˜Ÿåˆ—å°¾éƒ¨, è€Œå¹¶è¡Œçš„ä¸ç¡®å®šæ€§æ˜¯ä¸ç¡®å®šæŒ‡ä»¤ä¹‹é—´çš„æ‰§è¡Œé¡ºåº

æ‰€å¹¸, JavaScript æ˜¯å•çº¿ç¨‹çš„å¼‚æ­¥è¯­è¨€, è¿™æ„å‘³ç€ JavaScript è°ƒåº¦æœ€å°å•ä½æ˜¯å•ä¸ªä»»åŠ¡(å‡½æ•°è¦ä¹ˆå…¨è¿è¡Œè¦ä¹ˆä¸è¿è¡Œ, æˆ‘ä»¬å°†å…¶æˆä¸º**å®Œæ•´è¿è¡Œ**), ä¸ä¼šå‡ºç°æŠ¢å å¼è°ƒåº¦

**å¹¶å‘**

å°†å¸¸è§çš„å¹¶å‘æ¨¡å¼åˆ†ä¸ºä¸‰ç§

- éäº’åŠ¨å¼: è¿›ç¨‹é—´ä¸å…±äº«å†…å­˜

- äº’åŠ¨å¼: è¿›ç¨‹é—´å…±äº«å†…å­˜

  è¿™ä¼šå¯¼è‡´ç”±äºæœªçŸ¥æ‰§è¡Œé¡ºåºé€ æˆçš„èµ„æºç«äº‰

  ```js
  var res = [];

  function response(data) {
  	res.push( data );
  }

  // ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°
  ajax( "http://some.url.1", response );
  ajax( "http://some.url.2", response );
  ```

  ä¸€èˆ¬è§£å†³æ–¹æ¡ˆæœ‰

  - ç¼–å·

    ```js
    var res = [];

    function response(data) {
    	if (data.url == "http://some.url.1") {
    		res[0] = data;
    	}
    	else if (data.url == "http://some.url.2") {
    		res[1] = data;
    	}
    }

    // ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°
    ajax( "http://some.url.1", response );
    ajax( "http://some.url.2", response );
    ```

  - è®¾ç½®å¤§é—¨(åªæœ‰ä¸¤ä¸ªè¿›ç¨‹éƒ½å®Œæˆæ‰èƒ½ç»§ç»­)

    ```js
    var a, b;

    function foo(x) {
    	a = x * 2;
    	if (a && b) {
    		baz();
    	}
    }

    function bar(y) {
    	b = y * 2;
    	if (a && b) {
    		baz();
    	}
    }

    function baz() {
    	console.log( a + b );
    }

    // ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°
    ajax( "http://some.url.1", foo );
    ajax( "http://some.url.2", bar );
    ```

  - è®¾ç½®"é—¨é—©"(å³å‡½æ•°åªç»™ç‰¹å®šæ¬¡è°ƒç”¨è€…ç”¨)

    ```js
    var a;
    
    function foo(x) {
    	a = x * 2;
    	baz();
    }
    
    function bar(x) {
    	a = x / 2;
    	baz();
    }
    
    function baz() {
    	console.log( a );
    }
    
    // ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°
    ajax( "http://some.url.1", foo );
    ajax( "http://some.url.2", bar );
    ```

- åä½œå¼

  å¯¹äºè®¡ç®—é‡å¾ˆå¤§çš„åŒæ­¥ä»»åŠ¡, ç»å¸¸å°†å…¶æ‹†è§£ä¸ºå¼‚æ­¥çš„å¤šä¸ªä¸å†²çªä»»åŠ¡ä»¥æ”¾ç½® JavaScript è¿è¡Œé˜»å¡

  ```js
  var res = [];
  
  // `response(..)`ä»Ajaxè°ƒç”¨æ”¶åˆ°ä¸€ä¸ª10000000000çš„æ•°ç»„, è¦åŒæ­¥æ‰§è¡Œä¸€å®šä¼šèŠ±å¾ˆå¤šæ—¶é—´
  function response(data) {
  	res = res.concat(
  		data.map( function(val){
  			return val * 2;
  		} )
  	);
  }
  
  // ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°
  ajax( "http://some.url.1", response );
  ajax( "http://some.url.2", response );
  ```

  å°†å…¶åˆ†è§£

  ```js
  var res = [];
  
  function response(data) {
  	// ä¸€æ¬¡åªå¤„ç†1000ä»¶
  	var chunk = data.splice( 0, 1000 );
      res = res.concat(
  		// åˆ¶é€ ä¸€ä¸ªæ–°çš„å˜å½¢è¿‡çš„æ•°ç»„ï¼Œæ‰€æœ‰çš„`data`å€¼éƒ½ç¿»å€
  		chunk.map( function(val){
  			return val * 2;
  		} )
  	);
  
  	if (data.length > 0) {
  		// å¼‚æ­¥è§„åˆ’ä¸‹ä¸€ä¸ªæ‰¹å¤„ç†
  		setTimeout( function(){ // é€šè¿‡ setTImeout å°†ä»»åŠ¡å†æ¬¡æ”¾å…¥é˜Ÿå°¾
  			response( data );
  		}, 0 );
  	}
  }
  
  // ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°
  ajax( "http://some.url.1", response );
  ajax( "http://some.url.2", response );
  ```

**è¯­å¥é¡ºåº**

JavaScript ç¼–è¯‘å™¨åœ¨æ‰§è¡Œä»£ç å‰ä¼šåšä»£ç ä¼˜åŒ–, è¿™å¯èƒ½æ”¹å˜è¯­å¥æ‰§è¡Œé¡ºåº, ä½†æ˜¯è¿™äº›æ”¹å˜éƒ½æ˜¯å®‰å…¨çš„, ä¸å¿…æ‹…å¿ƒ

### å›è°ƒ

JavaScript æ˜¯å•çº¿ç¨‹çš„, å…¶å®ç°å¼‚æ­¥çš„æœ€åŸºæœ¬æ¨¡å¼å°±æ˜¯è®©ä¸»çº¿ç¨‹åœ¨ä¸åŒä»»åŠ¡ä¸Šä¸‹æ–‡ä¹‹é—´å¿«é€Ÿåˆ‡æ¢. åŸºç¡€çš„å¼‚æ­¥æ¨¡å¼æœ‰å›è°ƒä¸ `Promise`.

**å›è°ƒçš„é—®é¢˜**

å›è°ƒä¼šè®©ä»£ç å˜å¾—éš¾ä»¥é¢„æµ‹, è·Ÿè¸ª, è°ƒè¯•. å…¶å­˜åœ¨å¤šç§é—®é¢˜

- å›è°ƒåœ°ç‹±

  ç§°å¤šå±‚åµŒå¥—å›è°ƒå‡½æ•°çš„ä»£ç ä¸ºå›è°ƒåœ°ç‹±. å›è°ƒåœ°ç‹±ä¸ä»…ä¼šé€ æˆä»£ç å½¢å¼ä¸Šçš„éš¾ä»¥ç†è§£, æ›´é‡è¦çš„æ˜¯åœ¨åŒæ­¥å¼‚æ­¥å‡½æ•°æ··æ‚çš„å›è°ƒåµŒå¥—ä»£ç ä¸­, ä»£ç çš„è¡Œä¸ºä¸å¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œæ—¶æœºå¾€å¾€æ˜¯å¤šæ ·åŒ–çš„ä¸”å®¹æ˜“è¢«æé”™.

- ä¿¡ä»»é—®é¢˜

  å½“ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¼‚æ­¥å‡½æ•°æ—¶, æˆ‘ä»¬éœ€è¦ä¸ºç¬¬ä¸‰æ–¹å‡½æ•°ä¼ å…¥å›è°ƒ. è€Œæˆ‘ä»¬å®Œå…¨ä¸æ¸…æ¥šç¬¬ä¸‰æ–¹åº“è§¦å‘å›è°ƒçš„æ—¶æœº, æ¬¡æ•°, ä¸‰æ–¹å‡½æ•°å‡ºé”™åè¡Œä¸º. è¿‡æ—©è¿‡æ™šè¿‡å¤šæˆ–å‡ºé”™åè§¦å‘å›è°ƒå°†ä¼šå¸¦æ¥æœªçŸ¥çš„é—®é¢˜. ä½¿ç”¨è€…åœ¨è®¾è®¡å›è°ƒæ—¶éœ€è¦è€ƒè™‘å›è°ƒåœ¨ä¸åŒæ—¶æœºè°ƒç”¨çš„å¤„ç†é—®é¢˜. åŒæ—¶, ç§°è¿™ç§å°†å‡½æ•°æ‰§è¡Œæ—¶æœºäº¤ç»™ä¸‰æ–¹å‡½æ•°çš„è¡Œä¸ºç§°ä¸º: æ§åˆ¶æƒåè½¬

**è§£å†³**

- è§£å†³å›è°ƒåœ°ç‹±: é“¾å¼å›è°ƒ

  å°†åµŒå¥—å¼å›è°ƒ

  ```js
  function doA() {
    setTimeout(function () {
      setTimeout(function () {
        console.log('end');
      }, 1000);
    }, 1000);
  }
  ```

  è½¬ä¸ºé“¾å¼å›è°ƒ

  ```js
  function doA() {
    // do something
    setTimeout(doB, 1000);
  }

  function doB() {
    // do something
    setTimeout(doC, 1000);
  }

  function doC() {
    // do something
    setTimeout(() => console.log('end'), 1000);
  }
  ```

  è¿™è®©ä»£ç åœ¨å½¢å¼ä¸Šçœ‹èµ·æ¥æ¸…æ™°äº†ä¸€ç‚¹, ä½†æ˜¯æ²¡æœ‰æ ¹æœ¬è§£å†³é—®é¢˜. å‡½æ•°çš„æ‰§è¡Œè¿˜æ˜¯éš¾ä»¥è¿½è¸ªçš„.

- è§£å†³ä¿¡ä»»é—®é¢˜: `Error-Else` é£æ ¼

  ä¹Ÿç§° Node.JS åˆ†æ ¼. åœ¨è®¾è®¡å›è°ƒå‡½æ•°æ—¶, ä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸º Error ä¿¡æ¯. è‹¥å‡½æ•°å‡ºé”™, åœ¨æ‰§è¡Œå›è°ƒæ—¶å€™å°†ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º Error ä¿¡æ¯, å›è°ƒä¸€æ—¦çœ‹åˆ°ç¬¬ä¸€ä¸ªå‡½æ•°éå‡å°±çŸ¥é“ä¸Šå±‚å‡½æ•°å‡ºé”™äº†, è‹¥ Error ä¸ºå‡, åˆ™ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹è·å–ä¼ å…¥ä¿¡æ¯.

- è§£å†³ä¿¡ä»»é—®é¢˜: å€Ÿç”¨å¹¶å‘è§£å†³æ–¹æ¡ˆ

  ä¸ºè§£å†³å›è°ƒæ—¶æœºé—®é¢˜, å¯ä»¥å€ŸåŠ©å¹¶å‘æ€è·¯, é€šè¿‡è®¾ç½® flag è¯†åˆ«è¿è¡Œæ—¶æœº, è§£å†³è¿è¡Œæ—¶æœºé—®é¢˜

### Promise

å›è°ƒå­˜åœ¨çš„ä¸¤ä¸ªé—®é¢˜: ä¿¡ä»»é—®é¢˜ & å›è°ƒåœ°ç‹±(å¼‚æ­¥ä»£ç éš¾ä»¥ç†è§£). åœ¨ ES6 ä¸­, Promise & ç”Ÿæˆå™¨åˆ†åˆ«è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜.

**é¸­å­ç±»å‹**

å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯ Promise å¯¹è±¡å‘¢? JavaScript çš„åˆ¤æ–­æ–¹å¼æ˜¯æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ "thenable" çš„, å³: å¯¹è±¡æ˜¯å¦å…·æœ‰ `then` æ–¹æ³•. **ä»»ä½•æœ‰ `then` æ–¹æ³•çš„å¯¹è±¡éƒ½æ˜¯ Promise**

æ˜¾ç„¶, è¿™ä¼šé€ æˆä¸¥é‡çš„å…¼å®¹é—®é¢˜, è€ä»£ç ä¸­å®šä¹‰ `then` çš„å¯¹è±¡éƒ½è«åå…¶å¦™å˜æˆäº† Promise

`Promise.resolve` å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³è¿™ä¸€é—®é¢˜. è¯¥å‡½æ•°ä¸ä»…å¯ä»¥è¿”å›ä¸€ä¸ª Promise, æ›´é‡è¦çš„æ˜¯å…¶å¯ä»¥å°†å‚æ•°ä¸­çš„ `thenable` è½¬æ¢ä¸ºé `thenable`

**Promise è§£å†³äº†ä¿¡ä»»é—®é¢˜**

- æ§åˆ¶æƒåè½¬: åœ¨å›è°ƒä¸­, æˆ‘ä»¬å°†å›è°ƒäº¤ç»™ä¸‰æ–¹å‡½æ•°. ä¸‰æ–¹å‡½æ•°çš„æ‰§è¡Œæ˜¯ä¸å¯é¢„æµ‹çš„. è€Œåœ¨ Promise ä¸­, ä¸‰æ–¹å¼‚æ­¥å‡½æ•°åªåœ¨ç»“æŸæ—¶å‘æˆ‘ä»¬è¿”å›æ‰§è¡Œç»“æœ / é”™è¯¯ä¿¡æ¯.

- è°ƒç”¨è¿‡æ—©: åœ¨å›è°ƒä¸­, å¯èƒ½å‡ºç°å¼‚æ­¥å‡½æ•°ç»“æŸå‰è°ƒç”¨å›è°ƒçš„é—®é¢˜, åœ¨ Promise ä¸­, å³ä½¿åç»§å‡½æ•°è¢«æ³¨å†Œ, ä¹Ÿè¦ç­‰åˆ° Promise è¢«å†³è®®åçš„ä¸‹ä¸€ä¸ª trick å†æ‰§è¡Œ

- è°ƒç”¨è¿‡æ™š: åœ¨å›è°ƒä¸­, å¯èƒ½ä¼šå‡ºç°åæ³¨å†Œçš„å›è°ƒå…ˆæ‰§è¡Œçš„é—®é¢˜

  ```js
  function test1(fn) {
    console.log('TEST1');
    fn();
  }

  function test2() {
    console.log('TEST2');
  }

  test1(() => {
    console.log('Hook');
  });
  test2();

  // TEST1
  // Hook         // ğŸ‘
  // TEST2
  ```

  åœ¨ Promise ä¸­, åç»§å‡½æ•°çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸¥æ ¼æŒ‰ç…§æ³¨å†Œé¡ºåºæ¥åˆ°

  ```js
  let p = Promise.resolve();

  p.then(() => {
    console.log('THEN 1');
    p.then(() => console.log('Hook'));
  });

  p.then(() => console.log('THEN 2'));

  // THEN 1
  // THEN 2
  // Hook        // ğŸ‘
  ```

- è¶…æ—¶ä¸è°ƒç”¨: åœ¨å›è°ƒä¸­, å¦‚æœä¸‰æ–¹å‡½æ•°ä¸è°ƒç”¨, æˆ‘ä»¬ä¹Ÿæ²¡åŠæ³•, ä½†æ˜¯åœ¨ Promise ä¸­, å¯ä»¥é€šè¿‡ `Promise.race()` çš„æ–¹å¼è§£å†³è¿™ä¸€é—®é¢˜

  ```js
  function timeOutError(t) {
    return new Promise((_, reject) => {
      setTimeout(() => reject('TIME OUT'), t);
    });
  }

  Promise.race([
    new Promise((resolve) => {
      setTimeout(() => resolve('OK'), 3000);
    }),
    timeOutError(2000),
  ]).then(
    (d) => console.log('T1 FUL: ', d),
    (d) => console.log('T1 REJ: ', d)
  );

  Promise.race([
    new Promise((resolve) => {
      setTimeout(() => resolve('OK'), 1000);
    }),
    timeOutError(2000),
  ]).then(
    (d) => console.log('T2 FUL: ', d),
    (d) => console.log('T2 REJ: ', d)
  );

  // T2 FUL:  OK
  // T1 REJ:  TIME OUT
  ```

- è°ƒç”¨æ¬¡æ•°ä¸æ­£ç¡®: Promise ä¸€æ—¦ç¡®å®šå°±æ— æ³•æ›´æ”¹(ä¹‹åçš„ `resolve` / `reject` é™é»˜å¤±æ•ˆ), é€šè¿‡ `then` æ³¨å†Œçš„å‡½æ•°ä¹Ÿåªèƒ½æ‰§è¡Œä¸€æ¬¡

- ä¼ å‚å¼‚å¸¸: åœ¨å›è°ƒä¸­å¯èƒ½å‡ºç°å‚æ•°é•¿åº¦ä¸æ­£ç¡®, ä½†æ˜¯ Promise åªå…è®¸ä¼ å…¥ä¸€ä¸ªå‚æ•°, å¤šä¼ çš„å‚æ•°é™é»˜å¤±æ•ˆ

- å¼‚å¸¸å¤„ç†: åœ¨å›è°ƒä¸­, å¦‚æœä¸‰æ–¹å‡½æ•°å‡ºç°å¼‚å¸¸, å›è°ƒå‡½æ•°å¯èƒ½ä¸æ‰§è¡Œ. ä½†æ˜¯åœ¨ Promise ä¸­, è‹¥æ‰§è¡Œå‡ºç°å¼‚å¸¸, Promise ä¼šè‡ªåŠ¨æ‰§è¡Œ reject, æ•è·å¼‚å¸¸å¹¶ä¼ é€’åˆ°åç»§å‡½æ•°.

**ä¸ºä»€ä¹ˆæ˜¯ `resolve` è€Œä¸æ˜¯ `fulfill`**

Promise çš„çŠ¶æ€æœ‰ `pending` & `fulfilled` & `rejected`, ä½†æ˜¯æˆ‘ä»¬åœ¨æ„é€  Promise å›è°ƒçš„æ—¶å€™ä¹ æƒ¯ä¸Šå†™çš„å´æ˜¯ `resolve` & `reject`. ä¸ºä»€ä¹ˆè¿™é‡Œä¸ç”¨ `fulfill` & `reject` å‘¢?

`fulfilled` è¡¨ç¤º Promise è¢«æ¥å—, è€Œ `rejected` è¡¨ç¤ºè¢«æ‹’ç». ç„¶è€Œ Promise æ„é€ å‡½æ•°ä¸Šçš„ `resolve & reject` åŠŸèƒ½å´ä¸æ˜¯è¿™æ ·çš„

- `reject` è°ƒç”¨ä¼šè®© Promise æ— æ¡ä»¶å˜ä¸º `rejected`, ä¸”åŸå› ä¸ºä¼ å…¥çš„å‚æ•°

- `resolve` è°ƒç”¨ä¼šè®© Promise å˜ä¸ºè°ƒç”¨ `Promise.resolve` åçš„ç»“æœ. å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ª Error, Promise å°†å˜ä¸º `rejected`

  ```js
  new Promise((resolve) => {
    resolve(Promise.reject());
  }).then(
    () => console.log('FLU'),
    () => console.log('REJ')
  );
  
  // REJ
  ```

  ä¹Ÿå°±æ˜¯è¯´ `resolve` ä¸ä¼šè®© Promise æ— æ¡ä»¶å˜ä¸º `fulfilled`, è¿™ä¹Ÿå°±æ˜¯ä¸ç”¨ `fulfill` çš„åŸå› 

**é“¾å¼è°ƒç”¨**

- Promise æ¯æ¬¡è°ƒç”¨ `then` éƒ½ä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª Promise æ›¿ä»£åŸ Promise
- è‹¥ `then` ä¸­å‡½æ•°è¿”å›é Promise, åˆ™è‡ªåŠ¨ä¸ºå…¶åŒ…ä¸Š `Promise.resolve`. ä¸è¿”å›åˆ™ç›¸å½“äºè¿”å› `undefined` å³è¿”å› `Promise.resolve(undefined)`
- `then` ä¸­å‡½æ•°çš„è¿”å›å€¼å°†è¢«ç”¨ä½œä¸‹ä¸€ä¸ª `then` ä¸­å‡½æ•°çš„å‚æ•°.
- `then` ä¸­çš„å‡½æ•°æŠ›å‡ºé”™è¯¯, å¹¶ä¸ä¼šå¼•å…¨å±€é”™è¯¯, è€Œæ˜¯ä¼šè¿”å› `Promise.reject` äº¤ç”±ä¸‹ä¸€ä¸ª `then` å¤„ç†.
- `then` å‡½æ•°æœ‰ä¸¤ä¸ªé»˜è®¤å€¼, ç¬¬ä¸€ä¸ªä¼šå°†æ”¶åˆ°çš„å‚æ•°é‡æ–° `resolve` ä¼ ç»™ä¸‹ä¸€çº§, ç¬¬äºŒä¸ªä¼šå°†ä¼ å…¥çš„å‚æ•°é‡æ–°ä½œä¸ºé”™è¯¯æŠ›å‡º
- `catch(fn)` ç›¸å½“äº `then(undefined, fn)`

**ä¸ºä»€ä¹ˆä¸æ˜¯ `try...catch`**

Promise ä¸­ä½¿ç”¨ `reject` è€Œä¸æ˜¯ `try...catch` çš„åŸå› æ˜¯ `reject` å¯ä»¥å¼‚æ­¥çš„å¤„ç†é”™è¯¯.

**å¹¶å‘**

- `Promise.all` å¯ä»¥å®ç°å¹¶å‘æ‰§è¡Œ, ä¼ å…¥ `Promise.all` æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åœ¨æ‰§è¡Œå‰éƒ½ä¼šè¢« `Promise.resolve` è¿‡æ»¤ä¸€é. è‹¥æ‰§è¡Œæ—¶å‡ºç°äº†ä¸€ä¸ª `reject` åˆ™ç›´æ¥è¿”å› `reject`, å¦åˆ™å…¨éƒ¨æ‰§è¡Œå¹¶è¿”å›ç»“æœæ•°ç»„
- `Promise.race` æ— è®ºç»“æœå¦‚ä½•, åªè¿”å›ç¬¬ä¸€ä¸ª. (ä¸º `Promise.race` ä¼ å…¥ç©ºæ•°ç»„ä¼šå¯¼è‡´ Promise æ°¸è¿œå¤„äº `pedding` çŠ¶æ€)
- `Promise.none`: `Promise.all` çš„åé¢, åªæœ‰å…¨ `rejected` æ‰è¿”å›æ•°ç»„
- `Promise.any`: å¿½ç•¥æ‹’ç», è¿”å›ç¬¬ä¸€ä¸ª `fulfilled`, è‹¥éƒ½å¤±è´¥åˆ™è¿”å›å¤±è´¥
- `Promise.first`: ~~å’Œ any ä¸€æ ·~~
- `Promise.last`: è¿”å›æœ€åä¸€ä¸ªæˆåŠŸ

**ç¼ºé™·**

~~å…¶å®æˆ‘è§‰å¾—è¿™éƒ½ä¸æ˜¯ç¼ºé™·~~

1. æ— æ³•å¯é æ•è· `Promise` æœ€ç»ˆçš„ç»“æœ: æˆ‘ä»¬ä¸çŸ¥é“ Promise ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œ, ä¹Ÿæ— æ³•çŸ¥é“ Promise æ˜¯å¦å‡ºç°é”™è¯¯. æœ€ç®€å•çš„æƒ³æ³•æ˜¯åœ¨ Promise æœ€åæ³¨å†Œä¸€ä¸ª `then` ç”¨äºé€šçŸ¥ Promise æ‰§è¡Œå®Œæˆ. ä½†æ˜¯, å¦‚æœè¿™ä¸ªè¿™ä¸ªå‡½æ•°å‡ºé”™äº†, æˆ‘ä»¬å°†æ— æ³•å¾—çŸ¥ Promise æœ€åæ˜¯ `fulfilled` è¿˜æ˜¯ `rejected`. å”¯ä¸€çš„å¯è¡Œæ–¹æ³•æ˜¯åˆ©ç”¨æµè§ˆå™¨çš„åƒåœ¾å›æ”¶æœºåˆ¶, è‹¥ä¸€ä¸ª Promise å¤„äºå¾…å›æ”¶çŠ¶æ€, é‚£ä¹ˆè¿™ä¸ª Promise è‚¯å®šæ˜¯æ‰§è¡Œå®Œäº†, è¿™ä¸ªæ—¶å€™å¯ä»¥æ£€æµ‹ Promise çš„çŠ¶æ€
2. ä¸€æ—¦ç¡®å®šæ— æ³•ä¿®æ­£: Promise ä¸€æ—¦åšå‡ºå†³å®šå°±æ— æ³•å˜åŒ–, è¿™æ„å‘³ç€å¾ˆéš¾è®© Promise åšé‡å¤æ€§å·¥ä½œ(ä¸€æ—¦ç›‘å¬åˆ°é¼ æ ‡æŒ‰ä¸‹å°±æ‰§è¡Œå‡½æ•°), æˆ‘ä»¬åªèƒ½å€ŸåŠ©è¾…åŠ©å‡½æ•°ä¸æ–­çš„ç”Ÿæˆæ–°çš„ Promise
3. æ— æ³•å–æ¶ˆ. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Promise.race` å®ç°è¶…æ—¶æŠ¥é”™, ä½†æ˜¯æŠ¥é”™å¹¶ä¸ä¼šå½±å“è¶…æ—¶çš„ Promise ç»§ç»­æ‰§è¡Œ.

### ç”Ÿæˆå™¨

Promise è§£å†³äº†å¼‚æ­¥çš„ä¿¡ä»»é—®é¢˜, è€Œç”Ÿæˆå™¨è§£å†³äº†å›è°ƒåœ°ç‹±é—®é¢˜. å°†å¼‚æ­¥ä»£ç è½¬æ¢ä¸ºçœ‹ä¼¼åŒæ­¥çš„é¡ºåºä»£ç é£æ ¼.

**å¼‚æ­¥æ‰§è¡Œ**

ç”Ÿæˆå™¨è¿”å›ä¸€ä¸ªè¿­ä»£å™¨, è°ƒç”¨è€…å¯ä»¥åœ¨ä»»ä½•æ—¶æœºè°ƒç”¨è¿­ä»£å™¨ä»¥å®ç°çœ‹ä¼¼åŒæ­¥çš„å¼‚æ­¥è°ƒç”¨. ä¸€ä¸ªç”Ÿæˆå™¨å¯ä»¥ç”Ÿæˆå¤šä¸ªè¿­ä»£å™¨. è¿™äº›è¿­ä»£å™¨ä¹‹é—´å¯ä»¥äº¤æ›¿æ‰§è¡Œ, è¿­ä»£å™¨ä¹‹é—´ç‹¬ç«‹æ— æ³•ç›´æ¥é€šä¿¡, ä½†æ˜¯å¯ä»¥é€šè¿‡å¤–éƒ¨å˜é‡é—­åŒ…é€šä¿¡.

**åŒå‘æ•°æ®ä¼ é€’**

æˆ‘ä»¬å¸Œæœ›åœ¨æ¯æ¬¡è°ƒç”¨è¿­ä»£å™¨æ—¶å€™éƒ½èƒ½ä¸ºç”Ÿæˆå™¨ä¼ å…¥å‚æ•°, å¹¶è·å¾—è¿­ä»£å™¨çš„ç›¸åº”. å¯ä»¥é€šè¿‡ `yield X` æˆ– `return X` çš„æ–¹å¼è·å–è¿”å›å€¼, é€šè¿‡ `yield` ä¼ å…¥å‚æ•°

```js
function* foo(x) {
  console.log('B');
  let y = x * (yield 'C');
  // 3.      ^ æ‰§è¡Œåˆ°è¿™é‡Œå°±åœä¸‹, è¿”å› C
  console.log('D');
  return y; // <- 5. æ‰§è¡Œåˆ°è¿™é‡Œ, è¿”å› y
}

const it = foo(2); // 1. åªæ˜¯è¿”å›ç”Ÿæˆå™¨, ä½†æ˜¯ä¸€ç‚¹éƒ½ä¸æ‰§è¡Œ
console.log('A');
console.log(it.next()); // 2. å¼€å§‹æ‰§è¡Œç”Ÿæˆå™¨
console.log(it.next(3)); // 4. ä¼ å…¥ 3 ç»§ç»­æ‰§è¡Œ
```

**æ„é€ è¿­ä»£å™¨**

ä¸ºå¯¹è±¡åŠ å…¥ `[Symbol.iterator]` & `next` æ–¹æ³•, å³å¯å°†å¯¹è±¡å˜ä¸ºè¿­ä»£å™¨.

- `[Symbol.iterator]` æ–¹æ³•æ˜¯ä¸€ä¸ªè®¡ç®—å±æ€§, ä¸ TypeScript çš„è®¡ç®—å±æ€§ä¸€æ ·, `Symbol.iterator` å°±æ˜¯ `Symbol` çš„é™æ€æˆå‘˜. è¯¥æ–¹æ³•åº”è¯¥è¿”å›ä¸€ä¸ªè¿­ä»£å™¨è‡ªèº«.
- `next` æ–¹æ³•è¿”å› `{done: boolean, value: }` å¯¹è±¡.

`for...of`å¯ä»¥å®ç°éå†è¿­ä»£å™¨

```js
const it = {
  [Symbol.iterator]: function () {
    return this;
  },
  next() {
    // è¿”å›ä¸€ä¸ªéšæœºæ•°
    return { done: false, value: Math.random() };
  },
};

for (i of it) { // æ°¸è¿œä¸ done å°±ä¼šé™·å…¥æ­»å¾ªç¯
  console.log(i);
}
```

**ç”Ÿæˆå™¨ä¸è¿­ä»£å™¨**

ä¸ºç”Ÿæˆå™¨äº§ç”Ÿçš„è¿­ä»£å™¨åšä¸€äº›æ”¹é€ å¯ä»¥å®ç°ç‰¹æ®ŠåŠŸèƒ½

- å®ç°ä¸€ä¸ªè®¡æ•°å™¨

  ```js
  function* foo() {
    let cnt = 0;
    while (true) {
      yield ++cnt;
    }
  }

  const counter1 = foo();
  const counter2 = foo();

  console.log(counter1.next()) // 1
  console.log(counter2.next()) // 1
  console.log(counter1.next()) // 2
  console.log(counter1.next()) // 3
  ```

- å®ç°å…³é—­è¿­ä»£å™¨é’©å­

  ```js
  function* foo() {
    let cnt = 0;
    try {
      while (true) {
        yield ++cnt;
      }
    } finally {
      // ç›¸å½“äºå®ç°äº†ä¸€ä¸ªæ‰§è¡Œç»“æŸçš„é’©å­, å¯ä»¥ç”¨æ¥åšåƒåœ¾å›æ”¶
      console.log('OK I will clean all the code');
    }
  }
  
  const counter1 = foo();
  const counter2 = foo();
  
  console.log(counter1.next()); // 1
  console.log(counter2.next()); // 1
  console.log(counter1.next()); // 2
  console.log(counter1.next()); // 3
  // å…³é—­ç”Ÿæˆå™¨, æ‰§è¡Œ finally
  counter2.return();
  ```

**åŒæ­¥é£æ ¼çš„å¼‚æ­¥ä»£ç **

```js
function foo(x,y) {
	ajax(
		"http://some.url.1/?x=" + x + "&y=" + y,
		function(err,data){
			if (err) {
				// å‘`*main()`ä¸­æ‰”è¿›ä¸€ä¸ªé”™è¯¯
				it.throw( err );
			}
			else {
				// ä½¿ç”¨æ”¶åˆ°çš„`data`æ¥ç»§ç»­`*main()`
				it.next( data );
			}
		}
	);
}

function *main() {
	try {
		var text = yield foo( 11, 31 ); // è¿”å›å¹¶æ‰§è¡Œå¼‚æ­¥, å¼‚æ­¥æ‰§è¡Œåä¼šè°ƒç”¨ç”Ÿæˆå™¨ä¸‹ä¸€æ­¥. åŒæ—¶æ”¯æŒé”™è¯¯å¤„ç†
		console.log( text );
	}
	catch (err) {
		console.error( err );
	}
}

var it = main();

// ä½¿ä¸€åˆ‡å¼€å§‹è¿è¡Œï¼
it.next();
```

**ç”Ÿæˆå™¨ä¸Promise**

è¿­ä»£å™¨å¯ä»¥ç”¨æ¥å†™å¼‚æ­¥ä»£ç ä¸”ä¸äº§ç”Ÿå›è°ƒåœ°ç‹±. ä½†æ˜¯ç”Ÿæˆå™¨éœ€è¦å¤–ç•Œä¸æ–­æ§åˆ¶è‡ªå·±æ‰§è¡Œä¸‹ä¸€å—ä»£ç . è¿™ä¸ªå·¥ä½œå¦‚æœç”± Promise å®Œæˆé‚£å°±ä¼šå˜å¾—ååˆ†ä¼˜é›…

```js
function* foo() {
  let a = yield request('demo.com'); // request ä¼šè¿”å›ä¸€ä¸ª Promise
  try {
    console.log('GET', a);
  } catch {
    console.log('ERROR', a);
  }
}

let it = foo();
let p = it.next().value; // p ç°åœ¨æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡

it.then(
  (d) => it.next(d),
  (e) => it.throw(e)
); // è®© Promise æ‰§è¡Œæµç¨‹æ§åˆ¶
```

åœ¨è¿™é‡Œ, Promise çš„å¼‚æ­¥æ§åˆ¶åªæ˜¯åœ¨ç¨‹åºæ‰§è¡ŒæˆåŠŸä¸å‡ºé”™çš„æ—¶å€™è¿”å›ä¸æŠ›å‡ºæ¶ˆæ¯. å®Œå…¨å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°å®ç°

```js
// æ„Ÿè°¢Benjamin Gruenbaum (@benjamingråœ¨GitHub)åœ¨æ­¤åšå‡ºçš„å·¨å¤§æ”¹è¿›ï¼
function run(gen) {
	var args = [].slice.call( arguments, 1), it;

	// åœ¨å½“å‰çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­åˆå§‹åŒ–generator
	it = gen.apply( this, args );

	// ä¸ºgeneratorçš„å®Œæˆè¿”å›ä¸€ä¸ªpromise
	return Promise.resolve()
		.then( function handleNext(value){
			// è¿è¡Œè‡³ä¸‹ä¸€ä¸ªè®©å‡ºçš„å€¼
			var next = it.next( value );

			return (function handleResult(next){
				// generatorå·²ç»å®Œæˆè¿è¡Œäº†ï¼Ÿ
				if (next.done) {
					return next.value;
				}
				// å¦åˆ™ç»§ç»­æ‰§è¡Œ
				else {
					return Promise.resolve( next.value )
						.then(
							// åœ¨æˆåŠŸçš„æƒ…å†µä¸‹ç»§ç»­å¼‚æ­¥å¾ªç¯ï¼Œå°†è§£æçš„å€¼é€å›generator
							handleNext,

							// å¦‚æœ`value`æ˜¯ä¸€ä¸ªæ‹’ç»çš„promiseï¼Œå°±å°†é”™è¯¯ä¼ æ’­å›generatorè‡ªå·±çš„é”™è¯¯å¤„ç†g
							function handleErr(err) {
								return Promise.resolve(
									it.throw( err )
								)
								.then( handleResult );
							}
						);
				}
			})(next);
		} );
}
```

åœ¨ ES7 ä¸­, è¿˜å¯ä»¥ä½¿ç”¨ `async` & `await` å®ç°ä¸Šè¿°åŠŸèƒ½

**å¹¶å‘**

å¯ä»¥å€ŸåŠ© Promise API å®ç°å¹¶å‘(è¿™ä¹Ÿå¯ç¤ºäº†æˆ‘ä»¬åº”è¯¥åœ¨å“ªé‡Œä½¿ç”¨ `async` & `await`)

```js
function* foo() {
  let [a, b] = yield Promise.all([
    request('demo-partA.com'),
    request('demo-partB.com'),
  ]);
  let c = yield request(`demo-full.com?a=${a}&b=${b}`);
  console.log(c);
}

let it = foo();
let p = it.next().value; // p ç°åœ¨æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡

it.then((d) => it.next(d)); // è®© Promise æ‰§è¡Œæµç¨‹æ§åˆ¶
```

**ç”Ÿæˆå™¨å§”æ‰˜**

å¯ä»¥å°†ç”Ÿæˆå™¨åµŒå¥—ç”Ÿæˆå™¨ç›´æ¥æ‰å¹³åŒ–ä¸ºä¸€ç»´ç”Ÿæˆå™¨

```js
function* foo() {
  console.log(yield);
  console.log(yield);
}

function* bar() {
  console.log(yield);
  let it = foo();
  it.next();
  it.next(yield);
  it.next(yield);
  console.log(yield);
}

let it = bar();
it.next();
it.next(1);
it.next(2);
it.next(3);
it.next(4);
```

å˜ä¸º

```js
function* foo() {
  console.log(yield);
  console.log(yield);
}

function* bar() {
  console.log(yield);
  yield *foo() // åœ¨è°ƒç”¨çš„æ—¶å€™å¸¦ä¸Š * è¿™æ ·ç›¸å½“äºå®ç°äº†ç”Ÿæˆå™¨"è½¬ç§»"
  console.log(yield);
}

let it = bar();
it.next();
it.next(1);
it.next(2);
it.next(3);
it.next(4);
// 1 2 3 4
```

ç”Ÿæˆå™¨å§”æ‰˜çš„å¯¹è±¡å¯ä»¥æ˜¯ä»»ä½•å¯è¿­ä»£çš„å€¼

```js
let foo = [9, 8];

function* bar() {
  console.log(yield);
  yield* foo;
  console.log(yield);
}

let it = bar();
it.next();
console.log(it.next(1).value);
console.log(it.next().value);
it.next();
it.next(2);

// 1 9 8 2
```

ä¹Ÿå¯ä»¥å§”æ‰˜å¼‚å¸¸

```js
function *foo() {
	try {
		yield "B";
	}
	catch (err) {
		console.log( "error caught inside `*foo()`:", err );
	}

	yield "C";

	throw "D";
}

function *bar() {
	yield "A";

	try {
		yield *foo();
	}
	catch (err) {
		console.log( "error caught inside `*bar()`:", err );
	}

	yield "E";

	yield *baz();

	// note: can't get here!
	yield "G";
}

function *baz() {
	throw "F";
}

var it = bar();

console.log( "outside:", it.next().value );
// outside: A

console.log( "outside:", it.next( 1 ).value );
// outside: B

console.log( "outside:", it.throw( 2 ).value );
// error caught inside `*foo()`: 2
// outside: C

console.log( "outside:", it.next( 3 ).value );
// error caught inside `*bar()`: D
// outside: E

try {
	console.log( "outside:", it.next( 4 ).value );
}
catch (err) {
	console.log( "error caught outside:", err );
}
// error caught outside: F
```

**å½¢å®è½¬æ¢(Thunk)**

ä¸€ç§å¤è€çš„æ¨¡å¼: æ‰§è¡ŒæŸä¸ªæ— å‚å‡½æ•°, ç›¸å½“äºè¿™ä¸ªå¦ä¸€ä¸ªå‡½æ•°. ä¾‹å¦‚

```js
function foo(x,y) {
	return x + y;
}

function fooThunk() {
	return foo( 3, 4 );
}

// ç¨å
console.log( fooThunk() );	// 7
```

å®é™…ä¸Š, è¿™ç§æ¨¡å¼ä¹Ÿå®ç°äº†å¼‚æ­¥. ä½†æ˜¯ Thunk çš„æ— å‚æ„å‘³ç€ç¡¬ç¼–ç . å¯ä»¥é€šè¿‡å·¥å‚å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜.

**polyfill**

æˆ‘ä»¬å¯ä»¥è½»æ¾å®ç° Promise çš„å…¼å®¹ä»£ç , å› ä¸º Promise æ˜¯ä¸€ä¸ªAPI, ä½†æ˜¯ç”Ÿæˆå™¨æ˜¯ä¸€ç§è¯­æ³•. æˆ‘ä»¬æ²¡æ³•å®ç°å…¼å®¹. å¯ä»¥å…ˆçœ‹çœ‹ç”Ÿæˆå™¨çš„å®ç°

```js
function foo(url) {
	// ç®¡ç† generator çŠ¶æ€
	var state;

	// generator-èŒƒå›´çš„å˜é‡å£°æ˜
	var val;

	function process(v) {
		switch (state) {
			case 1:
				console.log( "requesting:", url );
				return request( url );
			case 2:
				val = v;
				console.log( val );
				return;
			case 3:
				var err = v;
				console.log( "Oops:", err );
				return false;
		}
	}

	// åˆ¶é€ å¹¶è¿”å› iterator
	return {
		next: function(v) {
			// åˆå§‹çŠ¶æ€
			if (!state) {
				state = 1;
				return {
					done: false,
					value: process()
				};
			}
			// æˆåŠŸåœ°è®©å‡ºç»§ç»­å€¼
			else if (state == 1) {
				state = 2;
				return {
					done: true,
					value: process( v )
				};
			}
			// generator å·²ç»å®Œæˆäº†
			else {
				return {
					done: true,
					value: undefined
				};
			}
		},
		"throw": function(e) {
			// åœ¨çŠ¶æ€ *1* ä¸­ï¼Œæœ‰å”¯ä¸€æ˜ç¡®çš„é”™è¯¯å¤„ç†
			if (state == 1) {
				state = 3;
				return {
					done: true,
					value: process( e )
				};
			}
			// å¦åˆ™ï¼Œæ˜¯ä¸€ä¸ªä¸ä¼šè¢«å¤„ç†çš„é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»…ä»…æŠŠå®ƒæ‰”å›å»
			else {
				throw e;
			}
		}
	};
}
```

å¦‚æœçœŸçš„éœ€è¦åœ¨ä¸æ”¯æŒ ES6 çš„ç¯å¢ƒä¸‹å®ç°ç”Ÿæˆå™¨. å¯ä»¥è€ƒè™‘ä»£ç è½¬è¯‘å·¥å…·.


## æ€§èƒ½

### æ€§èƒ½æå‡

å¼‚æ­¥å¯ä»¥å®ç°å¤šä»»åŠ¡å¹¶å‘å¹¶æ˜¾è‘—æé«˜æ€§èƒ½. JavaScript ä¸­å…¶ä»–æ€§èƒ½æå‡ç‰¹æ€§æœ‰

**Web Worker([MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers))**

Web Worker å¹¶ä¸æ˜¯ ES æ ‡å‡†è¯­æ³•, åªæ˜¯å®¿ä¸»ç¯å¢ƒçš„åŠŸèƒ½. å…¶å¯ä»¥æä¾›ä¸€ä¸ªå¹¶è¡Œçš„, ä¸å…±äº«ä½œç”¨åŸŸä¸èµ„æºçš„æ–°çº¿ç¨‹. é€šè¿‡ä¸ä¸»çº¿ç¨‹ `post` & `listen` æ¶ˆæ¯å®ç°é€šä¿¡. æ¶ˆæ¯ä¼ é€’æœ‰å¦‚ä¸‹æ–¹å¼

- è½¬æ¢ä¸º String
- [ç»“æ„åŒ–æ‹·è´](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Structured_clone_algorithm): é«˜çº§çš„å…‹éš†ç®—æ³•, æ”¯æŒå¾ªç¯å¼•ç”¨ç­‰ç‰¹æ®Šå¯¹è±¡çš„æ‹·è´
- [æ‰€æœ‰æƒè½¬ç§»](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E9%80%9A%E8%BF%87%E8%BD%AC%E8%AE%A9%E6%89%80%E6%9C%89%E6%9D%83%E5%8F%AF%E8%BD%AC%E8%AE%A9%E5%AF%B9%E8%B1%A1%E6%9D%A5%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE): ç›´æ¥å°†å¯¹è±¡çš„å¼•ç”¨ä¸æ‰€æœ‰æƒå‘ç»™ Worker, æ­¤æ—¶å®¿ä¸»å‡½æ•°æ— æ³•è®¿é—®å¯¹è±¡

Web Worker ä¹Ÿæ”¯æŒåˆ›å»ºå…±äº« Worker(å¹¶ä¸æ˜¯èµ„æºå…±äº«, è€Œæ˜¯ä¸€ä¸ª Worker å¯ä»¥ä¸å¤šä¸ªå®¿ä¸»é€šè¡Œ). åœ¨å®ç°å…±äº« Worker æ—¶, éœ€è¦ä¸ºæ¯æ¬¡é€šè¡Œå»ºç«‹æ–°çš„ port

**SIMD**

å•æŒ‡ä»¤å¤šæ•°æ®(SIMD)æ˜¯ä¸€ç§æ•°æ®å¹¶è¡Œæ–¹æ³•. å…¶åŸç†æ˜¯å°†å¤šä¸ªå°æ•°æ®æ‹¼æˆä¸€ä¸ªå¤§æ•°æ®ä¸€èµ·è¿ç®—. CPU å°†å…¶åº•å±‚ API æš´éœ²ç»™ JavaScript ä»¥å®ç°é«˜æ•ˆè®¡ç®—

**asm.js**

æ˜¯ä¸€ä¸ª JavaScript å­é›†(åªä¿ç•™å¯ä¼˜åŒ–çš„è¯­æ³•), å¯ä»¥å°† JavaScript ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶

### æ€§èƒ½æµ‹è¯•

é”™è¯¯çš„æµ‹è¯•æ–¹æ³•: å¤šæ¬¡å¾ªç¯æµ‹æ‰§è¡Œæ—¶é—´

**é—®é¢˜**

- è®¡æ—¶å™¨æœ¬èº«æœ‰ä¸å¯å¿½è§†çš„è¯¯å·®
- ä¸èƒ½é€šè¿‡ç®€å•çš„é™¤ä»¥æµ‹è¯•æ¬¡æ•°çš„æ–¹æ³•è®¡ç®—å•æ¬¡æ‰§è¡Œæ—¶é—´(è€ƒè™‘åˆ°æç«¯æ•°æ®, æ‰§è¡Œäº‹ä»¶æ–¹å·®ç­‰). åº”è¯¥ç”¨ä¸€ç³»åˆ—ç»Ÿè®¡å­¦æ–¹æ³•è¡¡é‡æ‰§è¡Œæ—¶é—´
- æŒ‡ä»¤é€šè¿‡å¾ªç¯æµ‹å¾—çš„æ‰§è¡Œæ•ˆç‡ä¸çœŸå®ç¯å¢ƒçš„æ‰§è¡Œæ•ˆç‡å¯èƒ½ä¸åŒ

**è§£å†³æ–¹æ¡ˆ**

- [Benchmark.js](https://benchmarkjs.com/): æä¾›äº†ä¸€å¥—æ€§èƒ½æ£€æµ‹æ¡†æ¶, æä¾›è¯¦ç»†çš„æµ‹è¯•ç»“æœ
- [jsPerf.com](https://github.com/jsperf/jsperf.com): è¯¥ç½‘ç«™æä¾›ä¸åŒ JavaScript è¿è¡Œæ—¶æ€§èƒ½æµ‹è¯•

**ä¼˜åŒ–å“ªäº›**

- å…¨å±€è§†è§’: ä¸“æ³¨ä¼˜åŒ–æ‰§è¡Œé¢‘ç‡æé«˜çš„éƒ¨åˆ†

  > éå…³é”®è·¯å¾„çš„ä¼˜åŒ–éƒ½æ˜¯ä¸‡æ¶ä¹‹æº

- å¾®ä¼˜åŒ–: ä¸å…³æ³¨å¾®ä¼˜åŒ–(å¦‚: `++a` ä¸ `a++` çš„åŒºåˆ«, `x >>> 1` ä¸ `x/2` çš„åŒºåˆ«), ç¼–è¯‘å™¨ä¼šåœ¨æ‰§è¡Œå‰è‡ªåŠ¨ä¼˜åŒ–. è™½ç„¶ä¸åŒå¼•æ“ä¼˜åŒ–ä¸å°½ç›¸åŒ, ä½†æ˜¯

  > æ°¸è¿œä¸è¦è§‰å¾—è‡ªå·±æ¯”å¼•æ“èªæ˜

  è¿™äº›å¾®ä¼˜åŒ–å¾ˆå¯èƒ½éšç€å¼•æ“ç§ç±»çš„ä¸åŒ, å¼•æ“ç‰ˆæœ¬çš„ä¸åŒè€Œå¤±æ•ˆ.

- å°¾è°ƒç”¨ä¼˜åŒ–(TCO): ES6 çš„ä¸€ä¸ªç‰¹æ®Šä¼˜åŒ–.

  å½“ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°æ—¶, å¼•æ“éœ€è¦å¼€è¾Ÿä¸€ä¸ªè€Œå¤–çš„ç©ºé—´(æ ˆå¸§)ç®¡ç†è°ƒç”¨æ ˆ. ä½†æ˜¯å¦‚æœå‡½æ•°è°ƒç”¨å‘ç”Ÿåœ¨å‡½æ•°æœ€å, é‚£ä¹ˆå¼•æ“å°±æ— éœ€å¼€è¾Ÿæ–°æ ˆå¸§, ç›´æ¥è¦†ç›–ä½¿ç”¨è€æ ˆå¸§å³å¯.

  ```js
  function foo(x) {
  	return x;
  }
  
  function bar(y) {
  	return foo( y + 1 );	// å°¾éƒ¨è°ƒç”¨
  }
  
  function baz() {
  	return 1 + bar( 40 );	// ä¸æ˜¯å°¾éƒ¨è°ƒç”¨, å› ä¸ºè°ƒç”¨åè¿˜è¦æ‰§è¡ŒåŠ æ³•
  }
  
  baz();  // 42
  ```

## å›é¡¾ JavaScript

- åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­é€šè¿‡ JavaScript è¾“å…¥å­—ç¬¦ä¸²

  ```js
  const v = prompt('Please input a string');
  console.log(v);
  ```

- åœ¨æ³¨é‡Šä¸­åº”è¯¥å†™çš„æ˜¯ç¨‹åºä¸ºä»€ä¹ˆæ˜¯è¿™æ ·è¿è¡Œçš„, è€Œä¸æ˜¯ç¨‹åºæ˜¯ä»€ä¹ˆ(æš´è®º)

- JavaScript ä¸­é€šå¸¸ä½¿ç”¨å…¨å¤§å†™ä¹¦å†™å˜é‡å¹¶ä½¿ç”¨ `_` è¿æ¥å•è¯(æŒ‡çš„æ˜¯å¸¸é‡è€Œä¸æ˜¯ä¸å˜çš„const)

- `?:` è¿ç®—ç¬¦ä¸ä¸€å®šç”¨åœ¨èµ‹å€¼ä¸Š, ä½†æ˜¯è¿™è‚¯å®šæ˜¯æœ€å¸¸è§çš„

- åŸºäºåŸå‹é“¾çš„ç»§æ‰¿æ–¹æ¡ˆä¸ç±»ç»§æ‰¿æ–¹æ¡ˆæ˜¯ä¸¤å¥—å®Œå…¨ä¸åŒçš„è®¾è®¡æ¨¡å¼. åŸå‹é“¾ç»§æ‰¿çš„ä¸»è¦æ€æƒ³æ˜¯å§”æ‰˜.

- å…¼å®¹æ–¹æ¡ˆ

  - polufilling: ç›´æ¥å®ç°æŸä¸ªæ–°åŠŸèƒ½API
  - transpliling: é€šè¿‡è½¬è¯‘å®ç°æ–°è¯­æ³•

## ES6

### è¯­æ³•

**Let & Const**

- æ–°å¢ `let & const` å£°æ˜, è¿™ä¿©éƒ½å…·æœ‰å—ä½œç”¨åŸŸå…¶ä¸ä¼šå‘ç”Ÿæå‡. `let` å£°æ˜ä¼šäº§ç”Ÿæš‚æ—¶æ€§æ­»åŒº(TDZ)é—®é¢˜, å»ºè®®åœ¨å—é¦–ç¬¬ä¸€è¡Œå°±ä¸€èµ·å£°æ˜ `let` å˜é‡

  ```js
  {
    let a = 1, b = 2, c, d; //æœ€å¥½æ”¾ä¸€è¡Œ, æ–¹ä¾¿çœ‹. æš‚æ—¶æ— æ³•èµ‹å€¼çš„å°±åªå£°æ˜ä»¥è§„é¿ TDZ
    console.log(a, b);
    c = a + b;
    d = a * b;
    console.log(c, d);
  }
  ```

- åœ¨ `for` çš„æ‹¬å·ä¸­ä½¿ç”¨ `let` å£°æ˜è¿­ä»£å˜é‡ç›¸å½“äºä¸ºæ¯ä¸ªå¾ªç¯å—ä¸­å£°æ˜äº†ä¸€æ¬¡å˜é‡(è£¸ç€å¯ä»¥ç†è§£ä¸ºæ¡ä»¶éƒ¨åˆ†ä¸å¾ªç¯ä½“ä¹‹é—´æœ‰ä¸€å±‚ä½œç”¨åŸŸ)

  ```js
  for (let i = 0; i < 10; i++) { // ç›¸å½“äºä¸ºæ¯ä¸ªå¾ªç¯ä½“å£°æ˜äº†ä¸€ä¸ª i
    console.log(i);
  }
  ```

**å‡½æ•°**

- å‡½æ•°å®å‚éƒ¨åˆ†æœ‰è‡ªå·±çš„å—ä½œç”¨åŸŸ

  ```js
  var w = 1, z = 2;

  // åœ¨ä½œç”¨åŸŸå†…æ‰¾ä¸åˆ° w å°±å»å…¨å±€æ‰¾
  // åœ¨ä½œç”¨åŸŸå†…æ‰¾åˆ°äº† x ä¸” x å·²ç»å£°æ˜, ä¸å­˜åœ¨ TDZ, æå®š
  // åœ¨ä½œç”¨åŸŸå†…æ‰¾åˆ°äº† z ä½†æ˜¯ z è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–, æŠ›å‡ºå¼‚å¸¸
  function foo( x = w + 1, y = x + 1, z = z + 1 ) {
  	console.log( x, y, z );
  }

  foo();					// ReferenceError
  ```

- åªæœ‰å‘å‡½æ•°å®å‚ä¼ å…¥ `undefined` (æˆ–è€…ä¸ä¼ å‚)æ‰ä¼šè§¦å‘é»˜è®¤å€¼

- é»˜è®¤å€¼æ˜¯æƒ°æ€§æ±‚å€¼çš„(å¦‚æœæœ‰å‚æ•°ä¼ å…¥å°±ä¸è®¡ç®—é»˜è®¤å€¼çš„è¡¨è¾¾å¼äº†)

- å¦‚æœå¸Œæœ›é»˜è®¤å€¼æ˜¯ä¸€ä¸ªç©ºå‡½æ•°å¯ä»¥ä½¿ç”¨ `Function.prototype` è€Œä¸æ˜¯ `function() {}`

**è§£æ„ä¸èµ‹å€¼**

- å¯¹è±¡è§£æ„:

  - å¯¹è±¡è§£æ„ä¸å¯¹è±¡çš„è¡¨è¿°ä¸å¤ªç›¸åŒ, å¯¹è±¡çš„è¡¨è¿°æ˜¯ `æ ‡è¯†ç¬¦-å€¼` æ¨¡å¼, ä½†æ˜¯å¯¹è±¡çš„è§£æ„æ˜¯ `å¯¹åº”å±æ€§-ç›®æ ‡æ ‡è¯†ç¬¦`

    ```js
    var aa = 10, bb = 20;

    var o = { x: aa, y: bb }; // æ ‡è¯†ç¬¦: å€¼
    var     { x: AA, y: BB } = o; // å¯¹åº”å±æ€§: ç›®æ ‡æ ‡è¯†ç¬¦

    console.log( AA, BB );				// 10 20
    ```

  - åœ¨å¯¹è±¡è§£æ„ä¸­å¦‚æœå¯¹åº”å±æ€§å’Œç›®æ ‡æ ‡è¯†ç¬¦åŒå, å¯ä»¥åªå†™ç›®æ ‡æ ‡è¯†ç¬¦

    ```js
    const o = { a: 1, b: 2 };
    const { a, b } = o;
    ```

    å®é™…ä¸Šæ˜¯

    ```js
    const o = { a: 1, b: 2 };
    const { a: a, b: b } = o;
    ```

    ä¸­çœå» `a:` çš„ç»“æœ

  - åœ¨å¯¹è±¡è§£æ„ä¸­å¦‚æœå¯¹è±¡å‰æ²¡æœ‰å…³é”®å­—(å¦‚ `let / var / const`)å°±éœ€è¦ä¸ºåŠ ä¸€å±‚`()`é˜²æ­¢å°†å¯¹è±¡è§£æä¸ºä»£ç å—

    ```js
    const o = { a: 1, b: 2 };
    const { a: a, b: b } = o; // æ­£å¸¸ç‰ˆæœ¬
    { a: a, b: b } = o; // {} ä¼šè¢«è§£æä¸ºä»£ç å¿«
    ({ a: a, b: b } = o;) // ok
    ```

  - å¯¹è±¡è§£æ„æ—¶å…è®¸å‡ºç°è®¡ç®—å±æ€§

    ```js
    const o = { a: 1, b: 2, c: 3 };
    const t = {};
    for (let k of Object.keys(o)) {
      ({ [k]: t[k] } = o); // å‰è€…æ˜¯è®¡ç®—å±æ€§, åè€…åªæ˜¯å±æ€§è®¿é—®
    }
    console.log(t); // { a: 1, b: 2, c: 3 }
    ```

  - æ”¯æŒé‡å¤èµ‹å€¼

    ```js
    const o = { a: { b: 1, c: 2 } };

    const {
      a: na,
      a: { b: nb, c: nc },
    } = o;

    console.log(na, nb, nc); // { b: 1, c: 2 } 1 2
    ```

  - æ”¯æŒè¿ç¯èµ‹å€¼, ç”±äºèµ‹å€¼çš„ç»“æœå€¼æ˜¯åŸå€¼, æ‰€ä»¥æ”¯æŒåœ¨é“¾ä¸Šä¸å®Œå…¨è§£æ„

    ```js
    const o = { a: 0, b: 1, c: 2 };

    const { a: a1, b: b1 } = ({ a: a2, c: c2 } = { b: b3, c: c3 } = o);
    console.log(a1, b1, a2, c2, b3, c3); // 0 1 0 2 1 2
    ```

  - å¯¹è±¡è§£æ„é»˜è®¤å€¼

    å°±æ˜¯åœ¨ç›®æ ‡æ ‡è¯†ç¬¦åé¢åŠ ä¸Š `= x`

    ```js
    const { x, y, z, w: WW = 20 } = { x = 4, y = 5, z = 6 };
    console.log( x, y, z, WW );			// 4 5 6 20
    ```

    åŒæ—¶ç”±äºç®€åŒ–å¯¹è±¡è§£æ„æ˜¯ç®€åŒ–äº†å‰åŠéƒ¨åˆ† `x:` æ‰€ä»¥æ”¯æŒç®€å†™

    ```js
    var [ a = 3, b = 6, c = 9, d = 12 ] = [1, 2, 3]
    var { x = 5, y = 10, z = 15, w = 20 } = { x = 4, y = 5, z = 6 }
    ```

    ä½†æ˜¯ä¸è¦è¿‡åº¦ä¾èµ–, ä¼šä¸¥é‡é™ä½å¯è¯»æ€§

    ```js
    var x = 200, y = 300, z = 100;
    var o1 = { x: { y: 42 }, z: { y: z } };
    
    ( { y: x = { y: y } } = o1 );
    ( { z: y = { y: z } } = o1 );
    ( { x: z = { y: x } } = o1 );
    
    console.log( x.y, y.y, z.y ); // 300 100 42
    ```

- æ•°ç»„è§£æ„

  - æ”¯æŒéƒ¨åˆ†èµ‹å€¼

    ```js
    const arr = [1, 2, 3, 4];
    const [, a, , b] = arr;
    console.log(a, b);
    ```

- æ•°ç»„ / å¯¹è±¡è§£æ„æ”¯æŒåµŒå¥—

  ```js
  var a1 = [ 1, [2, 3, 4], 5 ];
  var o1 = { x: { y: { z: 6 } } };
  
  var [ a, [ b, c, d ], e ] = a1;
  var { x: { y: { z: w } } } = o1;
  
  console.log( a, b, c, d, e ); // 1 2 3 4 5
  console.log( w ); // 6
  ```

**å¯¹è±¡**

- ç®€æ´å±æ€§(å½“å±æ€§ä¸å˜é‡åŒå)

  ```js
  const x = 2, y = 3,
  const o = {
      x,
      y
  };
  ```

- ç®€æ´æ–¹æ³•

  ```js
  const o = {
    x() {
      // ..
    },
    *y() { // ç”Ÿæˆå™¨
      // ..
    },
  };
  ```

  è¿™ç§ç®€æ´æ–¹æ³•ç›¸å½“äºæ˜¯

  ```js
  var o = {
    x: function () {
      // ..
    },
    y: function* () {
      // ..
    },
  };
  ```

  å¸¦æ¥çš„åæœå°±æ˜¯å¯¹è±¡ä¸­çš„æ–¹æ³•å˜æˆäº†åŒ¿åå‡½æ•°, è¿™ä¸åˆ©äºå†…éƒ¨å¯¹æ–¹æ³•å¼•ç”¨

  ```js
  runSomething( {
  	something(x,y) {
  		if (x > y) {
  			return something( y, x ); // error
  		}
  		return y - x;
  	}
  } );
  ```

  ```js
  runSomething( {
  	something: function something(x,y) {
  		if (x > y) {
  			return something( y, x ); // ok, å› ä¸ºæœ‰å—ä½œç”¨åŸŸ
  		}
  		return y - x;
  	}
  } );
  ```

- ç®€æ´ `getter & setter`

  ```js
  var o = {
  	__id: 10,
  	get id() { return this.__id++; },
  	set id(v) { this.__id = v; }
  }
  ```


- `supper`

  ä¸æ­¢ `class` æ”¯æŒ `supper`, å¯¹è±¡ä¹Ÿå¯ä»¥ä½¿ç”¨ `supper`

  ```js
  const o1 = {
    a: 'FA',
  };
  
  const o2 = {
    a: 'SON',
    // na: super.a // ğŸ‘, supper ä¸èƒ½ç”¨äºå±æ€§å£°æ˜æ—¶
    foo() {
      console.log(this.a);
      console.log(super.a);
    },
  };
  
  Object.setPrototypeOf(o2, o1);
  o2.foo(); // SON FA
  // console.log(o2.super.a); // ğŸ‘, supper ä¸èƒ½ç”¨äºå±æ€§è®¿é—®
  ```

**æ¨¡æ¿å­—ç¬¦ä¸²**

- åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­, é™¤éå‡ºç°è½¬ä¹‰, `\n, \r, \r\n` éƒ½ä¼šè¢«è½¬ä¸º `\n`

- æ¨¡æ¿å­—ç¬¦ä¸²æ²¡æœ‰è‡ªå·±çš„åŠ¨æ€ä½œç”¨åŸŸ

  ```js
  let a = 1;
  const s = `hi, ${(a = 2)}`;
  console.log(a); // 2
  ```

- æ¨¡æ¿å­—ç¬¦ä¸²çš„æ ‡ç­¾å‡½æ•°([MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Template_literals#%E5%B8%A6%E6%A0%87%E7%AD%BE%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2))

  å¯ä»¥åœ¨æ¨¡æ¿å­—ç¬¦ä¸²å‰é¢åŠ ä¸€ä¸ªå‡½æ•°å, è¿™æ ·æ¨¡æ¿å­—ç¬¦ä¸²ä¼šä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°, å‡½æ•°çš„è¿”å›ç»“æœä½œä¸ºæ¨¡æ¿å­—ç¬¦ä¸²çš„ç»“æœ. å‚æ•°ä¼ å…¥çš„å½¢å¼æ¯”è¾ƒç‰¹æ®Š. ä¼ å…¥ä¸¤ä¸ªæ•°ç»„, ç¬¬ä¸€ä¸ªæ•°ç»„åŒ…å«ä¸º `${}` çš„å†…å®¹, å°† `${}` ä½œä¸ºåˆ†éš”ç¬¦å°†å­—ç¬¦ä¸²åˆ†å¼€, ç¬¬äºŒä¸ªæ•°ç»„åŒ…å«æ‰€æœ‰ `${}` ä¼ å…¥çš„å†…å®¹

  ç®€å•çš„å®ç°

  ```js
  function tag(strings, ...values) {
    return strings.reduce(function (s, v, idx) {
      return s + (idx > 0 ? values[idx - 1] : '') + v;
    }, '');
  }

  var desc = 'awesome';

  var text = tag`Everything is ${desc}!`;

  console.log(text); // Everything is awesome!
  ```

  å°†æ¨¡æ¿å­—ç¬¦ä¸²ä¸­æ’å…¥çš„æ‰€æœ‰æ•°å­—å‰åŠ ä¸Š `$` å¹¶ä¿ç•™ä¸¤ä½å°æ•°

  ```js
  function dollabillsyall(strings, ...values) {
  	return strings.reduce( function(s,v,idx){
  		if (idx > 0) {
  			if (typeof values[idx-1] == "number") {
  				// çœ‹ï¼Œä¹Ÿä½¿ç”¨æ’å€¼æ€§å­—ç¬¦ä¸²å­—é¢é‡ï¼
  				s += `$${values[idx-1].toFixed( 2 )}`;
  			}
  			else {
  				s += values[idx-1];
  			}
  		}

  		return s + v;
  	}, "" );
  }

  var amt1 = 11.99,
  	amt2 = amt1 * 1.08,
  	name = "Kyle";

  var text = dollabillsyall
  `Thanks for your purchase, ${name}! Your
  product cost was ${amt1}, which with tax
  comes out to ${amt2}.`

  console.log( text );
  // Thanks for your purchase, Kyle! Your
  // product cost was $11.99, which with tax
  // comes out to $12.95.
  ```

- æ¨¡æ¿å­—ç¬¦ä¸²å‡½æ•°ä¸­çš„ `raw`

  ç±»ä¼¼äº HTML ä¸­çš„ `pre` æ ‡ç­¾

  ```js
  function showraw(strings, ...values) {
    console.log(strings);
    console.log(strings.raw);
  }
  
  showraw`Hello\nWorld`;
  // [ "Hello
  // World" ]
  // [ "Hello\nWorld" ]
  ```

**ç®­å¤´å‡½æ•°**

- ç®­å¤´å‡½æ•°: ä¸€èˆ¬ç”¨äºçŸ­å°çš„, ä¸éœ€è¦è‡ªå·±ä½œç”¨åŸŸçš„åŒ¿åå‡½æ•°(æ— éœ€ç»‘å®š, ç›‘å¬, é€’å½’).
- ç®­å¤´å‡½æ•°æœ‰è‡ªå·±çš„ä½œç”¨åŸŸ, ä½†æ˜¯çˆ¶ä½œç”¨åŸŸä¸å£°æ˜æ—¶çš„ä½œç”¨åŸŸç»‘å®š. ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ `this`, `arguments`, `super`, `new.target` å‡ä»çˆ¶ä½œç”¨åŸŸç»§æ‰¿

**è¿­ä»£å™¨**

- JavaScript ä¸­é»˜è®¤å¯è¿­ä»£çš„å¯¹è±¡æœ‰

  - Array
  - String
  - ç”Ÿæˆå™¨
  - Collections & TypedArrays

- `for...of` å¯ä»¥è¿­ä»£å¯è¿­ä»£å¯¹è±¡

  ```js
  var o = {};
  
  for (o.a of [1,2,3]) {
  	console.log( o.a );
  }
  // 1 2 3
  
  for ({x: o.a} of [ {x: 1}, {x: 2}, {x: 3} ]) {
    console.log( o.a );
  }
  // 1 2 3
  ```

**æ­£åˆ™è¡¨è¾¾å¼**

- Unicode

  Unicode å­—ç¬¦å¯ä»¥åˆ†ä¸º BMP(åŸºæœ¬å¤šè¯­è¨€å¹³é¢)éƒ¨åˆ†(0x000000-0x00ffff)ä¸å…¶ä»–éƒ¨åˆ†(0x00ffff-0x10ffff). åœ¨ ES6 ä¹‹å‰, æ­£åˆ™åªèƒ½åŒ¹é… BMP éƒ¨åˆ†çš„å†…å®¹, é BMP éƒ¨åˆ†çš„å­—ç¬¦ä¼šè¢«åŒ¹é…ä¸ºå¤šä¸ª BMP å­—ç¬¦

  ```js
  const s = 'ğŸ‘ğŸ‘ğŸ‘';
  console.log(s.length); // 6
  console.log(/^ğŸ‘.ğŸ‘$/.test(s)); // false å°†ä¸€ä¸ª ğŸ‘ è§£æä¸ºä¸¤ä¸ªå­—ç¬¦æ‰€ä»¥ . å¤±æ•ˆäº†
  console.log(/^ğŸ‘.{2}ğŸ‘$/.test(s)); // true
  console.log(/^ğŸ‘.ğŸ‘$/u.test(s)); // true åŠ ä¸Š u åæ”¯æŒè§£æ Unicode é BMP éƒ¨åˆ†
  console.log(/^ğŸ‘.{2}ğŸ‘$/u.test(s)); // false
  ```

  æ”¯æŒ Unicode åè¿˜å¯ä»¥ç”¨è¿™ç§æ“ä½œ

  ```js
  const s = 'ğŸ‘ğŸ»';
  console.log(/[ğŸ‘-ğŸ‘ğŸ¼]/u.test(s)); // true
  ```

- å®šç‚¹æ ‡è¯†(é»æ»æ ‡è¯†)

  å®šç‚¹æ ‡è¯†(`lastIndex`)å¯ä»¥æŒ‡å®šä»å“ªä¸€ä½å¼€å§‹æ­£åˆ™åŒ¹é…(å¿…é¡»ä»è¿™ä¸€ä½å¼€å§‹).

  ```js
  const re = /foo/y; // ä½¿ç”¨ y å¼€å¯å®šç‚¹æ ‡è¯†
  str = 'abcfooabc';

  console.log(re.lastIndex); // é»˜è®¤æ˜¯0
  console.log(re.test(str)); // false: è®©ç¬¬0ä½ a ä½œä¸ºå¼€å¤´åŒ¹é…å¤±è´¥
  console.log(re.lastIndex); // ç”±äºåŒ¹é…å¤±è´¥å˜ä¸º0
  re.lastIndex = 3;
  console.log(re.test(str)); // true: è®©ç¬¬3ä½ f ä½œä¸ºå¼€å¤´åŒ¹é…æˆåŠŸ
  console.log(re.lastIndex); // åŒ¹é…æˆåŠŸå lastIndex åŒ¹é…éƒ¨åˆ†æœ€åä¸€ä½çš„ä¸‹ä¸€ä½ 6
  console.log(re.test(str)); // false: è®©ç¬¬6ä½ a ä½œä¸ºå¼€å¤´åŒ¹é…å¤±è´¥
  console.log(re.lastIndex); // ç”±äºåŒ¹é…å¤±è´¥å˜ä¸º0
  ```

  æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨å°† `lastIndex` è®¾ç½®åˆ°æŒ‡å®šçš„ä½ç½®, æˆ–åœ¨æ¯æ¬¡åŒ¹é…æˆåŠŸåè‡ªåŠ¨ä¿®æ”¹ä½ç½®. è¿™ç©æ„çœ‹èµ·æ¥æ²¡ä»€ä¹ˆç”¨. å¸¸è§„çš„ä½¿ç”¨åœºæ™¯æœ‰

  - è¦æ±‚æ¯è‹¥å¹²ä½ç½®å‡ºç°ä¸€æ¬¡åŒ¹é…ä¸²

    ```js
    const re = /[0-9]+\.[^ ]+/y; // ä½¿ç”¨ y å¼€å¯å®šç‚¹æ ‡è¯†
    str = '1.ä½ å¥½, æˆ‘æ˜¯ABC    2.Hello, IM A  3.HI';

    // æµ‹è¯•æ¯15ä½å‡ºç°ä¸€æ¬¡ x.ä¸€æ®µæ–‡å­—
    for (let i = 0; i < str.length; i += 15) {
      re.lastIndex = i;
      console.log(re.test(str));
    }
    ```

  - å·²çŸ¥åŒ¹é…ä¸²çš„å›ºå®šæ¨¡å¼ç”± JavaScript è‡ªåŠ¨æ›´æ–° `lastIndex`

    ```js
    const re = /[0-9]+\.[^0-9]+/y; // ä½¿ç”¨ y å¼€å¯å®šç‚¹æ ‡è¯†
    str = '1.ä½ å¥½, æˆ‘æ˜¯ABC          2.Hello, IM A     3.HI';
    
    // æµ‹è¯•æ–‡æœ¬ç¬¦åˆ x.ä¸€æ®µæ–‡å­— çš„æ¨¡å¼å¹¶è·å¾—æ¯æ¬¡æ¨¡å¼å¼€å¤´çš„ä¸‹æ ‡
    while (re.lastIndex < str.length) {
      console.log(re.test(str));
      console.log(re.lastIndex);
    }
    
    // true 21 true 39 true 43
    ```

  **æ³¨æ„**: è‹¥æ­£åˆ™ä½¿ç”¨äº† `^` è€Œå®šç‚¹æ ‡è¯†çš„ `lastIndex !== 0` é‚£å¿…å®šåŒ¹é…å¤±è´¥

- flags

  - `g`: å…¨å±€åŒ¹é…
  - `i`: å¿½ç•¥å¤§å°å†™
  - `m`: æ”¯æŒå¤šè¡Œæ¨¡å¼(æ­¤æ—¶ `^` ä¸ `$` æ—¢è¡¨ç¤ºè¡Œå§‹æœ«ä¹Ÿè¡¨ç¤ºæ–‡æœ¬å§‹æœ«)
  - `u`: æ”¯æŒ Unicode é BMP åŒºåŸŸå­—ç¬¦
  - `y`: æ”¯æŒå®šç‚¹æ ‡è¯†

**Unicode**

- Unicode çš„è¡¨ç¤º
  - ES6 ä¹‹å‰: ä½¿ç”¨ `"\uxxxx"` ä½†æ˜¯åªæ”¯æŒ BMP éƒ¨åˆ†å­—ç¬¦
  - ES6 çš„ Unicode è½¬ä¹‰: `"\u{1-ffff}"` æ”¯æŒå…¨éƒ¨ Unicode å­—ç¬¦

**Symbol**

- ä½¿ç”¨ `symbol(string)` å³å¯å£°æ˜ Symbol(æ— éœ€ `new`)

- `Symbol.toString` çš„ç»“æœä¸º

  ```js
  const s = Symbol('hihi');
  console.log(s.toString()); // Symbol(hihi)
  ```

- å¯ä»¥é€šè¿‡ `Symbol.for` å°†ä¸€ä¸ª Symbol æ³¨å†Œä¸ºå…¨å±€ç¬¦å·. `Symbol.for` ç›¸å½“äºä¸€ä¸ªå•ä¾‹æ„é€ å‡½æ•° API. è‹¥æ„é€ ç”¨å­—ç¬¦ä¸²ä»æœªè¢«æ³¨å†Œåˆ™ä¼šæ„é€ å¹¶è¿”å› Symbol. è‹¥å·²ç»æ³¨å†Œ, åˆ™ç›´æ¥è¿”å› Symbol(å‰ææ˜¯å¿…é¡»ç”¨ `Symbol.for` åˆ›å»º)

  ```js
  const s1 = Symbol('ruru');
  const s2 = Symbol('ruru');
  console.log(s1 === s2); // false

  const s3 = Symbol.for('hihi');
  const s4 = Symbol.for('hihi');
  console.log(s3 === s4); // true
  ```

- `Symbol.keyfor` å¯ä»¥è·å– `Symbol.for` æ³¨å†Œ Symbol çš„æè¿°å­—ç¬¦ä¸²

  ```js
  const s1 = Symbol.for('ruru');
  console.log(Symbol.keyFor(s1)); // ruru

  const s2 = Symbol('hihi'); // undefined
  console.log(Symbol.keyFor(s2));
  ```

- å½“ Symbol ä½œä¸ºå¯¹è±¡å±æ€§æ—¶, æ— æ³•é€šè¿‡ `Object.key / Object.getOwnPropertyNames` è·å–, å¯ä»¥é€šè¿‡ `Object.getOwnPropertySymbols` è·å–

  ```js
  const o = {
    a1: 1,
    ['c' + 1]: 2,
    [Symbol('hihi')]: 3,
  };
  
  console.log(o); // { a1: 1, c1: 2, [Symbol(hihi)]: 3 }
  console.log(Object.keys(o)); // [ 'a1', 'c1' ]
  console.log(Object.getOwnPropertyNames(o)); // [ 'a1', 'c1' ]
  console.log(Object.getOwnPropertySymbols(o)); // [ Symbol(hihi) ]
  ```

### ä»£ç ç»„ç»‡

**è¿­ä»£å™¨**

- æ¥å£

  - `next` å‡½æ•°[å¿…é¡»å®ç°]: è¿”å›ä¸€ä¸ª `{value:, done: boolean}`

  - `return` å‡½æ•°[å¯é€‰å®ç°]: è¿”å›ä¸€ä¸ª `{value:, done: boolean}`, ç”¨æ¥ç»“æŸè¿­ä»£å™¨, å¹¶å®Œæˆä»£ç æ¸…ç†å·¥ä½œ

  - `throw` å‡½æ•°[å¯é€‰å®ç°]: è¿”å›ä¸€ä¸ª `{value:, done: boolean}`, ç”¨æ¥é€šè¿‡å¼‚å¸¸çš„æ–¹å¼ç»“æŸè¿­ä»£å™¨å¹¶è°ƒç”¨å¹¶å®Œæˆä»£ç æ¸…ç†å·¥ä½œ

    è‹¥æ˜¯è°ƒç”¨ç”Ÿæˆå™¨çš„ `throw` ç›¸å½“äºæ˜¯åœ¨ç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸Šæ’å…¥ä¸€ä¸ªé”™è¯¯, ç»“æŸè¿­ä»£å™¨.

  - `[Symbol.iterator]` å‡½æ•°[å¯é€‰å®ç°]: è¿”å›ä¸€ä¸ªè¿­ä»£å™¨

- è‡ªå®šä¹‰è¿­ä»£å™¨: åªéœ€è¦è¿”å›ä¸€ä¸ª `thenable` çš„å¯¹è±¡å³å¯

  ```js
  var Fib = {
  	[Symbol.iterator]() {
  		var n1 = 1, n2 = 1;

  		return {
  			// ä½¿è¿­ä»£å™¨æˆä¸ºä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡
  			[Symbol.iterator]() { return this; },

  			next() {
  				var current = n2;
  				n2 = n1;
  				n1 = n1 + current;
  				return { value: current, done: false };
  			},

  			return(v) {
  				console.log(
  					"Fibonacci sequence abandoned."
  				);
  				return { value: v, done: true };
  			}
  		};
  	}
  };

  for (var v of Fib) {
  	console.log( v );

  	if (v > 50) break;
  }
  // 1 1 2 3 5 8 13 21 34 55
  // Fibonacci sequence abandoned.
  ```

- è¿­ä»£å™¨ç›¸å…³ API

  `...` & `for...of` & æ•°ç»„è§£æ„(ä¸èƒ½æ˜¯æ™®é€šå¯¹è±¡) éƒ½éœ€è¦æ¶ˆè€—è¿­ä»£å™¨ç”Ÿæˆåºåˆ—

**ç”Ÿæˆå™¨**

- yield çš„ä¼˜å…ˆçº§ä¸ `=` åŸºæœ¬ç›¸åŒ, `yield` æ—¶æ³¨æ„åŠ  `()`

  ```js
  var a, b;

  a = 3; // åˆæ³•
  b = 2 + a = 3; // ä¸åˆæ³•
  b = 2 + (a = 3); // åˆæ³•
  yield 3; // åˆæ³•
  a = 2 + yield 3; // ä¸åˆæ³•
  a = 2 + (yield 3); // åˆæ³•
  ```

- `yield` å§”æ‰˜è¿”å›åä¼šè‡ªåŠ¨ `next`

  ```js
  function* foo(x) {
    if (x < 3) {
      x = yield* foo(x + 1);
    }
    return x * 2;
  }

  var it = foo(1);
  it.next(); // { value: 24, done: true }
  ```

- `yield` ä¸ `next`

  ```js
  function* foo() {
    console.log(yield 1);
    console.log(yield 2);
    console.log(yield 3);
  }

  const it = foo(); // 1. å…ˆæ„é€ ç”Ÿæˆå™¨, ä½†æ˜¯ä¸æ‰§è¡Œ
  console.log(it.next('A')); // 2. ä¼ å…¥ 'A' å¯æƒœæ²¡ä¸œè¥¿æ¥æ”¶, æ‰§è¡Œåˆ° yield æš‚åœ, è¿”å› 1, è¾“å‡º 1
  console.log(it.next('B')); // 3. è½¬å…¥ 'B' è¢« console.log æ¥æ”¶, æ‰§è¡Œåˆ°ç¬¬2ä¸ª yield æš‚åœ, è¿”å› 2, è¾“å‡º 2
  console.log(it.next('C')); // 3. è½¬å…¥ 'C' è¢« console.log æ¥æ”¶, æ‰§è¡Œåˆ°ç¬¬3ä¸ª yield æš‚åœ, è¿”å› 3, è¾“å‡º 3
  console.log(it.next('D')); // 3. è½¬å…¥ 'D' è¢« console.log æ¥æ”¶, æ‰§è¡Œç»“æŸ, è¿”å› done
  ```

  åœ¨æ‰§è¡Œ `next` æ—¶: å…ˆä¼ å…¥, å†æš‚åœ, æœ€åè¿”å›. **å¯¹äºåŒä¸€ä¸ª `yield`, ä¼ å…¥å‚æ•°çš„ `next` ä¸è¿”å›å‚æ•°çš„ `next` ä¸åŒ!**.

  åŒæ—¶æ³¨æ„: åœ¨ç¬¬ä¸‰ä¸ª `next` æ‰§è¡Œç»“æŸåè™½ç„¶æ²¡æœ‰ `yield` äº†, ä½†æ˜¯ä»ç„¶ä¸è¿”å› `{done: true}`, è¿™æ˜¯å› ä¸º `for...of` è¯­å¥åœ¨é‡åˆ° `{done: true}` åä¼šç«‹é©¬åœæ­¢(è¿™æ˜¯ä¹¦ä¸Šçš„è¯´æ³•, æˆ‘è§‰å¾—ä¸å¯¹, ä¸ºäº†ç¢Ÿé†‹åŒ…é¥ºå­è¡Œä¸º)

- è°ƒç”¨ç”Ÿæˆå™¨ä¸Šè¿­ä»£å™¨çš„ `throw` ç›¸å½“äºä¸ºä¸Šä¸‹æ–‡åŠ å…¥ Error, ç”¨ `try...catch` å¯ä»¥æ•è·

**æ¨¡å—**

- ES6 ä¹‹å‰çš„æ¨¡å—: é€šè¿‡å‡½æ•°ä¸é—­åŒ…å®ç°

  ```js
  function Hello(name) {
    function greeting() {
      console.log('Hello ' + name + '!');
    }
  
    return {
      greeting: greeting, // éœ€è¦æš´éœ²çš„API
    };
  }
  
  var me = Hello('Kyle');
  me.greeting(); // Hello Kyle!
  ```

  è¿˜æœ‰ AMD, CMD ç­‰å„ç§å…¼å®¹æ–¹æ¡ˆ

- ES6 æ¨¡å—ç‰¹æ€§

  - æ¨¡å—åŸºäºæ–‡ä»¶: ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—, æš‚æ—¶æ— æ³•åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ”¾å¤šæ¨¡å—

  - æ¨¡å—æ˜¯å•ä¾‹çš„: å®ä¾‹åªæœ‰ä¸€ä¸ª, å¤šä¸ªæ¨¡å—å¯¼å…¥åŒä¸€ä¸ªæ¨¡å—, è¯¥æ¨¡å—è¢«å¤šæ¨¡å—å…±äº«(å¦‚æœä¸æƒ³å…±äº«, å¯ä»¥è€ƒè™‘æä¸€ä¸ªå·¥å‚å‡½æ•°)

    - `/index.js`

      ```js
      import './mod1.js';
      import './mod2.js';
      import { o } from './mod3.js';

      console.log(o); // {a: 2}, æ‰€æœ‰æ¨¡å—å¼•å…¥çš„éƒ½æ˜¯ä¸€ä¸ªå®ä¾‹
      ```

    - `/mod1.js`

      ```js
      import { o } from './mod3.js';
      o.a = 1;
      ```

    - `/mod2.js`

      ```js
      import { o } from './mod3.js';
      o.a = 2;
      ```

    - `/mod3.js`

      ```js
      export let o = {
        a: 1,
      };
      ```

  - æ¨¡å—æ˜¯é™æ€å®šä¹‰çš„: è¿™æ„å‘³ç€åœ¨ç½‘ç»œè¯·æ±‚æ¨¡å—æ—¶å¯ä»¥é¢„åŠ è½½  


  - å¯¼å…¥å£°æ˜åªèƒ½åœ¨æ¨¡å—çš„é¡¶å±‚ä½¿ç”¨

    ```js
    import { o } from './mod3'; // ğŸ‘

    function demo() {
      import { o } from './mod3'; // ğŸ‘
    }
    ```

  - è‡ªåŠ¨æå‡: æ‰€æœ‰å¯¼å…¥çš„å¯¹è±¡ä¼šè‡ªåŠ¨æå‡åˆ°é¡¶å±‚ä½œç”¨åŸŸæœ€å‰é¢

    ```js
    console.log(foo); // [Function: foo]
    console.log(bar); // 1
    import { foo, bar } from './mod3.js'; // ä¸è®ºæ˜¯å¯¼å…¥çš„å‡½æ•°è¿˜æ˜¯å˜é‡, éƒ½ä¼šæå‡
    ```

  - æ”¯æŒå¾ªç¯ä¾èµ–

    JavaScript æ‰§è¡Œæ¨¡å—çš„è¿‡ç¨‹: æ‰“å¼€æ–‡ä»¶ - æ‰«ææ–‡ä»¶çš„æ‰€æœ‰å¯¼å‡ºå¹¶è®°å½•å¯¼å‡ºé¡¹ - æ‰«ææ–‡ä»¶çš„æ‰€æœ‰å¯¼å…¥ - å¯¹äºæ¯ä¸ªå¯¼å…¥, ä»¥åŒæ ·çš„æ¨¡å¼æ‰«ææ¯ä¸ªå¯¼å…¥æ–‡ä»¶

    å¯¹äºå¾ªç¯ä¾èµ–: è®¾æ¨¡å— A è¢«é¦–å…ˆåŠ è½½, ç»è¿‡ä¸Šè¿°æ‰«æ, æ›´å…·åŠ è½½æŒ‡ä»¤åŠ è½½æ¨¡å— B å¹¶åšåŒæ ·çš„æ‰«æåˆ†æ. çœ‹åˆ° B åŠ è½½ A æ—¶å‘ç° A ä»¥åŠæ‰«æè¿‡, ç›´æ¥æ ‡æ³¨è¿™ä¸ªå¯¼å…¥åˆæ³•

    - `mod1.js`

      ```js
      import { foo } from './mod2.js';

      export function bar() {
        console.log('IM MOD 1');
      }

      foo();
      ```

    - `mod2.js`

      ```js
      import { bar } from './mod1.js';
    
      export function foo() {
        console.log('IM MOD 2');
      }
    
      bar();
      ```

- å¯¼å‡ºæ¨¡å—

  æœ‰ä¸¤ç§å¯¼å‡ºæ–¹å¼

  - å‘½åå¯¼å‡º: å°†æ¨¡å—ä¸**å˜é‡æœ¬èº«**ç»‘å®š, å¯¼å‡ºçš„æ˜¯å˜é‡çš„å¼•ç”¨(æˆ–æŒ‡é’ˆ). **è¿™æ„å‘³ç€åœ¨å¯¼å‡ºåè‹¥ä¿®æ”¹å˜é‡çš„å€¼, å¯¼å‡ºçš„å˜é‡ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–**

    - ä¸€ä¸ªä¸€ä¸ªå¯¼å‡º

      ```js
      export let o = { // éœ€è¦å¯¼å‡º o å°±åœ¨å‰é¢åŠ ä¸ª export
        a: 1,
      };

      export let a = 1;
      ```

    - æ‰¹é‡å¯¼å‡º

      ```js
      let o = {
        a: 1,
      };

      let a = 1;

      export { o, a }; // å°†éœ€è¦å¯¼å‡ºçš„å†…å®¹å†™å…¥ä¸€ä¸ªæ‹¬å·å†….
      ```

      æ³¨æ„: è¿™ä¸ªæ‹¬å·åªæ˜¯è¯­æ³•, ä¸æ˜¯å¯¹è±¡, **ä¸æ˜¯å¯¼å‡ºäº†ä¸€ä¸ªåŒ¿åå¯¹è±¡**

    - å¯¼å‡ºå¹¶é‡å‘½å

      ```js
      let o = {
        a: 1,
      };
    
      let a = 1;
    
      export {
        o as q, // å¯¼å‡ºçš„å°±åªæœ‰ q æ²¡æœ‰ o äº†, ä½†æ˜¯ q å°±æ˜¯ o çš„æŒ‡é’ˆ
        a
      };
      ```

  - é»˜è®¤å¯¼å‡º: å°†æ¨¡å—ä¸**å€¼**ç»‘å®š, å¯¼å‡ºçš„æ˜¯å€¼, ä¸å¯¼å‡ºå˜é‡å. **è¿™æ„å‘³ç€åœ¨å¯¼å‡ºåè‹¥ä¿®æ”¹å˜é‡çš„å€¼, å¯¼å‡ºçš„å€¼ä¹Ÿä¸ä¼šå˜åŒ–**. é»˜è®¤å¯¼å‡ºåªèƒ½ç»‘å®šä¸€ä¸ªå€¼

    - ä¸€èˆ¬å†™æ³•

      ```js
      let o = {
        a: 1,
      };

      export default o;
      ```

    - å‘½åå¯¼å‡ºä¸é»˜è®¤å¯¼å‡ºåŒæ—¶å¯¼å‡º

      ```js
      export default {
        a: 1,
      };

      export let a = 1;
      ```

    - åœ¨æ‰¹é‡å‘½åå¯¼å‡ºæ—¶æŒ‡å®šä¸€ä¸ªå€¼é»˜è®¤å¯¼å‡º

      ```js
      let o = {
        a: 1,
      };

      let a = 1;

      export {
        o,
        a as default // ç›¸å½“äºé»˜è®¤å¯¼å‡ºå€¼ 1, å‘½åå¯¼å‡º o
      };
      ```

    - ä¸è¦å›¾æ–¹ä¾¿å°†æ‰€æœ‰éœ€è¦å¯¼å‡ºçš„å˜é‡é»˜è®¤å¯¼å‡º, è¿™ä¼šå¯¼è‡´ JavaScript æ— æ³•åšé™æ€åˆ†æ

      ```js
      const a = 1;
      const b = 2;
      const c = 3;

      export default { // ğŸ‘
        s: a,
        b,
        c,
      };
      ```

    - å¯¼å…¥åŒæ—¶å¯¼å‡º

      ```js
      export * from './mod.js';
      ```

      ç›¸å½“äºä» `/mod.js` å¯¼å…¥æ‰€æœ‰å‘½åå¯¼å‡º, ç„¶åå†å¯¼å‡º. æ­¤æ—¶ `/mod.js` ä¸­çš„å‘½åå¯¼å‡ºä¸ä¼šè¢«å¯¼å…¥, ä¼šç›´æ¥å¯¼å‡º

- å¯¼å…¥æ¨¡å—

  ä¸¤ç§å¯¼å‡ºæ–¹å¼å¯¹åº”ä¸¤ç§å¯¼å…¥æ–¹å¼

  - å¯¼å…¥é»˜è®¤å¯¼å‡ºçš„å€¼

    ```js
    import s from './mod.js';
    ```

    é»˜è®¤å¯¼å…¥çš„æ˜¯å€¼, éœ€è¦è‡ªå·±å‘½å, åŒæ—¶å¯¼å‡ºçš„æ˜¯å€¼, å¯¼å…¥åé»˜è®¤ä¸ºå¸¸é‡, ä¸å¯ä¿®æ”¹å€¼.

  - å¯¼å…¥å‘½åå¯¼å‡ºçš„å˜é‡

    - æŒ‰éœ€å¯¼å…¥

      ```js
      // mod.js
      //   export {a,b,c} // æ³¨æ„, è¿™ä¸æ˜¯å¯¼å‡ºåŒ¿åå¯¹è±¡! åªæ˜¯è¯­æ³•
      import { a, b } from './mod.js'; // æ³¨æ„, è¿™ä¸æ˜¯å¯¹è±¡è§£æ„! åªæ˜¯è¯­æ³•!
      ```

      è¿™ç§æ–¹æ³•æœ€å¥½, ä½†æ˜¯æ¯æ¬¡éœ€è¦å˜é‡éƒ½è¦ä¿®æ”¹å¯¼å…¥å‘½ä»¤

    - å…¨éƒ¨å¯¼å…¥

      å°†å…¨éƒ¨å‘½åå¯¼å‡ºçš„å˜é‡å¯¼å…¥å›ºç„¶æ–¹ä¾¿, ä½†æ˜¯ä¼šæ±¡æŸ“å‘½åç©ºé—´. è§£å†³æ–¹æ¡ˆæ˜¯å…¨éƒ¨å¯¼å…¥å¹¶é‡å‘½å

      ```js
      import * as s from './mod.js';
      ```

  - æ··åˆå¯¼å…¥é»˜è®¤ä¸å‘½åå¯¼å‡º

    ```js
    // mod.js
    //   export default function foo() {}
    //   export function bar() {}
    //   export function baz() {}
    //   export function yoo() {}
    
    import s, { bar, baz } from './mod';
    ```

**ç±»(ES6)**

- `class` è¯­æ³•ç³–

  - `constructor` ç›¸å½“äºåŸæ¥çš„å‡½æ•°å

  - ç±»ä¸Šçš„æ–¹æ³•(åŒ…æ‹¬ `getter` & `setter`)éƒ½æ”¯æŒç®€æ´æ¨¡å¼

  - ç±»ä¸Šçš„æ–¹æ³•ç›¸å½“äº `ç±».prototype.æ–¹æ³•`

- ä¸ ES5 çš„åŒºåˆ«

  - åœ¨ ES6 ä¹‹å‰å¯ä»¥ç”¨ `Foo.call(obj)` åˆ›å»ºå¯¹è±¡, ä½¿ç”¨ `class` ååªèƒ½ç”¨ `new`

  - `class` ä¸åƒ `function` ä¸€æ ·æ”¯æŒæå‡

  - `class` å£°æ˜çš„ç±»ä¼šåˆ›å»ºä½œç”¨åŸŸè¯æ³•åˆ†æç¬¦

- `supper`

  - `supper` åœ¨ä¸åŒä½ç½®è¡¨æ„ä¸åŒ

    - åœ¨æ„é€ å‡½æ•°ä¸­: çˆ¶ç±»çš„æ„é€ å‡½æ•°

    - åœ¨ç±»çš„éæ„é€ å‡½æ•°ä¸­: æŒ‡å‘çˆ¶ç±», å¯ä»¥è°ƒç”¨çˆ¶ç±»çš„é™æ€æ–¹æ³•, æ„é€ å‡½æ•°(åªèƒ½å¸¦ `new` ç”¨: `new super.constructor`)

    - åœ¨å¯¹è±¡ä¸­: æŒ‡å‘å¯¹è±¡çš„ `__protp__`

  - å­ç±»æ„é€ å‡½æ•°å¿…é¡»å…ˆè°ƒç”¨ `this` åœ¨è®¿é—® `this`(JavaScript çš„å§”æ‰˜ç»§æ‰¿)

  - ç±»ä¸Šçš„ `supper` æ˜¯é™æ€ç»‘å®šçš„

    ```js
    class ParentA {
      constructor() {
        this.id = 'a';
      }
      foo() {
        console.log('ParentA:', this.id);
      }
    }
    
    class ParentB {
      constructor() {
        this.id = 'b';
      }
      foo() {
        console.log('ParentB:', this.id);
      }
    }
    
    class ChildA extends ParentA {
      foo() {
        super.foo();
        console.log('ChildA:', this.id);
      }
    }
    
    class ChildB extends ParentB {
      foo() {
        super.foo();
        console.log('ChildB:', this.id);
      }
    }
    
    // å¸¸è§„æ“ä½œ
    var a = new ChildA();
    a.foo(); // ParentA: a
             // ChildA: a
    var b = new ChildB();
    b.foo(); // ParentB: b
             // ChildB: b
    
    // ä¿®æ”¹ this
    b.foo.call(a); // ParentB: a (supperä¸å˜, ä¾ç„¶æŒ‡å‘ B, this å˜äº†)
                   // ChildB: a
    ```

- `extends`

  ç›¸å½“äº ES6 ä¹‹å‰ç”¨ `prototype` å°†ä¸¤ä¸ªç±»è¿èµ·æ¥. é™¤æ­¤ä¹‹å¤–, `extends` è¿˜å®Œç¾æ”¯æŒäº†åŸç”Ÿç±»å‹çš„æ‰©å±•. ä¾‹å¦‚: åœ¨ ES6 ä¹‹å‰, æ‰‹åŠ¨åˆ›å»ºçš„ `Array` å­ç±»å¹¶ä¸ä¼šåƒ `Array` ä¸€æ ·å®ç°è‡ªåŠ¨æ›´æ–° `.length` ä½†æ˜¯ `extends` æ”¯æŒ

- `new.target`

  åœ¨æ„é€ å‡½æ•°ä¸­æŸ¥çœ‹æ­¤å±æ€§å¯ä»¥è¿”å›ç±»å, åœ¨å…¶ä»–å‡½æ•°ä¸­æ˜¯ `undefined`. å¯ä»¥é€šè¿‡æ­¤å±æ€§åˆ¤æ–­æ„é€ å‡½æ•°æ˜¯ä½œä¸ºè¢«ç»§æ‰¿ç±»æ„é€ è¿˜æ˜¯ç›´æ¥æ„é€ 

  ```js
  class Foo {
    constructor() {
      console.log('Foo: ', new.target.name);
    }
  }

  class Bar extends Foo {
    constructor() {
      super();
      console.log('Bar: ', new.target.name);
    }
    baz() {
      console.log('baz: ', new.target);
    }
  }

  var a = new Foo();
  // Foo: Foo

  var b = new Bar();
  // Foo: Bar   <-- è™½ç„¶è°ƒç”¨çš„æ˜¯ Foo çš„æ„é€ å‡½æ•°, ä½†æ˜¯ new çš„æ˜¯ Bar
  // Bar: Bar

  b.baz();
  // baz: undefined
  ```

- `static`

  ç”¨äºå£°æ˜ç±»ä¸Šçš„é™æ€å¯¹è±¡, ç›¸å½“äºåœ¨ ES5 çš„æ„é€ å‡½æ•°ä¸Šç›´æ¥ç»‘å®šå¯¹è±¡. å­ç±»å¯ä»¥é€šè¿‡ `supper` ç›´æ¥è°ƒç”¨

### é›†åˆ

ä¸»è¦åŒ…å« `TypedArray`, `Map`, `WeakMap`, `Set`, `WeakSet`

**`TypedArray`**

- é™æ€é•¿åº¦ä¸ç±»å‹çš„ `Array`, ä¸€èˆ¬ç”¨äºè¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®.

- `TypedArray` å­˜åœ¨å¤§å°ç«¯é—®é¢˜(ä½ä½å­˜å·¦è¾¹è¿˜æ˜¯å³è¾¹)
- é€šè¿‡ `ArrayBuffer` ç”³è¯·ç©ºé—´(Buffer), é€šè¿‡[ç±»å‹æ•°ç»„æ„é€ å‡½æ•°](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray)åˆ›å»ºæŒ‡å®šç±»å‹ä¸å¤§å°çš„è§†å›¾, å¹¶ç»‘å®šçš„ Buffer. Buffer ä¸è§†å›¾å¯ä»¥æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»

**`Map` & `WeakMap`**

- æ„é€ å‡½æ•°æ¥å— [`Object.entire()` æ¨¡å¼](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/entries)çš„æ•°ç»„

- é€šè¿‡ `get` / `set` / `delete` æ–¹æ³•æŸ¥è¯¢ / å¢åŠ  / åˆ é™¤Map

- é€šè¿‡ `has` æ–¹æ³•æŸ¥è¯¢æ˜¯å¦æœ‰é”®å

- é€šè¿‡ `clear` æ–¹æ³•æ¸…ç©º Map

- Map æœ¬èº«æ˜¯å¯è¿­ä»£çš„

  - è¿­ä»£å™¨æ¯æ¬¡è¿­ä»£ä¸€ä¸ªæ•°ç»„, ç¬¬ä¸€ä¸ªæ˜¯ Key, ç¬¬äºŒä¸ªæ˜¯ Value
  - å¯ä»¥é€šè¿‡ `entries` è·å–é”®å€¼å¯¹æ•°ç»„
  - å¯ä»¥é€šè¿‡ `keys` è·å–é”®å€¼å¯¹æ•°ç»„
  - å¯ä»¥é€šè¿‡ `values` è·å–é”®å€¼å¯¹æ•°ç»„

  ```js
  const m = new Map([
    ['a', 1],
    ['b', 2],
    ['c', 3],
  ]);
  console.log(m.entries()); // [Map Entries] { [ 'a', 1 ], [ 'b', 2 ], [ 'c', 3 ] }
  console.log(m.values()); // [Map Iterator] { 1, 2, 3 }
  console.log(m.keys()); // [Map Iterator] { 'a', 'b', 'c' }
  ```

- å¦‚æœå°†å¯¹è±¡ä½œä¸º `Map` çš„ Key, å¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°å°† `+1`, è¿™æ„å‘³ç€ä¸å°† Key åˆ é™¤, å¯¹è±¡å°†æ— æ³•è¢« GC. `WeakMap` è§£å†³äº†è¿™ä¸€é—®é¢˜

  - `WeakMap` çš„ Key åªèƒ½æ˜¯å¯¹è±¡ä½†æ˜¯å¯¹è±¡å¼•ç”¨æ¬¡æ•°ä¸ä¼šè¢«å½±å“
  - å½“å¯¹è±¡è¢« GC æ—¶, æ˜ å°„ä¼šè‡ªåŠ¨åˆ é™¤
  - `WeakMap` æ²¡æœ‰ `size`, `clear` æ–¹æ³•

**`Set` & `WeakSet`**

- ç›¸å½“äº `set` æ¢ä¸º `add` ä¸” `Vaule === Key` çš„ `Map` & `WeakMap`

- ä¸æ”¯æŒå¼ºåˆ¶ç±»å‹è½¬æ¢(`1 !== '1'`)

- åŒæ ·æ”¯æŒè¿­ä»£å™¨

  ```js
  const s = new Set([1, 2, 3, 3, 2, 1]);
  console.log(s.entries()); // [Set Entries] { [ 1, 1 ], [ 2, 2 ], [ 3, 3 ] }
  console.log(s.values()); // [Set Iterator] { 1, 2, 3 }
  console.log(s.keys()); // [Set Iterator] { 1, 2, 3 }
  ```

- `WeakSet` çš„ Key åªèƒ½æ˜¯å¯¹è±¡

###  ES6æ–°API

**Array**

- `Array.of` æ–¹æ³•

  ç±»ä¼¼ `Array` æ„é€ å‡½æ•°, åŒºåˆ«æ˜¯è‹¥ä¼ å…¥å•ä¸ªæ•°å­—ä¼šåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 1 çš„æ•°ç»„, è€Œä¸æ˜¯é‚£ä¹ˆé•¿çš„æ•°ç»„. ä¸ä»…è§„é¿çš„ `Array` çš„é™·é˜±, è¿˜é˜²æ­¢äº† `<empty items>` çš„å‡ºç°

  ```js
  console.log(new Array(5)); // [ <5 empty items> ]
  console.log(Array.of(5)); // [ 5 ]
  console.log(new Array(5, 6, 7)); // [ 5, 6, 7 ]
  console.log(Array.of(5, 6, 7)); // [ 5, 6, 7 ]
  ```

- `Array.from` æ–¹æ³•

  å°†ä¸€ä¸ª `Object` ä¸­çš„æ­£æ•´æ•° Key æå–å‡ºæ¥æ„é€ æ•°ç»„. é•¿åº¦ä¸º `object.length`, æ‰¾ä¸åˆ°çš„ä¸‹æ ‡ç›´æ¥è®¾ä¸º `undefined`

  ```js
  fakeArr = document.querySelectorAll('body')
  arr = Array.from(fakeArr) // [body]
  ```

  ç›¸å¯¹äº `Array.prototype.slice` ä¸ä¼šäº§ç”Ÿç©ºå€¼

  ```js
  const o = {
    0: 'HIHI',
    1: 'RURU',
    3: 'LALA',
    length: 4,
  };

  console.log(Array.from(o)); // [ 'HIHI', 'RURU', undefined, 'LALA' ]
  console.log(Array.prototype.slice.apply(o)); // [ 'HIHI', 'RURU', <1 empty item>, 'LALA' ]
  ```

- `Array.prototype.copyWithin` æ–¹æ³•

  æµ…å¤åˆ¶æ•°ç»„çš„ä¸€éƒ¨åˆ†åˆ°åŒä¸€æ•°ç»„ä¸­çš„å¦ä¸€ä¸ªä½ç½®.

  ç”¨æ³•: `arr.copyWithin(target[, start[, end]])`, åŒºé—´å‰å–åä¸å–, èµ·æ­¢ä½ç½®æ¥å—è´Ÿæ•°(å€’æ•°ç¬¬å‡ ä¸ª)

  ```js
  [1, 2, 3, 4, 5].copyWithin(3, 0); // [1,2,3,1,2]
  [1, 2, 3, 4, 5].copyWithin(3, 0, 1); // [1,2,3,1,5]
  [1, 2, 3, 4, 5].copyWithin(0, -2); // [4,5,3,4,5]
  [1, 2, 3, 4, 5].copyWithin(0, -2, -1); // [4,2,3,4,5]
  ```

  æ‹·è´çš„é¡ºåºæ˜¯è‡ªå³å‘å·¦çš„

  ```js
  [1,2,3,4,5].copyWithin( 2, 1 );
  // è‡ªå·¦å‘å³æ‹·è´çš„è¯æ˜¯
  // [1,2,3,4,5] -> [1,2,2,4,5] -> [1,2,2,2,5] -> [1,2,2,2,5] -> [1,2,2,2,2]
  // è‡ªå³å‘å·¦æ‹·è´çš„è¯æ˜¯
  // [1,2,3,4,5] -> [1,2,3,4,4] -> [1,2,3,3,4] -> [1,2,2,3,4]
  ```

- `Array.prototype.find`æ–¹æ³•: ä½¿ç”¨ `===` æŸ¥æ‰¾å…ƒç´ è¿”å› `boolean`. å¦‚æœéœ€è¦è‡ªå®šä¹‰æ¯”è¾ƒè§„åˆ™, å¯ä»¥ä½¿ç”¨ `Array.prototype.some`([MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/some)). å¦‚æœæƒ³è¦æ‰¾åˆ°ä¸‹æ ‡å¯ä»¥ç”¨ `Array.prototype.findIndex`([MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex))

**Object**

- `Object.is(..)` æ–¹æ³•

  æ¯” `===` æ›´ä¸¥æ ¼çš„æ¯”è¾ƒ

  ```js
  var x = NaN,
    y = 0,
    z = -0;

  x === x; // false
  y === z; // true

  Object.is(x, x); // true
  Object.is(y, z); // false
  ```

- `Object.assign` æ–¹æ³•

  ç”¨æ¥åˆå¹¶å¯¹è±¡, åªä¿ç•™åŸå¯¹è±¡ä¸­è‡ªæœ‰(éç»§æ‰¿)çš„, å¯æšä¸¾çš„å±æ€§

**Number**

- `Number.isNaN()`

- `Number.isFinite()`: ä¸è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢åˆ¤æ–­æ˜¯ä¸æ˜¯æœ‰ç©·çš„(NaN, Infinityéƒ½ä¸ç®—). å¦‚éœ€ç±»å‹è½¬æ¢, å¯ä»¥ä½¿ç”¨å…¨å±€çš„ `isFinite`

  ```js
  a = '10';
  b = 10;
  isFinite(a); // true
  Number.isFinite(a); // false
  isFinite(a); // true
  Number.isFinite(a); // false
  ```

- `Number.isInteger()`: åˆ¤æ–­æ˜¯ä¸æ˜¯æ•´æ•°, è™½ç„¶ JavaScript çš„æ•°éƒ½æ˜¯åŸºäº IEEE 754 çš„, ä½†æ˜¯è¿˜æ˜¯å¯ä»¥é€šè¿‡åˆ¤æ–­å°æ•°ä½æ˜¯å¦å…¨ 0 åˆ¤æ–­æ˜¯ä¸æ˜¯æ•´æ•°

**String**

- `String.prototype.repeat` æ–¹æ³•

  ```js
  "foo".repeat( 3 ); // 'foofoofoo'
  ```

### å…ƒç¼–ç¨‹

é€šè¿‡æ“ä½œç¨‹åºå®ä½“, åœ¨ç¼–è¯‘æ—¶è®¡ç®—å‡ºè¿è¡Œæ—¶éœ€è¦çš„å¸¸æ•°, ç±»å‹, ä»£ç çš„æ–¹æ³•(è¯´ç™½äº†å°±æ˜¯æ“ä½œä»£ç å®ä½“)

**è·å–å‡½æ•°å**

é€šè¿‡ `.name` å¯ä»¥è·å–å‡½æ•°å

```js
(function () {}); // name:
(function* () {}); // name:
window.foo = function () {}; // name:

class Awesome {
  constructor() {} // name: Awesome
  funny() {} // name: funny
}

var c = class Awesome {}; // name: Awesome

var o = {
  foo() {}, // name: foo
  *bar() {}, // name: bar
  baz: () => {}, // name: baz
  bam: function () {}, // name: bam
  get qux() {}, // name: get qux
  set fuz(v) {}, // name: set fuz
  ['b' + 'iz']: function () {}, // name: biz
  [Symbol('buz')]: function () {}, // name: [buz]
};

var x = o.foo.bind(o); // name: bound foo
(function () {}.bind(o)); // name: bound

export default function () {} // name: default

var y = new Function(); // name: anonymous
var GeneratorFunction = function* () {}.__proto__.constructor;
var z = new GeneratorFunction(); // name: anonymous
```

**Symbol**

- `Symbol.iterator`: è¿”å›å¯¹è±¡çš„è¿­ä»£å™¨

- `Symbol.toStringTag`: toStringçš„è¿”å›ç»“æœ

- `Symbol.hasInstance`: åˆ¤æ–­å¯¹è±¡æ˜¯ä¸æ˜¯è¯¥ç±»å‹çš„å®ä¾‹

  ```js
  function Foo(greeting) {
    this.greeting = greeting;
  }
  
  Foo.prototype[Symbol.toStringTag] = 'Foo';
  
  Object.defineProperty(Foo, Symbol.hasInstance, {
    value: function (inst) {
      return inst.greeting == 'hello';
    },
  });
  
  var a = new Foo('hello'),
    b = new Foo('world');
  
  b[Symbol.toStringTag] = 'cool';
  
  a.toString(); // [object Foo]
  String(b); // [object cool]
  
  a instanceof Foo; // true
  b instanceof Foo; // false
  ```

- `Symbol.species`

- `Symbol.toPrimitive`

- æ­£åˆ™ç›¸å…³:

  - `Symbol.match`
  - `Symbol.replace`
  - `Symbol.search`
  - `String.prototype.split`
    å¯¹åº”å››ä¸ªæ­£åˆ™æ–¹æ³•, ä¸€èˆ¬ä¸è¦æ”¹, å¼•æ“å®ç°çš„ç‰ˆæœ¬æ€§èƒ½å¾ˆå¥½

- `Symbol.isConcatSpreadable`: å¯¹è±¡åœ¨åˆå¹¶æ—¶æ˜¯å¦å¯ä»¥å±•å¼€

  ```js
  var a = [1,2,3], b = [4,5,6];
  b[Symbol.isConcatSpreadable] = false;
  [].concat( a, b ); // [1,2,3,[4,5,6]]
  ```

- `Symbol.unscopables` å±æ€§æ˜¯å¦å¯ä»¥åœ¨ `with` ä¸­æš´éœ²

  ```js
  var o = { a: 1, b: 2, c: 3 },
    a = 10,
    b = 20,
    c = 30;
  
  o[Symbol.unscopables] = {
    a: false,
    b: true,
    c: false,
  };
  
  with (o) {
    // o.b ä¸æš´éœ², æ‰€ä»¥åªèƒ½è¯·æ±‚å¤–éƒ¨çš„ b
    console.log(a, b, c); // 1 20 3
  }
  ```

### ES6+

- `async & await` å¼‚æ­¥æ”¯æŒ: ç›¸å½“äºç”Ÿæˆå™¨ + Promise è¯­æ³•ç³–

- å¯¹è±¡çš„ `...`: **è¿™ä¸æ˜¯ Spread è¡¨è¾¾å¼, å¯¹è±¡é»˜è®¤æ˜¯ä¸å¯è¿­ä»£çš„**.

  ```js
  const o = {
    a: 1,
    b: 2,
  };

  console.log(...o); // TypeError: Found non-callable @@iterator
  ```

  è¿™ä¸ªåŠŸèƒ½å¯ä»¥å°†å¯¹è±¡è§£æ„æˆå¹¶å¹¶å…¥å…¶ä»–å¯¹è±¡

  ```js
  const o = {
    a: 1,
    b: 2,
  };

  const o2 = {
    c: 3,
    ...o,
  };

  console.log(o2); // { c: 3, a: 1, b: 2 }
  ```

- `Array.prototype.includes`: æŸ¥æ‰¾æ•°ç»„å¹¶è¿”å›æ•°ç»„ä¸­æ˜¯å¦æœ‰å…ƒç´ . æ”¯æŒæŸ¥æ‰¾ `NaN`, æ— æ³•åŒºåˆ† `+0 & -0`

  ```js
  const arr = [1, 2, NaN, +0];
  console.log(~arr.indexOf(NaN)); // 0, æ‰¾ä¸åˆ°
  console.log(arr.includes(NaN)); // true, æ‰¾çš„åˆ°
  console.log(arr.includes(-0)); // true, æ— æ³•åŒºåˆ†
  ```

- `Object.observe()` (æ²¡æœ‰æ”¯æŒä½†æ˜¯å¾ˆä¼Ÿå¤§çš„ API)

  - ç›¸å½“äºä¸€ä¸ªé’©å­å‡½æ•°, æ”¯æŒå¯¹è±¡åœ¨å¦‚ä¸‹å˜åŒ–åè°ƒç”¨å‡½æ•°

    - add

    - update

    - delete

    - reconfigure(é€šè¿‡ `Object.defineProperty(..)` è€Œé‡æ–°é…ç½®æ—¶è§¦å‘)

    - setPrototype(ä¸è®ºæ˜¯ä½¿ç”¨`__proto__.setter`, è¿˜æ˜¯ä½¿ç”¨`Object.setPrototypeOf(..)`éƒ½ä¼šè§¦å‘)

    - preventExtensions(çŠ¶æ€æ”¹å˜, `Object.seal(..)` å’Œ `Object.freeze(..)` ä¹Ÿä¼šè§¦å‘)

  - ä¹Ÿæ”¯æŒè‡ªå®šä¹‰äº‹ä»¶å¹¶è§¦å‘(è¿™ä¸å°±ç›¸å½“äºæ˜¯ä¸ªå…¨å±€äº‹ä»¶æ€»çº¿??)
  - å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥åŠŸèƒ½å®ç° MVVM
  - è™½ç„¶ç›®å‰æ²¡æœ‰å®ç°, ä½†æ˜¯å®ç°äº†å¯¹ DOM æ ‘ç›‘æ§çš„ [MutationObserver](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver)

